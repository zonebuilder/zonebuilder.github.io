/*
  JWL - The JavaScript Widget Library version 0.8.7 testing
  Copyright (c) 2016 - 2020 The Zonebuilder <zone.builder@gmx.com>
  http://sourceforge.net/projects/jwl-library/
  Licenses: GNU GPL2 or later; GNU LGPLv3 or later (http://sourceforge.net/p/jwl-library/wiki/License/)
 */
/**
  @fileOverview  The JavaScript Widget Library (JWL) is a tool that allows you to build modern web applications by providing a simple way to create HTML components.
   JWL is based on JUL - The JavaScript UI Language module and it easily integrates with JUL Designer.
*/
/* jshint browser: true, curly: true, eqeqeq: true, evil: true, expr: true, funcscope: true, immed: true, latedef: true, loopfunc: true,  
  onevar: true, newcap: true, noarg: true, node: true, strict: true, trailing: true, undef: true, unused: vars, wsh: true */
/* globals JUL */

(function(global, module) {
'use strict';
if (module && module.exports && typeof require === 'function') { require('jul'); }
var jul = new JUL.Instance({nsRoot: module && module.exports ? {JWL: module.exports} : global || null});
var JWL = jul.ns('JWL');

/* generated by JCS version 1.5.8 */

/**
  JWL global namespace
  @namespace  It holds properties and methods used by JWL
  @name  JWL
*/
jul.ns('JWL');

jul.apply(jul.get('JWL'), /** @lends JWL */ {
  /**
    JWL parser configuration
    @type  Object
  */
  parserConfig: {
    /**
      Default class of the parser - HTML elements
      @type  String
    */
    defaultClass: 'html',
     /**
      Order of component creation - parent before children
      @type  Boolean
    */
    topDown: true,
     /**
      The parser will use tha tag property to differentiate between components
      @type  Boolean
    */
    useTags: true,
     /**
      Special component factory that will do further processing compared to JUL.UI.createDom():
      <ul>
        <li>if the config object is not a JWL component, return JUL.UI.createDom(oConfig)</li>
        <li>call config/component pre-create callback with parent's scope</li>
        <li>distribute dotted attributes 'objectID.attribute' among descendants</li>
        <li>create element and recursively process its children</li>
        <li>call config/component post-create callback with element's scope</li>
      </ul>
      @param  {Object}  oConfig  Configuration object
      @returns  {Object}  Element instance
    */
    customFactory: function(oConfig) {
      var sTag = oConfig[this.tagProperty];
      if (oConfig[this.classProperty] !== this.defaultClass) { sTag = oConfig[this.classProperty] + ':' + sTag; } 
      var oComponent = JWL.components[sTag];
      if (!oComponent) {
        var fCreator = this._creator ? jul.get(this._creator) : null;
        return typeof fCreator === 'function' ? fCreator.call(this, oConfig) : this.createDom(oConfig);
      }
      oConfig._componentIndex = sTag;
      var fPreCreate = oConfig.preCreate || oComponent.preCreate;
      if (fPreCreate) { fPreCreate = jul.get(fPreCreate); }
      delete oConfig.preCreate;
      var fPostCreate = oConfig.postCreate || oComponent.postCreate;
      if (fPostCreate) { fPostCreate = jul.get(fPostCreate); }
      if (fPostCreate) { oConfig.postCreate = fPostCreate; }
      var oHost = oConfig[this.parentProperty] ? oConfig[this.parentProperty].host || oConfig[this.parentProperty] : null;
      if (oHost && oHost._componentName && oHost._derived) {
        oConfig[this.classProperty] = this.defaultClass;
        oConfig[this.tagProperty] = 'div';
      }
      else if (oComponent.ui) {
        oConfig[this.classProperty] = oComponent.ui[this.classProperty] || this.defaultClass;
        oConfig[this.tagProperty] = oComponent.ui[this.tagProperty];
      }
      if (typeof fPreCreate === 'function') {
        var bReturn = fPreCreate.call(oConfig[this.parentProperty],  oConfig, this);
        if (bReturn === false) { return null; }
      }
      fPostCreate = oConfig.postCreate;
      delete oConfig.postCreate;
      var oInit = oConfig;
      oConfig = JUL.apply({}, oConfig);
      delete oConfig._componentIndex;
      var oLogic = {};
      var sBinding = oComponent.ui ? oComponent.ui[this.bindingProperty] : '.component';
      if (!oComponent.ui) { oConfig[this.bindingProperty] = sBinding; }
      var oRootLogic = {};
      oLogic[sBinding] = oRootLogic;
      var sItem, nDot;
      for (sItem in oConfig) {
        if (oConfig.hasOwnProperty(sItem)) {
           nDot = sItem.indexOf('.', 1);
          if (nDot > 0 && nDot < sItem.length - 1) {
            sBinding = sItem.slice(0, nDot);
            oLogic[sBinding] = oLogic[sBinding] || {};
            oLogic[sBinding][sItem.substr(nDot + 1)] = oConfig[sItem];
            delete oConfig[sItem];
          }
        }
      }
      var oListeners = oConfig.listeners || {};
      delete oConfig.listeners;
      oRootLogic.listeners = oListeners;
      for (sItem in oListeners) {
        if (oListeners.hasOwnProperty(sItem)) {
           nDot = sItem.indexOf('.', 1);
          if (nDot > 0 && nDot < sItem.length - 1) {
            sBinding = sItem.slice(0, nDot);
            oLogic[sBinding] = oLogic[sBinding] || {};
            oLogic[sBinding].listeners = oLogic[sBinding].listeners || {};
            oLogic[sBinding].listeners[sItem.substr(nDot + 1)] = oListeners[sItem];
            delete oListeners[sItem];
          }
        }
      }
      for (sItem in oConfig) {
        if (oConfig.hasOwnProperty(sItem) &&
          [this.classProperty, this.tagProperty,  this.idProperty, this.bindingProperty, this.parentProperty, this.cssProperty].indexOf(sItem) < 0) {
          oRootLogic[sItem] = oConfig[sItem];
          delete oConfig[sItem];
        }
      }
      if (oComponent.ui) { oConfig[this.includeProperty] = oComponent.ui; }
      if (oComponent.logic) { oLogic[this.includeProperty] = oComponent.logic; }
      var oWidget = this.create(oConfig, oLogic, oConfig.parent);
      if (typeof fPostCreate === 'function') { fPostCreate.call(oWidget, oInit, this); }
      return oWidget;
    },
    /**
      Use JSON prefixes when serializing objects
      @type  Boolean
      @private
    */
    _usePrefixes: true,
     /**
      Special merging callback for parser's include() method that will do further processing compared to JUL.apply():
      <ul>
        <li>if the object is not a component (binding ID doesn't start with a dot), call JUL.apply(oData, oApply)</li>
        <li>attach object's listeners in cascade</li>
        <li>append object's CSS class</li>
        <li>call JUL.apply() on the other members</li>
      </ul>
      @param  {Object}  oData  Target object
      @param  {Object}  oApply  Appended object
      @param  {Boolean}  [bSkip]  For internal use, to process component's logic
      @returns  {Object}  Target object with the resulting members
      @private
    */
    _includeMerger: function(oData, oApply, bSkip) {
      var oListeners = oData.listeners;
      var sItem;
      if (bSkip) {
        JUL.apply(oData, oApply);
      }
      else {
        for (sItem in oApply) {
          if (oApply.hasOwnProperty(sItem)) {
            if (sItem.substr(0, 1) === '.' && sItem.length > 1 && JUL.typeOf(oApply[sItem]) === 'Object' &&
              oData[sItem] && JUL.typeOf(oData[sItem]) === 'Object') { this._includeMerger(oData[sItem], oApply[sItem], true); }
            else {
              if (sItem === this.cssProperty) { oData[sItem] = oApply[sItem] + (oData[sItem] ? ' ' + oData[sItem] : ''); }
              else { oData[sItem] = oApply[sItem]; }
            }
          }
        }
      }
      if (!oListeners || !oApply.listeners) { return oData; }
      for (sItem in oApply.listeners) {
        if (oApply.listeners.hasOwnProperty(sItem)) {
          if (sItem !== 'scope' && oListeners[sItem]) {
            oListeners[sItem] = [].concat(oListeners[sItem], oApply.listeners[sItem]);
          }
          else {
            oListeners[sItem] = oApply.listeners[sItem];
          }
        }
      }
      oData.listeners = oListeners;
      return oData;
    },
    /**
      Callback for un-serializing objects. Use it in a safe data environment because of eval().
      @param  {String}  sKey  Current member key
      @param  {Mixed}  oValue  Current member value
      @returns  {Mixed}  Member's processed value
      @private
    */
    _jsonReviver: function(sKey, oValue) {
      if (sKey && typeof oValue === 'string') {
        var bPrefix = false;
        for (var sItem in this._jsonPrefixes) {
          if (this._jsonPrefixes.hasOwnProperty(sItem) &&
            oValue.substr(0, this._jsonPrefixes[sItem].length) === this._jsonPrefixes[sItem]) {
            bPrefix = true;
            oValue = oValue.substr(this._jsonPrefixes[sItem].length).replace(/^\s+/, '');
            break;
          }
        }
        if (bPrefix) {
          try {
            return eval('(function(){return ' + oValue + '})()');
          }
          catch(e) {
            return oValue;
          }
        }
      }
      return oValue;
    }
  },
  /**
    Default prefix for custom element tags
    @type  String
  */
  registerPrefix: 'jwl',
  /**
    JWL version
    @type  String
  */
  version: '0.8.5',
  /**
    Creates a new parser derived from JWL.parser
    @class
    @extends  JWL.parser
    @param  {Object}  oConfig  Configuration object
  */
  Parser: function(oConfig) {
    if (!(this instanceof JWL.Parser)) {
      return new JWL.Parser(oConfig);
    }
    jul.ui.Parser.call(this, oConfig);
  },
  /**
    Callback to be used as the JWL.Parser custom factory to self-register and to create custom HTML elements.
    e.g. var oParser = new JWL.Parser({customFactory: 'JWL.custom'});
    @param  {Object}  oConfig  Configuration object
    @returns  {Object}  New element
  */
  custom: function(oConfig) {
      var sName = oConfig[this.tagProperty];
      if (oConfig[this.classProperty] !== this.defaultClass) { sName = oConfig[this.classProperty] + ':' + sName; }
      var oComponent = JWL.components[sName];
      if (oComponent) {
        JWL._customCache = JWL._customCache || {};
        var sKey = oConfig[this.classProperty] + ':' + oConfig[this.tagProperty];
        if (typeof JWL._customCache[sKey] !== 'function') {
          try {
            JWL._customCache[sKey] = JWL.register(sName, false, '', this);
          }
          catch (e) {}
        }
        oConfig[this.tagProperty] = JWL.registerPrefix + '-' +
          (oConfig[this.classProperty] === this.defaultClass ? '' : oConfig[this.classProperty] + '-') +
          oConfig[this.tagProperty];
        oConfig[this.classProperty] = this.defaultClass;
      }
      return this.createDom(oConfig);
  },
  /**
    Callback to be used as the JWL.Parser custom factory to create element wrappers.
    e.g. var oParser = new JWL.Parser({customFactory: 'JWL.factory'});
    @param  {Object}  oConfig  Configuration object
    @returns  {Object}  Element wrapper instance
  */
  factory: function(oConfig) {
    var sName = oConfig[this.tagProperty];
    var sNS = oConfig[this.classProperty];
    var CNew = jul.get('JWL.' + sNS.toUpperCase() + '.' + sName[0].toUpperCase() + sName.substr(1));
    if (typeof CNew !== 'function') { CNew = JWL.makeClass(sNS + ':' + sName, false, this); }
    return new CNew(oConfig);
  },
  /**
    Gets a wrapper object associated with an element
    @param  {Object}  oEl  DOM element or element ID
    @returns  {Object}  Element wrapper, component root element, of null if not found
  */
  get: function(oEl) {
    if (typeof oEl === 'string') { oEl = document.getElementById(oEl); }
    if (typeof JWL._Base_ === 'function'&& oEl instanceof JWL._Base_) { return oEl; }
    if (oEl && typeof oEl.el === 'function') { oEl = oEl.el(); }
    return oEl && typeof JWL._Base_ === 'function' ? JWL._Base_.get(oEl) || oEl : oEl || null;
  },
  /**
    Loads component(s) from a string serialization
    @param  {String}  sData  Parameter description
    @param  {String}  [sWhat]  Name of a specific component to load
    @param  {String}  [sRoot]  Dotted path to read the component from the un-serialized object
    @returns  {Object}  Component configuration
  */
  load: function(sData, sWhat, sRoot) {
    var oData = null;
    try {
      oData = JSON.parse(sData, JUL.makeCaller(this.parser, '_jsonReviver'));
    }
    catch (e) {}
    if (oData && sRoot) { oData = JUL.get(sRoot, oData); }
    if (!oData || typeof oData !== 'object') { return null; }
    return jul.ns('JWL.components' + (sWhat ? '.' + sWhat : ''), oData);
  },
  /**
    Loads external CSS for a component using XMLHttpRequest
    @param  {String}  sComponent  Component name
    @param  {Function}  [fCall]  If supplied, the CSS will be loaded asynchronously
    @param  {Object}  [oScope]  Optional scope to run the callback in
    @returns  {Array}  Array of CSS descriptors
  */
  loadCss: function(sComponent, fCall, oScope) {
    var oComponent = this.components[sComponent] || {};
    if (!oComponent.css) { return null; }
    var bCall = typeof fCall === 'function';
    this._cssCache = this._cssCache || {};
    var aCss;
    if (this._cssCache[sComponent]) {
      aCss = this._cssCache[sComponent];
      if (bCall) {
        (oScope ? fCall.call(oScope, aCss) : fCall(aCss));
      }
      return aCss;
    }
    var oWatch = {
      values: [],
      total: 0,
      count: 0,
      ready: null,
      scope: this,
      set: function(nKey, oValue) {
        var sUrl = '';
        if (nKey >= 0) {
          sUrl = this.values[nKey].style;
          this.values[nKey].style = oValue;
        }
        this.count++;
        if (this.count >= this.total && typeof this.ready === 'function') {
          this.ready.call(this.scope);
        }
        if (sUrl && this.scope.__pending[sUrl]) {
          var aCalls = this.scope.__pending[sUrl];
          for (var i = 0; i < aCalls.length; i++) {
            aCalls[i].watch.set(aCalls[i].key, oValue);
          }
          delete this.scope.__pending[sUrl];
        }
      }
    };
    this.__pending = this.__pending || {};
    var fLoad = function(sUrl, nKey) {
      if (this.__pending[sUrl]) {
        this.__pending[sUrl].push({watch: oWatch, key: nKey});
        return;
      }
      else {
        this.__pending[sUrl] = [];
      }
      var oHttp;
      try {
        if (typeof window.XMLHttpRequest === 'function') {
          oHttp = new XMLHttpRequest();
          if (bCall) {
            oHttp.addEventListener('load', function() {
              oWatch.set(nKey, this.responseText || '');
            });
            oHttp.addEventListener('error', function() {
              oWatch.set(nKey, '');
            });
          }
          oHttp.open('GET', sUrl, bCall);
          oHttp.setRequestHeader('Content-Type', 'text/css; charset=UTF-8');
          oHttp.send(null);
          if (!bCall) { oWatch.set(nKey, oHttp.responseText || ''); }
        }
        else {
          oHttp = new ActiveXObject('WinHttp.WinHttpRequest.5.1');
          oHttp.Open('GET', sUrl, false);
          oHttp.SetRequestHeader('Content-Type', 'text/css; charset=UTF-8');
          oHttp.Send();
          oWatch.ser(nKey, oHttp.ResponseText || '');
        }
      }
      catch (e) {
        oWatch.set(nKey, '');
      }
    };
    aCss = [].concat(oComponent.css);
    oWatch.ready = function() {
      for (var i = 0; i < aCss.length; i++) {
        if (!aCss[i].style) {
          aCss.splice(i, 1);
          i--;
        }
      }
      this._cssCache[sComponent] = aCss;
      if (bCall) {
        (oScope ? fCall.call(oScope, aCss) : fCall(aCss));
      }
    };
    oWatch.total = aCss.length;
    oWatch.values = aCss;
    for (var i = 0; i < aCss.length; i++) {
      if (typeof aCss[i] !== 'object') { aCss[i] = {style: aCss[i], media: ''}; }
      var sUrl = encodeURI(JUL.trim(aCss[i].style.substr(0, 1024).split('\n')));
      if (aCss[i].style && aCss[i].style.indexOf(';') < 0 && sUrl) {
        fLoad.call(this, sUrl, i);
      }
      else {
        oWatch.set(-1, '' );
      }
    }
    return aCss;
  },
  /**
    Creates an element wrapper class for a specific component
    @param  {String}  sName  Component name or existing HTML tag
    @param  {String}  [sNewNS]  Optional namespace under to put the class constructor, it defaults to 'JWL.<Name>
    @param  {Object}  [oParser]  Custom instance of JUL.UI.Parser to use instead of the default JWL.parser
    @returns  {Function}  Class constructor
  */
  makeClass: function(sName, sNewNS, oParser) {
    oParser = oParser || this.parser;
    if (sName.indexOf(oParser.defaultClass + ':') === 0) { sName = sName.substr(oParser.defaultClass.length + 1); }
    var oComponent = this.components[sName] || {};
    var sNS = oParser.defaultClass;
    if (sName.indexOf(':') > -1) {
      sNS = sName.split(':')[0];
      sName = sName.substr(sNS.length + 1);
    }
    if (typeof JWL._Base_ !== 'function') {
      JWL._Base_ = function() {};
      JUL.apply(JWL._Base_.prototype, {
        get: function(sItem) { return sItem in this ? this[sItem] : JWL._Base_.wrapUp(this._el[sItem]); },
        set: function(sItem, oValue, bHost) { (bHost || sItem in this ? this : this._el)[sItem] =
          !bHost && !(sItem in this) && JWL._Base_.onRe.test(sItem) && typeof oValue === 'function' ?
          JUL.makeCaller(this, oValue) : oValue; },
        el: function() { return this._el; },
        config: function() { return this._config; }
      });
      JUL.apply(JWL._Base_, {
        id: 1,
        items: {},
        attributeName: 'data-component-id',
        onRe: /^on[a-z]+$/,
        map: function(oComponent, sItem) {
          var oEl = oComponent.el();
          if (!oEl) { return; }
          if (sItem && typeof sItem !== 'string') { sItem = sItem.getAttribute(this.attributeName); }
          if (!sItem) { sItem = 'c-' + this.id++; }
          this.items[sItem] = oComponent;
          oEl.setAttribute(this.attributeName, sItem);
        },
        get: function(sId) {
          if (sId && typeof sId !== 'string') { sId = sId.getAttribute(this.attributeName); }
          return sId ? this.items[sId] || null : null;
        },
        cleanUp: function() {
          if ((this.id - 1) % 4096) { return; }
          var oItems = {};
          var fClean = function(oNode) {
            for (var i = 0; i < oNode.childNodes.length; i++) {
              var oChild = oNode.childNodes[i];
              if (oChild.nodeType !== 1) { continue; }
              var sItem = oChild.getAttribute(this.attributeName);
              if (sItem) { oItems[sItem] = this.items[sItem]; }
              fClean.call(this, oChild);
            }
          };
          fClean.call(this, document.body);
          this.items = oItems;
        },
        wrapUp: function(oData) {
          try {
            if (!oData) { return oData; }
            if (oData instanceof Element && oData.nodeType === 1) {
              return oData.getAttribute(this.attributeName) ? this.get(oData) : oData;
            }
            if (typeof oData === 'object' && typeof oData.length && oData[0] instanceof Element) {
              var aReturn = [];
              for (var i = 0; i < oData.length; i++) {
                aReturn[i] = oData[i].nodeType === 1 && oData[i].getAttribute(this.attributeName) ? this.get(oData[i]) : oData[i];
              }
              return aReturn;
            }
          }
          catch (e) {}
          return oData;
        }
      });
    }
    var fClass = function(oConfig, oEl) {
      oConfig = oConfig  || {};
      this._config = JUL.apply({}, oConfig);
      delete this._config[this._parser.parentProperty];
      oConfig = JUL.apply({}, oConfig);
      oConfig[this._parser.classProperty] = sNS;
      oConfig[this._parser.tagProperty] = sName;
      oConfig.listeners = JUL.apply({scope: this}, oConfig.listeners || {});
      if (oEl) {
        this._parser.createDom(oConfig, oEl);
        this._el = oEl;
      }
      else {
        this._el = JWL.parser.customFactory.call(this._parser, oConfig);
        if (this._el instanceof JWL._Base_) {
          oEl = this._el.el();
          oEl.setAttribute('class', (oEl.getAttribute('class') || '') + ' ' + JWL.registerPrefix + '-' +
            (sNS === this._parser.defaultClass ? '' : sNS + '-') +
            ((oComponent.ui || {})[this._parser.cssProperty] || sName).split(' ').shift());
          this._el = oEl;
          JWL._Base_.map(this, oEl);
          return;
        }
      }
      JWL._Base_.map(this);
      JWL._Base_.cleanUp();
    };
    fClass.prototype = new JWL._Base_();
    fClass.prototype.constructor = fClass;
    fClass.prototype._parser = oParser;
    this._protoCache = this._protoCache || {};
    var sItem, oProto;
    var sCompNS = oComponent.ui ? oComponent.ui[oParser.classPrpperty] || oParser.defaultClass : sNS;
    var sCompTag = oComponent.ui ? oComponent.ui[oParser.tagProperty] : sName;
    var sTag = sCompNS + ':' + sCompTag;
    if (!this._protoCache[sTag]) {
      this._protoCache[sTag] = {attributes: false, baseURI: false, childNodes: false, className: false,  
        dataset: false, firstChild: false, innerHTML: false, lastChild: false, localName: false, 
        namespaceURI: false, nextSibling: false, nodeName: false, nodeType: false, nodeValue: false, 
        ownerDocument: false, parentNode: false, prefix: false, previousSibling : false, style: false, 
        tabIndex: false, tagName: false,
        addEventListener: true, appendChild: true, blur: true, cloneNode: true, 
        compareDocumentPosition: true, dispatchEvent: true, focus: true, getAttribute: true, 
        getAttributeNode: true, getAttributeNodeNS: true, getAttributeNS: true, getBoundingClientRect: true, 
        getElementsByTagName: true, getElementsByTagNameNS: true, hasAttribute: true, hasAttributeNS: true, 
        hasAttributes: true, hasChildNodes: true, insertBefore: true, isDefaultNamespace: true, 
        lookupNamespaceURI: true, lookupPrefix: true, normalize: true, querySelector: true, querySelectorAll: true, 
        releaseCapture: true, removeAttribute: true, removeAttributeNode: true, removeAttributeNS: true, 
        removeChild: true, removeEventListener: true, replaceChild: true, scrollIntoView: true, setAttribute: true, 
        setAttributeNode: true, setAttributeNodeNS: true, setAttributeNS: true, setCapture: true};
      var oFilter = /^[a-z]/;
      var oProtoConfig = {};
      oProtoConfig[oParser.classProperty] = sCompNS;
      oProtoConfig[oParser.tagProperty] = sCompTag;
      oProto = oParser.createDom(oProtoConfig);
      for (sItem in oProto) {
        if (!oFilter.test(sItem)) { continue; }
        try {
          this._protoCache[sTag][sItem] = typeof oProto[sItem] === 'function';
        }
        catch (e) {}
      }
    }
    oProto = this._protoCache[sTag];
    this._methodCache = this._methodCache || {getter: {}, setter: {}, other: {}};
    for (sItem in oProto) {
      if (oProto.hasOwnProperty(sItem)) {
        if (oProto[sItem]) {
          this._methodCache.other[sItem] = this._methodCache.other[sItem] || (function(sItem) {
            return function() {
              if (!this._el) { return undefined; }
              var bEvent = sItem === 'addEventListener' || sItem === 'attachEvent';
              var aArgs = [].slice.call(arguments);
              for (var i = 0; i < aArgs.length; i++) {
                // re-scope event listeners at explicit assignment
                if (bEvent && typeof aArgs[i] === 'function') { aArgs[i] = JUL.makeCaller(this, aArgs[i]); }
                if (aArgs[i] instanceof JWL._Base_) { aArgs[i] = aArgs[i].el(); }
              }
              return JWL._Base_.wrapUp(this._el[sItem].apply(this._el, aArgs));
            };
          })(sItem);
          fClass.prototype[sItem] = this._methodCache.other[sItem];
        }
        else {
          this._methodCache.getter[sItem] = this._methodCache.getter[sItem] || (function(sItem) {
            return function() {
              return this._el ? JWL._Base_.wrapUp(this._el[sItem]) : undefined;
            };
          })(sItem);
          this._methodCache.setter[sItem] = this._methodCache.setter[sItem] || (function(sItem) {
            return function(oValue) {
              if (oValue instanceof JWL._Base_) { oValue = oValue.el(); }
              if (this._el) {
                // re-scope 'on' handler at direct assignment; careful not using a function expression with an 'on' attribute
                if (JWL._Base_.onRe.test(sItem) && typeof oValue === 'function') {
                  oValue = JUL.makeCaller(this, oValue);
                }
                this._el[sItem] = oValue;
              }
            };
          })(sItem);
          try {
            Object.defineProperty(fClass.prototype, sItem, {
              configurable: true,
              enumerable: true,
              get: this._methodCache.getter[sItem],
              set: this._methodCache.setter[sItem]
            });
          }
          catch (e1) {}
        }
      }
    }
    JUL.apply(fClass.prototype, oComponent.prototype || {});
    var sWhat = 'JWL.' + sNS.toUpperCase() + '.' + sName[0].toUpperCase() + sName.substr(1);
    return jul.ns(sNewNS || sWhat, fClass);
  },
  /**
    Registers a JWL component as a custom HTML element (W3C web components)
    @param  {String}  sName  Component name
    @param  {Boolean}  [bDerived]  Set it to true to register derived a custom HTML element
    @param  {String}  [sNewName]  Optional new tag name instead of prepending 'jwl-' to the component name
    @param  {Object}  [oParser]  Custom instance of JUL.UI.Parser to use instead of the default JWL.parser
    @returns  {Function}  Registered element constructor
  */
  register: function(sName, bDerived, sNewName, oParser) {
    oParser = oParser || this.parser;
    if (sName.indexOf(oParser.defaultClass + ':') === 0) { sName = sName.substr(oParser.defaultClass.length + 1); }
    var oComponent = this.components[sName] || {};
    var oPrototype = JUL.apply({
      _componentName: sName,
      _derived: bDerived && true,
      _parser: oParser,
      el: function() {
        return (this.shadowRoot || this).lastChild;
      },
      createdCallback: function() {
        var oRoot = this;
        if (this.shadowRoot) { oRoot = this.shadowRoot; }
        else if (typeof this.createShadowRoot === 'function') {  oRoot = this.createShadowRoot(); }
        var oComponent = JWL.components[this._componentName] || {};
        if (oComponent.css) {
          var n = [].concat(oComponent.css).length;
          for (var i = 0; i < n; i++) {
            var oStyle = document.createElement('style');
            oStyle.setAttribute('type', 'text/css' );
            oStyle.appendChild(document.createTextNode('noscript {}'));
            oRoot.appendChild(oStyle);
          }
          JWL.loadCss(this._componentName, function(aCss) {
            for (var i = 0; i < aCss.length; i++) {
              var oStyle = document.createElement('style');
              oStyle.setAttribute('type', 'text/css' );
              if (aCss[i].media) { oStyle.setAttribute('media', aCss[i].media); }
              oStyle.appendChild(document.createTextNode(aCss[i].style));
              oRoot.replaceChild(oStyle, oRoot.childNodes[i]);
            }
          }, this);
        }
      },
      connectedCallback: function() {
        this.attachedCallback();
      },
      attachedCallback: function() {
        var oRoot = this.shadowRoot || this;
        if (oRoot.childNodes.length && oRoot.lastChild.nodeName.toLowerCase() !== 'style') { return; }
        var oComponent = JWL.components[this._componentName] || {};
        var sNS = this._parser.defaultClass;
        var sName = this._componentName;
        if (sName.indexOf(':') > -1) {
          sNS = sName.split(':')[0];
          sName = sName.substr(sNS.length + 1);
        }
        this.setAttribute('class', (this.getAttribute('class') || '') + ' ' + JWL.registerPrefix + '-' +
          (sNS === this._parser.defaultClass ? '' : sNS + '-') +
          ((oComponent.ui || {})[this._parser.cssProperty] || sName).split(' ').shift());
        if (!oComponent.ui) { return; }
        var oConfig = {};
        oConfig[this._parser.classProperty] = sNS;
        oConfig[this._parser.tagProperty] = sName;
        oConfig[this._parser.parentProperty] = oRoot;
        oConfig.listeners = JUL.apply({scope: this}, oConfig.listeners || {});
        JWL.parser.customFactory.call(this._parser, oConfig);
      }
    }, oComponent.prototype || {});
    var sNS = oParser.defaultClass;
    if (sName.indexOf(':') > -1) {
      sNS = sName.split(':')[0];
      sName = sName.substr(sNS.length + 1);
    }
    var sTag = '';
    if (bDerived) {
      var sCompNS = oComponent.ui ? oComponent.ui[oParser.classPrpperty] || oParser.defaultClass : sNS;
      var sCompTag = oComponent.ui ? oComponent.ui[oParser.tagProperty] : sName;
      sTag = (sCompNS === oParser.defaultClass ? '' : sCompNS + ':') + sCompTag;
      var oElConfig = {};
      oElConfig[oParser.classProperty] = sCompNS;
      oElConfig[oParser.tagProperty] = sCompTag;
      var oEl = oParser.createDom(oElConfig);
      oPrototype = JUL.apply(Object.create(oEl.constructor.prototype), oPrototype);
    }
    else {
      oPrototype = JUL.apply(Object.create(HTMLElement.prototype), oPrototype);
    }
    sName = this.registerPrefix + '-' + (sNS === oParser.defaultClass ? '' : sNS + '-') + sName;
    if (window.customElements && typeof window.customElements.define === 'function') {
      var CC = function() {
         var oEl = window.Reflect.construct(oPrototype.constructor, [].slice.call(arguments) , CC);
           oEl.attachShadow({mode: 'open'});
             oEl.createdCallback();
         return oEl;
      };
      CC.prototype = oPrototype;
      var oCE = window.customElements;
      oCE.define.apply(oCE, [sName, CC].concat(bDerived ? {'extends': sTag} : []));
      return CC;
    }
    return document.registerElement(sNewName || sName, bDerived ? 
      {'extends': sTag, prototype: oPrototype} : {prototype: oPrototype});
  },
  /**
    Saves component(s) into a JSON serialization
    @param  {String}  [sWhat]  Component to serialize, if omitted all components are saved
    @returns  {String}  JSON string containing serialized component(s)
  */
  save: function(sWhat) {
    return this.parser.obj2str(sWhat ? this.components[sWhat] : this.components, true);
  },
  /**
    Creates and triggers a custom DOM event
    @param  {Object}  oTarget  Target element or element wrapper to trigger the event on
    @param  {String}  sEvent  Event name
    @param  {Object}  [oInit]  Hash of additional event properties
    @returns  {Boolean}  The result of dispatching the event to its cascaded listeners
  */
  trigger: function(oTarget, sEvent, oInit) {
    if (typeof JWL._Base_ === 'function' && oTarget instanceof JWL._Base_) { oTarget = oTarget.el(); }
    oInit = JUL.apply({bubbles: true, cancelable: true, composed: true}, oInit || {});
    var nSep = sEvent.indexOf(':');
    var sClass = nSep < 0 ? 'Event' : sEvent.slice (0, nSep);
    if (nSep > -1) { sEvent = sEvent.substr(nSep + 1); }
    var oEvent = null;
    if (typeof window[sClass] === 'function') {
        oEvent = new window[sClass](sEvent, oInit);
    }
    else if (typeof document.createEvent === 'function') {
        oEvent = document.createEvent(sClass );
        var aArgs = [sEvent];
        for (var sItem in oInit) {
          if (oInit.hasOwnProperty(sItem)) { aArgs.push(oInit[sItem]); }
        }
        oEvent['init' + sClass].apply(oEvent, aArgs);
    }
    else {
      oEvent = document.createEventObject();
      JUL.apply(oEvent, oInit);
      try {
        return oTarget.fireEvent('on' + sEvent, oEvent);
      }
      catch (e1) { return false; }
    }
    return  oTarget.dispatchEvent(oEvent);
  }
});

jul.ns('JWL.components');
JWL.parser = new jul.ui.Parser(JWL.parserConfig);
JWL.Parser.prototype = JWL.parser;

})(typeof global !== 'undefined' ? global : window, typeof module !== 'undefined' ? module : null);

/* end JWL.js */
