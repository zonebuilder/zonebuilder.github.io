/*
	JUL Designer version 2.0.2 demo
	Copyright (c) 2014 - 2017 The Zonebuilder <zone.builder@gmx.com>
	http://sourceforge.net/projects/jul-designer/
	Licenses: GNU GPLv2 or later; GNU LGPLv3 or later (http://sourceforge.net/p/jul-designer/wiki/License/)
*/
(function(){'use strict';JUL.ns('JUL.Designer');JUL.Designer.browseUi={tag:'dialog',id:'dialog-browse',title:'Open',hidden:true,width:840,height:420,children:[{tag:'listbox',id:'listbox-browse',seltype:'single',flex:1,children:[{tag:'listhead',children:[{tag:'listheader',label:'Namespace',width:410},{tag:'listheader',label:'Title',width:510}]},{tag:'listbody'}],listeners:{dblclick:function(oEvent){if(oEvent.target.nodeName!=='xul:listcell'){return}var sItem=JUL.Designer.getWhere(oEvent.target.parentNode);switch(JUL.Designer.state.browseType){case'app':JUL.Designer.app.open(sItem);break;case'project':JUL.Designer.designer.open(sItem);break;case'framework':JUL.Designer.framework.open(sItem);break}}}}],listeners:{dialogaccept:function(){var oSelected=ample.getElementById('listbox-browse').selectedItems;if(!oSelected.length){window.alert('Please select an item');return false}var sItem=JUL.Designer.getWhere(oSelected.item(oSelected.length-1));switch(JUL.Designer.state.browseType){case'app':JUL.Designer.app.open(sItem);break;case'project':JUL.Designer.designer.open(sItem);break;case'framework':JUL.Designer.framework.open(sItem);break}return false}}};JUL.Designer.codeUi={tag:'dialog',id:'dialog-code',title:'Code',hidden:true,width:960,height:420,children:[{tag:'textbox',id:'textbox-code',width:'100%',multiline:true,flex:1,listeners:{keydown:'JUL.Designer.filterTab'}}],listeners:{dialogaccept:function(){JUL.Designer.saveCode();return false},dialogcancel:function(){JUL.Designer.cancelCode();return false}}};JUL.Designer.commentUi={tag:'dialog',id:'dialog-comment',title:'Comment',hidden:true,width:860,height:160,children:[{tag:'textbox',css:'desc',id:'textbox-comment',width:'100%',multiline:true,flex:1,listeners:{keydown:'JUL.Designer.filterTab'}}],listeners:{dialogaccept:function(){JUL.Designer.saveComment();return false},dialogcancel:function(){JUL.Designer.cancelComment();return false}}};JUL.Designer.jsUi={tag:'dialog',id:'dialog-js',title:'JavaScript',hidden:true,width:960,height:420,buttons:'accept',children:[{tag:'textbox',id:'textbox-js',readonly:true,width:'100%',multiline:true,flex:1}]};JUL.Designer.xmlUi={tag:'dialog',id:'dialog-xml',title:'XML layout',hidden:true,width:960,height:420,buttons:'accept',children:[{tag:'hbox',children:[{tag:'spacer',width:5},{tag:'vbox',width:'100%',children:[{tag:'hbox',children:[{tag:'label',control:'textbox-xml-css',value:'CSS class property'},{tag:'spacer',width:5},{tag:'textbox',id:'textbox-xml-css',style:'width:50px'},{tag:'spacer',width:10},{tag:'label',control:'textbox-xml-html',value:'Inner HTML property'},{tag:'spacer',width:5},{tag:'textbox',id:'textbox-xml-html',style:'width:50px'},{tag:'spacer',width:10},{tag:'label',control:'textbox-xml-wrapper',value:'multiple roots wrapper'},{tag:'spacer',width:5},{tag:'textbox',id:'textbox-xml-wrapper',style:'width:80px'}]},{tag:'checkbox',id:'checkbox-xml-merge-logic',label:'Merge logic into layout'},{tag:'hbox',children:[{tag:'checkbox',id:'checkbox-xml-export-listeners',label:'Export listeners as attributes'},{tag:'spacer',width:5},{tag:'checkbox',id:'checkbox-xml-strip-function',label:'and make functions inline; attribute prefix'},{tag:'spacer',width:5},{tag:'textbox',id:'textbox-xml-listener-prefix',style:'width:50px'}]},{tag:'checkbox',id:'checkbox-xml-expand-members',label:'Expand all \'members\' properties'}]},{tag:'hbox',height:80,width:140,align:'stretch',pack:'stretch',children:[{tag:'button',id:'button-xml-refresh',flex:1,label:'Refresh',tooltiptext:'Re-compute the XML',listeners:{command:function(){JUL.Designer.designer.refreshXml()}}}]}]},{tag:'textbox',id:'textbox-xml',readonly:true,width:'100%',multiline:true,flex:1}]};JUL.Designer.clipboardUi={tag:'dialog',id:'dialog-clipboard',title:'Clipboard',hidden:true,width:960,height:460,children:[{tag:'textbox',id:'textbox-clipboard-components',readonly:true,width:'100%',multiline:true,flex:1},{tag:'hbox',children:[{tag:'checkbox',id:'checkbox-paste-range',label:'for the next paste, use only the component indexes '},{tag:'textbox',id:'textbox-range-start',type:'number',disabled:true,min:-1,style:'width:50px'},{tag:'label',value:' to '},{tag:'textbox',id:'textbox-range-end',type:'number',disabled:true,min:-1,style:'width:50px'}]},{tag:'hbox',children:[{tag:'checkbox',id:'checkbox-map-class',label:'for the next paste, change components class(es) '},{tag:'textbox',id:'textbox-map-class-from',disabled:true,style:'width:200px',tooltiptext:'comma separated list of class names'},{tag:'label',value:' to '},{tag:'textbox',id:'textbox-map-class-to',disabled:true,style:'width:200px',tooltiptext:'comma separated list of class names'}]},{tag:'textbox',id:'textbox-clipboard-members',readonly:true,width:'100%',multiline:true,flex:1},{tag:'hbox',children:[{tag:'checkbox',id:'checkbox-paste-filter',label:'for the next paste, use only the specified members '},{tag:'textbox',id:'textbox-filter-members',disabled:true,style:'width:450px'}]},{tag:'description',id:'description-exclude-paste',style:'text-indent:17px;font-size:small;font-style:italic',value:'* special members won\'t be pasted over'}]};JUL.Designer.clipboardLogic={'checkbox-map-class':{listeners:{change:function(){var bCheck=this.getAttribute('checked')==='true';var oConfig=JUL.Designer.designer.currentParser;var oClipboard=JUL.Designer.designer.state.clipboard;var sClass=oConfig&&oClipboard.contentNodes?oClipboard.contentNodes[0].ui[oConfig.classProperty]||oConfig.defaultClass:'';ample.getElementById('textbox-map-class-from').setAttribute('disabled',!bCheck);ample.getElementById('textbox-map-class-to').setAttribute('disabled',!bCheck);ample.getElementById('textbox-map-class-from').setAttribute('value',bCheck?sClass:'');ample.getElementById('textbox-map-class-to').setAttribute('value',bCheck?oConfig?oConfig.defaultClass:'':'')}}},'checkbox-paste-filter':{listeners:{change:function(){var bCheck=this.getAttribute('checked')==='true';ample.getElementById('textbox-filter-members').setAttribute('disabled',!bCheck);if(bCheck){ample.getElementById('textbox-filter-members').focus();ample.getElementById('textbox-filter-members').blur()}else{ample.getElementById('textbox-filter-members').setAttribute('value','')}}}},'checkbox-paste-range':{listeners:{change:function(){var bCheck=this.getAttribute('checked')==='true';ample.getElementById('textbox-range-start').setAttribute('disabled',!bCheck);ample.getElementById('textbox-range-end').setAttribute('disabled',!bCheck);if(bCheck){ample.getElementById('textbox-range-start').focus();ample.getElementById('textbox-range-start').blur();ample.getElementById('textbox-range-end').focus();ample.getElementById('textbox-range-end').blur()}else{ample.getElementById('textbox-range-start').setAttribute('value','');ample.getElementById('textbox-range-end').setAttribute('value','')}}}},'dialog-clipboard':{listeners:{dialogaccept:function(){if(ample.getElementById('checkbox-paste-range').getAttribute('checked')==='true'){var nStart=parseInt(ample.getElementById('textbox-range-start').getAttribute('value'));var nEnd=parseInt(ample.getElementById('textbox-range-end').getAttribute('value'));if(!isNaN(nStart)&&!isNaN(nEnd)&&nStart>-1&&nStart<=nEnd){JUL.apply(JUL.Designer.designer.state.clipboard,{pasteStart:nStart,pasteEnd:nEnd})}else{delete JUL.Designer.designer.state.clipboard.pasteStart;delete JUL.Designer.designer.state.clipboard.pasteEnd}}if(ample.getElementById('checkbox-map-class').getAttribute('checked')==='true'){var sFrom=JUL.trim(ample.getElementById('textbox-map-class-from').getAttribute('value'));var sTo=JUL.trim(ample.getElementById('textbox-map-class-to').getAttribute('value'));if(sFrom&&sTo){sFrom=sFrom.split(',').map(JUL.trim);sTo=sTo.split(',').map(JUL.trim);JUL.Designer.designer.state.clipboard.mapClass={};for(var u=0;u<(sFrom.length<sTo.length?sFrom.length:sTo.length);u++){JUL.Designer.designer.state.clipboard.mapClass[sFrom[u]]=sTo[u]}}else{delete JUL.Designer.designer.state.clipboard.mapClass}}if(ample.getElementById('checkbox-paste-filter').getAttribute('checked')==='true'){var sVal=JUL.trim(ample.getElementById('textbox-filter-members').getAttribute('value'));if(sVal){JUL.Designer.designer.state.clipboard.pasteFilter=sVal.split(',').map(JUL.trim)}}else{delete JUL.Designer.designer.state.clipboard.pasteFilter}}}},'textbox-filter-members':{listeners:{blur:function(){var oContents=JUL.Designer.designer.state.clipboard.contentMembers||{};var aVal=JUL.trim(this.getAttribute('value'));if(aVal){aVal=aVal.split(',').map(JUL.trim);for(var i=0;i<aVal.length;i++){if(!aVal[i]||!oContents.hasOwnProperty(aVal[i])){aVal.splice(i,1);i--}}}else{aVal=[];for(var sItem in oContents){if(oContents.hasOwnProperty(sItem)){aVal.push(sItem)}}}this.setAttribute('value',aVal.join(', '))}}},'textbox-range-end':{listeners:{blur:function(){var aContents=JUL.Designer.designer.state.clipboard.contentNodes||[];var nVal=parseInt(this.getAttribute('value'));if(!aContents.length||isNaN(nVal)||nVal>aContents.length-1){nVal=aContents.length-1}else if(nVal<0){nVal=0}this.setAttribute('value',nVal);if(!aContents.length){return}var nStart=parseInt(ample.getElementById('textbox-range-start').getAttribute('value'));if(!isNaN(nVal)&&nStart>nVal){ample.getElementById('textbox-range-start').setAttribute('value',nVal)}}}},'textbox-range-start':{listeners:{blur:function(){var aContents=JUL.Designer.designer.state.clipboard.contentNodes||[];var nVal=parseInt(this.getAttribute('value'));if(!aContents.length||isNaN(nVal)||nVal<0){nVal=0}else if(nVal>aContents.length-1){nVal=aContents.length-1}this.setAttribute('value',nVal);if(!aContents.length){return}var nEnd=parseInt(ample.getElementById('textbox-range-end').getAttribute('value'));if(!isNaN(nEnd)&&nEnd<nVal){ample.getElementById('textbox-range-end').setAttribute('value',nVal)}}}}};JUL.apply(JUL.Designer,{columnBuilders:{code:function(oField,oWhere,sItem){oField.id='button-code-'+oField.id;this.state.map[oField.id]=new JUL.Ref({ref:oWhere,key:sItem,field:oField});var oConfig={tag:'listcell',children:[{tag:'button',id:oField.id,css:'field',label:'...',width:'100%',tooltiptext:oField.label,listeners:{command:function(){var oWhere=JUL.Designer.getWhere(this);JUL.Designer.showCode(oWhere)}}}]};if(oField.template){oConfig.children[0].tooltiptext=oConfig.children[0].tooltiptext+': '+oField.template}return oConfig},description:function(oField,oWhere,sItem){oField.id='button-desc-'+oField.id;this.state.map[oField.id]=new JUL.Ref({ref:oWhere,key:sItem,field:oField});return{tag:'listcell',children:[{tag:'button',css:'field',id:oField.id,label:'...',width:'100%',tooltiptext:oWhere[sItem]||'',listeners:{command:function(){var oWhere=JUL.Designer.getWhere(this);JUL.Designer.showComment(oWhere)}}}]}},value:function(oField,oWhere,sItem){this.state.map[oField.id]=new JUL.Ref({ref:oWhere,key:sItem,field:oField});return{tag:'listcell',children:[this.buildField(oField,oWhere[sItem])]}},other:function(oField,oWhere,sItem){var oConfig={tag:'listcell',css:'label-field',label:oField.label};if(oField.tooltip||oField.description){oConfig.tooltiptext=oField.tooltip||oField.description}return oConfig}},panels:{},parser:null,parserConfig:{defaultClass:'xul',useTags:true,customFactory:'JUL.UI.createDom',topDown:true,includeProperty:'_inc_',_usePrefixes:true,referencePrefix:'=_ref_:'},state:{map:{},lastId:1,lastDialog:null,browseType:'',currentObject:null,valueListeners:[]},addListener:function(oElement,sEvent,fListener,bCapture){if(oElement.addEventListener){oElement.addEventListener(sEvent,fListener,bCapture||false)}else if(oElement.attachEvent){oElement.attachEvent('on'+sEvent,fListener)}},addValueListener:function(oOwner,sItem,fListener,oScope){var oListener=new JUL.Ref({ref:oOwner,key:sItem,listener:fListener});if(typeof oScope==='object'){oListener.scope=oScope}this.state.valueListeners.push(oListener)},applyRequired:function(oFields,oWhere){for(var sItem in oFields){if(oFields.hasOwnProperty(sItem)&&oFields[sItem].required&&typeof oWhere[sItem]==='undefined'){oWhere[sItem]=oFields[sItem].defaultValue}}},buildField:function(oField,oValue){var bUndefined=!oField.required&&typeof oValue==='undefined';if(typeof oValue==='undefined'&&typeof oField.defaultValue!=='undefined'){oValue=oField.defaultValue}var sValue='';var oBuild={id:oField.id,css:'field',tag:'textbox',width:'100%'};if(JUL.typeOf(oValue)==='Date'){oBuild={tag:'hbox',id:oField.id,css:'field',children:[{tag:'datepicker',id:'datepicker-'+oField.id},{tag:'timepicker',id:'timepicker-'+oField.id}]};this.state.map[oBuild.children[0].id]=this.state.map[oField.id];this.state.map[oBuild.children[1].id]=this.state.map[oField.id];JUL.apply(oBuild.children[0],{value:bUndefined?'':oValue.getFullYear()+'-'+(101+oValue.getMonth()).toString().substr(1)+'-'+(100+oValue.getDate()).toString().substr(1),listeners:{blur:this.onDateBlur,focus:function(){JUL.Designer.state._lastFocus=this.getAttribute('id')},keypress:function(oEvent){if(oEvent.keyIdentifier==='Enter'){JUL.Designer.onDateBlur.call(this)}}}});JUL.apply(oBuild.children[1],{value:bUndefined?'':(100+oValue.getHours()).toString().substr(1)+':'+(100+oValue.getMinutes()).toString().substr(1)+':'+(100+oValue.getSeconds()).toString().substr(1),listeners:{blur:this.onTimeBlur,focus:function(){JUL.Designer.state._lastFocus=this.getAttribute('id')},keypress:function(oEvent){if(oEvent.keyIdentifier==='Enter'){JUL.Designer.onTimeBlur.call(this)}}}})}else if(typeof oValue==='object'||typeof oValue==='function'){oBuild.readonly=true;if(oValue&&['Array','Object'].indexOf(JUL.typeOf(oValue))>-1){var sObject=this.parser.obj2str({member:[oValue]});sValue=sObject.slice(sObject.indexOf('[')+1,sObject.lastIndexOf(']')).replace(/(\n|\t)/gm,'')}else{sValue=(oValue?oValue.toString().replace(JUL.UI._regExps.autoUseStrict,'$1'):'[object Null]').replace(/\n/gm,' ').replace(/\t/gm,'')}if(sValue.length>100){sValue=sValue.substr(0,100)+' ...'}oBuild.value=sValue}else if(typeof oValue==='boolean'){oBuild.tag='checkbox';oBuild.checked=oValue;oField.label='&nbsp;';delete oBuild.width}else if(typeof oValue==='number'){oBuild.type='number';oBuild.min=-Number.MAX_VALUE;oBuild.value=oValue}else{if(typeof oValue==='string'&&JUL.trim(oValue)===''){oBuild.value='String(\''+oValue+'\')';oBuild.readonly=true}else if(oValue){oBuild.value=oValue}}if(oBuild.tag==='textbox'&&typeof oValue!=='undefined'&&bUndefined){oBuild.css='field undef'}if(oBuild.tag==='checkbox'){oBuild.listeners={focus:function(){JUL.Designer.state._lastFocus=this.getAttribute('id')},blur:function(){delete JUL.Designer.state._lastFocus},change:function(){var oWhere=JUL.Designer.getWhere(this);var sValue=this.getAttribute('checked');oWhere.oldValue=oWhere.val();oWhere.val(sValue==='true');if(!oWhere.field.required&&oWhere.val()===oWhere.field.defaultValue){oWhere.del()}JUL.Designer.onValueUpdated(oWhere)}}}if(oBuild.tag==='textbox'&&!oBuild.readonly){oBuild.listeners={blur:JUL.Designer.onBlur,focus:function(){JUL.Designer.state._lastFocus=this.getAttribute('id');if(this.getAttribute('readonly')!=='true'&&this.getAttribute('class')==='field undef'){this.setAttribute('value','');JUL.Designer.replaceDom(this,function(){this.setAttribute('class','field')})}},keypress:function(oEvent){if(oEvent.keyIdentifier==='Enter'){JUL.Designer.onBlur.call(this)}}}}return oBuild},cancelCode:function(){this.panels.code.hide();this.showLast()},cancelComment:function(){this.panels.comment.hide();this.showLast()},cleanMap:function(){for(var sItem in this.state.map){if(this.state.map.hasOwnProperty(sItem)&&!ample.getElementById(sItem)){delete this.state.map[sItem]}}},doCmd:function(){if(!window.location.search){return}var aCmd=window.location.search.split('?').pop().split('&');for(var i=0;i<aCmd.length;i++){var aItem=aCmd[i].split('=');if(aItem.length<2){aItem[1]=''}aItem=aItem.map(window.decodeURIComponent);switch(aItem[0]){case'oa':this.app.open(aItem[1]);break;case'op':this.designer.open(aItem[1]);break;case'of':this.framework.open(aItem[1]);break}}},empty:function(oEl,bRemove){if(!oEl){return}if(!isNaN(oEl.length)){ample.query(oEl).each(function(){JUL.Designer.empty(this,bRemove)});return}while(oEl.lastChild){this.empty(oEl.lastChild);oEl.removeChild(oEl.lastChild)}if(bRemove){oEl.parentNode.removeChild(oEl)}},fillBrowseList:function(){this.empty(ample.getElementById('listbox-browse').body);ample.get('assets/'+this.state.browseType+'s.txt',{ts:(new Date).getTime()},function(oResponse){oResponse=JSON.parse(oResponse);if(oResponse.error){window.alert(oResponse.error);return}var oBody=ample.query('#listbox-browse>xul|listbody').get(0);for(var i=0;i<oResponse.result.length;i++){var sId='item-'+JUL.Designer.state.lastId++;JUL.Designer.state.map[sId]=oResponse.result[i][0];oBody.appendChild(JUL.Designer.parser.createComponent({tag:'listitem',id:sId,children:[JUL.Designer.parser.createComponent({tag:'listcell',css:'label-field',label:oResponse.result[i][0]}),JUL.Designer.parser.createComponent({tag:'listcell',css:'label-field',label:oResponse.result[i][1]})]}))}})},fillListbox:function(sId,oFields,oWhere,aWhat,bEditProperties){var oBody=ample.query('#'+sId+'>xul|listbody');if(!oBody.length){return}if(!aWhat){aWhat=['label','value','code']}oBody=oBody.get(0);var aConfigs=[];for(var sItem in oFields){if(oFields.hasOwnProperty(sItem)){var oOrig=oFields[sItem];if(typeof oWhere[sItem]==='undefined'&&oOrig.required){oWhere[sItem]=typeof oOrig.defaultValue!=='undefined'?oOrig.defaultValue:null}var sFieldId=oOrig.id;if(!sFieldId){sFieldId='field-'+this.state.lastId++}var aCells=[];for(var c=0;c<aWhat.length;c++){var oField=JUL.apply({id:sFieldId,label:sItem},oOrig);if(oField.required&&typeof oField.defaultValue==='undefined'){oField.defaultValue=null}var fBuilder=this.columnBuilders[aWhat[c]];var sProperty=false;if(bEditProperties){var aParts=aWhat[c].split('-');if(aParts.length>1&&this.columnBuilders[aParts[0]]){sProperty=aParts[1];oField={id:sFieldId+'-'+sProperty.toLowerCase(),label:sItem+' - '+sProperty};if(oOrig[sProperty]&&typeof oOrig[sProperty]==='object'){JUL.apply(oField,oOrig[sProperty])}fBuilder=this.columnBuilders[aParts[0]]}}if(!fBuilder){fBuilder=this.columnBuilders.other}aCells.push(fBuilder.call(this,oField,sProperty?oWhere[sItem]:oWhere,sProperty||sItem))}sId='item-'+sFieldId;this.state.map[sId]=sItem;aConfigs.push({tag:'listitem',id:sId,children:aCells})}}var aRoot=this.parser.create(aConfigs);for(var i=0;i<aConfigs.length;i++){oBody.appendChild(aRoot[i])}},filterTab:function(oEvent){if(oEvent.keyIdentifier==='U+0009'){oEvent.preventDefault();var oEl=this.$getContainer('input');if(!oEl){return false}try{var nStart=oEl.selectionStart||0;var nEnd=oEl.selectionEnd||0;var sValue=this.getAttribute('value');this.setAttribute('value',sValue.slice(0,nStart)+'\t'+sValue.substr(nEnd));oEl.selectionEnd=nStart+1;oEl.selectionStart=nStart+1}catch(e){}return false}},getWhere:function(oElement){if(typeof oElement==='string'){return this.state.map[oElement]}else{return this.state.map[oElement.getAttribute('id')]}},init:function(){this.parser=new JUL.UI.Parser(this.parserConfig);this.panels={designer:this.parser.create(this.designer.ui,this.designer.logic),project:this.parser.create(this.designer.projectUi,this.designer.projectLogic),app:this.parser.create(this.app.ui,this.app.logic),framework:this.parser.create(this.framework.ui,this.framework.logic),code:this.parser.create(this.codeUi),comment:this.parser.create(this.commentUi),browse:this.parser.create(this.browseUi),js:this.parser.create(this.jsUi),clipboard:this.parser.create(this.clipboardUi,this.clipboardLogic),xml:this.parser.create(this.xmlUi),help:this.parser.create(this.help.ui),about:this.parser.create(this.about.ui)};for(var sItem in this.panels){if(this.panels.hasOwnProperty(sItem)){ample.documentElement.appendChild(this.panels[sItem]);if(sItem==='about'||sItem==='designer'){continue}this.panels[sItem].addEventListener('windowhidden',function(){var oDesigner=JUL.Designer;if(oDesigner.designer.current.ns&&!oDesigner.state.lastDialog){ample.getElementById('deck-test').setAttribute('selectedIndex',0)}});this.panels[sItem].addEventListener('windowshown',function(){ample.getElementById('deck-test').setAttribute('selectedIndex',1)})}}this.restorePrefs();ample.getElementById('statusbarpanel-main').setAttribute('label',this.title+' version '+this.version);ample.getElementById('deck-test').setAttribute('selectedIndex',1);setTimeout(function(){JUL.Designer.panels.about.showModal()},500);setTimeout(function(){JUL.Designer.panels.about.hide()},5e3);ample.getElementById('table-add-component').lastChild.selectItem=function(){};ample.documentElement.addEventListener('keydown',function(oEvent){if(oEvent.keyIdentifier==='U+001B'&&oEvent.target.nodeName==='xul:dialog'){var sId=oEvent.target.getAttribute('id');if(['dialog-app','dialog-code','dialog-comment','dialog-project','dialog-framework'].indexOf(sId)>-1){oEvent.stopPropagation()}}},true);ample.getElementById('table-add-component').lastChild.selectItem=function(){};ample.getElementById('listbox-app-modules').addEventListener('click',function(oEvent){if(oEvent.target.nodeName==='xul:listheader'){oEvent.stopPropagation()}},true);this.addListener(document.getElementById('iframe-test'),'load',JUL.Designer.designer.onTestLoad);this.addListener(document.getElementById('iframe-help'),'load',JUL.Designer.help.onLoad);try{ample.getElementById('textbox-code').$getContainer('input').wrap='off';ample.getElementById('textbox-js').$getContainer('input').wrap='off';ample.getElementById('textbox-xml').$getContainer('input').wrap='off';ample.getElementById('textbox-clipboard-components').$getContainer('input').wrap='off';ample.getElementById('textbox-clipboard-members').$getContainer('input').wrap='off';ample.getElementById('textbox-project-template').$getContainer('input').wrap='off';ample.getElementById('textbox-app-js').$getContainer('input').wrap='off';ample.getElementById('textbox-app-template').$getContainer('input').wrap='off'}catch(oException){}this.doCmd()},isEmpty:function(oConfig){var n=0;for(var sItem in oConfig){if(oConfig.hasOwnProperty(sItem)){n++}}return!n},jsonReviver:function(sKey,oValue){if(sKey&&typeof oValue==='string'){var bPrefix=false;if(this._usePrefixes){for(var sItem in this._jsonPrefixes){if(this._jsonPrefixes.hasOwnProperty(sItem)&&oValue.substr(0,this._jsonPrefixes[sItem].length)===this._jsonPrefixes[sItem]&&JUL.trim(oValue.substr(this._jsonPrefixes[sItem].length))){bPrefix=true;oValue=oValue.substr(this._jsonPrefixes[sItem].length).replace(/^\s+/,'');break}}}if(bPrefix||!this._usePrefixes&&(this._regExps.regexp.test(oValue)||this._regExps.functionStart.test(oValue)||this._regExps.newStart.test(oValue))){try{return eval('(function(){return('+oValue+')})()')}catch(e){return oValue}}}return oValue},keySort:function(oConfig,aAtEnd,aAtStart,bSelf){var aProperties=[];var aArrays=[];var aObjects=[];var aMethods=[];aAtEnd=aAtEnd||[];aAtStart=aAtStart||[];var oTemp=bSelf?{}:oConfig;for(var sItem in oConfig){if(oConfig.hasOwnProperty(sItem)){if(aAtEnd.indexOf(sItem)<0&&aAtStart.indexOf(sItem)<0){var sType=JUL.typeOf(oConfig[sItem]);switch(sType){case'Array':aArrays.push(sItem);break;case'Object':aObjects.push(sItem);break;case'Function':aMethods.push(sItem);break;default:aProperties.push(sItem)}}if(bSelf){oTemp[sItem]=oConfig[sItem];delete oConfig[sItem]}}}var aKeys=[].concat(aAtStart,aProperties.sort(),aArrays.sort(),aObjects.sort(),aMethods.sort(),aAtEnd);var oNew=bSelf?oConfig:{};for(var i=0;i<aKeys.length;i++){var sKey=aKeys[i];if(typeof oTemp[sKey]!=='undefined'){oNew[sKey]=oTemp[sKey]}}return oNew},makeCompat:function(oResult,sResponse){if(!oResult.result.version||oResult.result.version.substr(0,2)==='0.'){this.parser._usePrefixes=false;JUL.apply(oResult,JSON.parse(sResponse,JUL.makeCaller(this.parser,this.jsonReviver)));this.parser._usePrefixes=true}},onBlur:function(oEvent){if(oEvent){delete JUL.Designer.state._lastFocus}if(this.getAttribute('readonly')==='true'||this.getAttribute('class')==='field undef'){return}var oWhere=JUL.Designer.getWhere(this);var sValue=this.getAttribute('value');if(this.getAttribute('type')==='number'&&sValue){sValue=parseFloat(sValue);if(isNaN(sValue)){sValue=oWhere.val();if(typeof sValue==='undefined'){sValue=''}}this.setAttribute('value',sValue)}if(sValue===''&&!oWhere.field.required){if(typeof oWhere.val()!=='undefined'){oWhere.oldValue=oWhere.val();oWhere.del();JUL.Designer.onValueUpdated(oWhere)}if(oEvent&&typeof oWhere.field.defaultValue!=='undefined'){if(typeof oWhere.oldValue===typeof oWhere.field.defaultValue){this.setAttribute('value',oWhere.field.defaultValue);JUL.Designer.replaceDom(this,function(){this.setAttribute('class','field undef')})}else{JUL.Designer.replaceDom(this,JUL.Designer.parser.createComponent(JUL.Designer.buildField(oWhere.field)))}}return}if(oWhere.field.required&&sValue===''){sValue=oWhere.field.defaultValue}if(oWhere.val()!==sValue){oWhere.oldValue=oWhere.val();oWhere.val(sValue);JUL.Designer.onValueUpdated(oWhere)}if(oEvent){if(typeof oWhere.oldValue===typeof sValue){this.setAttribute('value',sValue)}else{JUL.Designer.replaceDom(this,JUL.Designer.parser.createComponent(JUL.Designer.buildField(oWhere.field,sValue)))}}},onDateBlur:function(oEvent){if(oEvent){delete JUL.Designer.state._lastFocus}var sId=this.getAttribute('id');var oWhere=JUL.Designer.getWhere(sId);var oVal=oWhere.val();var sVal=this.$getContainer('input').value;if(sVal&&!/^\d{4}\W\d{2}\W\d{2}$/.test(sVal)){this.setAttribute('value',oVal?oVal.getFullYear()+'-'+(101+oVal.getMonth()).toString().substr(1)+'-'+(100+oVal.getDate()).toString().substr(1):'');return}this.setAttribute('value',sVal?sVal.substr(0,4)+'-'+sVal.substr(5,2)+'-'+sVal.substr(8,2):'');oWhere.field.oldValue=oVal;if(sVal){var oDate=oVal?new Date(oVal.getTime()):new Date(1980,0);if(!oVal){ample.getElementById('timepicker'+sId.substr(10)).setAttribute('value','00:00:00')}oDate.setFullYear(parseInt(sVal.substr(0,4)));oDate.setMonth(parseInt(sVal.substr(5,2))-1);oDate.setDate(parseInt(sVal.substr(8,2)));oWhere.val(oDate)}else{ample.getElementById('timepicker'+sId.substr(10)).setAttribute('value','');if(oWhere.field.required){oWhere.val(oWhere.field.defaultValue)}else{oWhere.del()}}JUL.Designer.onValueUpdated(oWhere)},onTimeBlur:function(oEvent){if(oEvent){delete JUL.Designer.state._lastFocus}var sId=this.getAttribute('id');var oWhere=JUL.Designer.getWhere(sId);var oVal=oWhere.val();var sVal=this.$getContainer('input').value;if(sVal&&!/^\d{2}\W\d{2}\W\d{2}$/.test(sVal)){this.setAttribute('value',oVal?(100+oVal.getHours()).toString().substr(1)+':'+(100+oVal.getMinutes()).toString().substr(1)+':'+(100+oVal.getSeconds()).toString().substr(1):'');return}if(!sVal){sVal='00:00:00'}this.setAttribute('value',sVal.substr(0,2)+':'+sVal.substr(3,2)+':'+sVal.substr(6,2));oWhere.field.oldValue=oVal;var oDate=oVal?new Date(oVal.getTime()):new Date(1980,0);if(!oVal){ample.getElementById('datepicker'+sId.substr(10)).setAttribute('value','1980-01-01')}oDate.setHours(parseInt(sVal.substr(0,2)));oDate.setMinutes(parseInt(sVal.substr(3,2)));oDate.setSeconds(parseInt(sVal.substr(6,2)));oWhere.val(oDate);JUL.Designer.onValueUpdated(oWhere)},onValueUpdated:function(oWhere){for(var i=0;i<this.state.valueListeners.length;i++){var oListener=this.state.valueListeners[i];if(oListener.ref()===oWhere.ref()&&(!oListener.key()||oListener.key()===oWhere.key())){oListener.listener.call(oListener.scope||oWhere.ref(),oWhere)}}},removeValueListener:function(oOwner,sItem,fListener){for(var i=0;i<this.state.valueListeners.length;i++){var oListener=this.state.valueListeners[i];if(oListener.ref()===oOwner&&(!sItem||oListener.key()===sItem)&&(!fListener||oListener.listener===fListener)){this.state.valueListeners.splice(i,1);i--}}},replaceDom:function(oOld,oNew){var fChange=false;if(typeof oNew==='function'){fChange=oNew;oNew=oOld}var oParent=oOld.parentNode;var oNext=oOld.nextSibling;if(oNew!==oOld){this.empty(oOld)}oParent.removeChild(oOld);if(fChange){fChange.call(oNew,oParent,oNext)}if(oNext){oParent.insertBefore(oNew,oNext)}else{oParent.appendChild(oNew)}},restorePrefs:function(){try{var oRestore=JSON.parse(ample.cookie('jul-designer-prefs'))}catch(e){return}if(!oRestore||typeof oRestore!=='object'){return}for(var sItem in this._prefs){if(this._prefs.hasOwnProperty(sItem)&&oRestore[sItem]){var aEl=ample.query(sItem);var aItems=oRestore[sItem];for(var k=0;k<aEl.length&&k<aItems.length;k++){var oEl=aEl.get(k);var aPrefs=[].concat(this._prefs[sItem]);for(var i=0;i<aPrefs.length;i++){var sPref=aPrefs[i];if(typeof aItems[k][sPref]!=='undefined'){oEl.setAttribute(sPref,aItems[k][sPref])}}}}}},saveCode:function(){var sText=JUL.trim(ample.getElementById('textbox-code').getAttribute('value'));var oCurrent=this.state.currentObject;oCurrent.oldValue=oCurrent.val();if(sText){try{oCurrent.val(eval('(function(){return('+sText+')})()'))}catch(e){window.alert(e.description||e.message);return}}else{oCurrent.del()}JUL.Designer.onValueUpdated(oCurrent);var oTwin=this.state.map[oCurrent.field.id.substr(12)];if(oTwin){var oField=ample.getElementById(oTwin.field.id);if(oField){JUL.Designer.replaceDom(oField,this.parser.create(this.buildField(oTwin.field,oTwin.val())))}}this.panels.code.hide();this.showLast()},saveComment:function(){var sText=JUL.trim(ample.getElementById('textbox-comment').getAttribute('value'));var oCurrent=this.state.currentObject;if(sText){oCurrent.val(sText)}else{oCurrent.del()}ample.getElementById(oCurrent.field.id).setAttribute('tooltiptext',sText);this.panels.comment.hide();this.showLast()},savePrefs:function(){var oSave={};for(var sItem in this._prefs){if(this._prefs.hasOwnProperty(sItem)){var aEl=ample.query(sItem);var aItems=[];if(aEl.length){oSave[sItem]=aItems}for(var k=0;k<aEl.length;k++){var oEl=aEl.get(k);oEl.getBoundingClientRect();var aPrefs=[].concat(this._prefs[sItem]);aItems[k]={};for(var i=0;i<aPrefs.length;i++){var sPref=aPrefs[i];var sAttr=oEl.getAttribute(sPref);if(sAttr&&sAttr!=='0'){aItems[k][sPref]=sAttr}}}}}ample.cookie('jul-designer-prefs',JSON.stringify(oSave),{expires:7,path:'/'});return oSave},showCode:function(oWhere){var sIitle=oWhere.field.label+(oWhere.field.required?'*':'');if(oWhere.field.template){sIitle=sIitle+': '+oWhere.field.template.substr(0,100);if(oWhere.field.template.length>100){sIitle=sIitle+' ...'}}this.panels.code.setAttribute('title',sIitle);this.state.currentObject=oWhere;var oValue=oWhere.val();var sPrefix='';if(typeof oValue==='undefined'&&typeof oWhere.field.defaultValue!=='undefined'){oValue=oWhere.field.defaultValue;sPrefix='/* value is undefined - default pasted */\n'}var sObject=this.parser.obj2str({o:oValue});var sText=sObject.slice(sObject.indexOf(':')+1,sObject.lastIndexOf('}')).replace(/\n\t/gm,'\n');ample.getElementById('textbox-code').setAttribute('value',typeof oValue==='undefined'?'':sPrefix+JUL.trim(sText));if(this.state.lastDialog){this.state.lastDialog.hide()}this.panels.code.showModal();setTimeout(function(){ample.getElementById('textbox-code').focus()},500)},showComment:function(oWhere){this.panels.comment.setAttribute('title',oWhere.field.label);this.state.currentObject=oWhere;var oValue=oWhere.val();ample.getElementById('textbox-comment').setAttribute('value',oValue||'');if(this.state.lastDialog){this.state.lastDialog.hide()}this.panels.comment.showModal();setTimeout(function(){ample.getElementById('textbox-comment').focus()},500)},showLast:function(){if(this.state.lastDialog){this.state.lastDialog.showModal()}if(this.state.lastDialog===this.panels.framework){setTimeout(function(){JUL.Designer.framework.scrollLists()},500)}},validNS:function(sNS){var aNS=sNS.split('.');for(var i=0;i<aNS.length;i++){if(!JUL.UI._regExps.variable.test(aNS[i])){return false}}return true},_prefs:{'#command-show-add':'checked','#command-show-menu':'checked','#command-show-status':'checked','#dialog-app':['width','height'],'#dialog-browse':['width','height'],'#dialog-clipboard':['width','height'],'#dialog-code':['width','height'],'#dialog-comment':['width','height'],'#dialog-framework':['width','height'],
'#dialog-help':['width','height'],'#dialog-js':['width','height'],'#dialog-project':['width','height'],'#dialog-xml':['width','height'],'#listbox-app-modules xul|listheader':'width','#listbox-app-parser xul|listheader':'width','#listbox-app-settings xul|listheader':'width','#listbox-designer-listeners xul|listheader':'width','#listbox-designer-logic xul|listheader':'width','#listbox-designer-ui xul|listheader':'width','#listbox-framework-component-events xul|listheader':'width','#listbox-framework-component-members xul|listheader':'width','#listbox-framework-component-settings':'height','#listbox-framework-component-settings xul|listheader':'width','#listbox-framework-components xul|listheader':'width','#listbox-framework-settings xul|listheader':'width','#listbox-project-parser xul|listheader':'width','#listbox-project-settings xul|listheader':'width','#menubar-app':'hidden','#statusbar-app':'hidden','#tree-interface':'height','#tree-interface xul|treecol':'width','#vbox-add-component':'hidden','#vbox-framework-components':'width','#vbox-project':'width'}});window.onbeforeunload=function(oEvent){JUL.Designer.savePrefs();if(JUL.Designer.state.oTestWnd&&!JUL.Designer.state.oTestWnd.closed){JUL.Designer.state.oTestWnd.close()}if(JUL.Designer.state.oTestAppWnd&&!JUL.Designer.state.oTestAppWnd.closed){JUL.Designer.state.oTestAppWnd.close()}try{JUL.Designer.designer.checkSave('exit')}catch(e){}if(JUL.Designer.designer.state.notSaved){return'Unsaved changes to the project will be discarded when you leave the page'}};JUL.apply(ample.classes[JUL.UI.xmlNS.xul+'#listcell'].prototype,{$getTagOpen:function(){var oHeader=this.parentNode.parentNode.parentNode.firstChild.childNodes[this.parentNode.childNodes.$indexOf(this)];var sHtml='<td class="xul-listcell'+(this.hasAttribute("class")?" "+this.getAttribute("class"):"")+'"'+(oHeader&&oHeader.getAttribute("hidden")==="true"?' style="display:none;"':'')+'><div class="xul-listcell--box" style=""><div class="xul-listcell--label xul-listcell--gateway" style="">';if(this.hasAttribute("image")){sHtml+='<img src="'+ample.$encodeXMLCharacters(this.getAttribute("image"))+'" align="absmiddle"/> '}if(this.hasAttribute("label")){sHtml+=ample.$encodeXMLCharacters(this.getAttribute("label"))}return sHtml},$getTagClose:function(){return'</div></div></td>'}})})();(function(){'use strict';JUL.ns('JUL.Designer.app');JUL.Designer.app.ui={tag:'dialog',id:'dialog-app',title:'Application',width:980,height:470,hidden:true,children:[{tag:'tabbox',children:[{tag:'tabs',id:'tabs-app',children:[{tag:'tab',label:'Settings',width:80,pack:'center'},{tag:'tab',label:'Default parser',width:80,pack:'center'},{tag:'tab',label:'Modules',id:'tab-app-modules',width:80,pack:'center'},{tag:'tab',label:'JavaScript',id:'tab-app-js',width:80,pack:'center'},{tag:'tab',label:'Template',width:80,pack:'center'}]}]},{tag:'deck',id:'deck-app',flex:1,children:[{tag:'vbox',flex:1,children:[{tag:'listbox',flex:1,id:'listbox-app-settings',children:[{tag:'listhead',children:[{tag:'listheader',label:'Setting',width:250},{tag:'listheader',label:'Value',width:380},{tag:'listheader',label:'Code',width:40}]},{tag:'listbody'}]}]},{tag:'vbox',flex:1,children:[{tag:'listbox',flex:1,id:'listbox-app-parser',children:[{tag:'listhead',children:[{tag:'listheader',label:'Member',width:250},{tag:'listheader',label:'Value',width:380},{tag:'listheader',label:'Code',width:40}]},{tag:'listbody'}]}]},{tag:'vbox',flex:1,children:[{tag:'toolbar',children:[{tag:'toolbargrippy'},{tag:'toolbarbutton',label:'Add',id:'button-add-module',type:'menu-button',children:[{tag:'menupopup',children:[{tag:'menuitem',id:'menuitem-add-current-project',label:'Add current project'}]}]},{tag:'toolbarseparator'},{tag:'toolbarbutton',label:'Up',id:'button-up-module'},{tag:'toolbarseparator'},{tag:'toolbarbutton',label:'Down',id:'button-down-module'},{tag:'toolbarseparator'},{tag:'toolbarbutton',label:'Remove',id:'button-remove-modules'},{tag:'toolbarseparator'},{tag:'toolbarbutton',label:'Change',id:'button-change-module'},{tag:'toolbarseparator'},{tag:'hbox',width:'95%',children:[{tag:'textbox',id:'textbox-module-name',style:'width:300px;margin-top:6px',tooltiptext:'Module name'}]}]},{tag:'listbox',flex:1,id:'listbox-app-modules',children:[{tag:'listhead',children:[{tag:'listheader',label:'Module',width:220},{tag:'listheader',label:'Namespace',width:330},{tag:'listheader',label:'Description',width:140}]},{tag:'listbody'}]}]},{tag:'vbox',flex:1,children:[{tag:'textbox',id:'textbox-app-js',readonly:true,width:'100%',multiline:true,flex:1}]},{tag:'vbox',flex:1,children:[{tag:'description',value:'Testing HTML page. Besides {jul_script}, {app_script} and {modules_scripts}, all {app_<property>} properties are available; page timestamp {ts}.'},{tag:'textbox',id:'textbox-app-template',width:'100%',multiline:true,flex:1}]}]}]};JUL.Designer.app.logic={'button-add-module':{listeners:{command:function(){if(this.getAttribute('open')==='true'){return}JUL.Designer.app.addModule()}}},'button-change-module':{listeners:{command:function(){JUL.Designer.app.changeModule()}}},'button-down-module':{listeners:{command:function(){JUL.Designer.app.shiftModule()}}},'button-remove-modules':{listeners:{command:function(){JUL.Designer.app.removeModules()}}},'button-up-module':{listeners:{command:function(){JUL.Designer.app.shiftModule(true)}}},'dialog-app':{listeners:{dialogaccept:function(){JUL.Designer.app.save();JUL.Designer.cleanMap();return false},dialogcancel:function(){JUL.Designer.app.cancel();JUL.Designer.cleanMap();return false}}},'listbox-app-modules':{listeners:{select:function(){var oSelected=this.selectedItems;var oItem=oSelected.length?oSelected.item(oSelected.length-1):null;ample.getElementById('textbox-module-name').setAttribute('value',oItem?JUL.Designer.getWhere(oItem):'')}}},'menuitem-add-current-project':{listeners:{command:function(){JUL.Designer.app.addProject()}}},'tabs-app':{listeners:{select:function(){if(this.parentNode.selectedTab.getAttribute('id')==='tab-app-js'){setTimeout(function(){JUL.Designer.app.fillJs()},100)}ample.getElementById('deck-app').setAttribute('selectedIndex',this.parentNode.selectedIndex)}}},'textbox-app-template':{listeners:{keydown:'JUL.Designer.filterTab',blur:function(){JUL.Designer.app.state.newApp.template=JUL.trim(this.getAttribute('value'))}}},'textbox-module-name':{listeners:{keypress:function(oEvent){if(oEvent.keyIdentifier==='Enter'){var oItems=ample.getElementById('listbox-app-modules').selectedItems;if(oItems.length&&!oEvent.shiftKey){JUL.Designer.app.changeModule()}else{JUL.Designer.app.addModule()}}}}}};JUL.apply(JUL.Designer.app,{current:{},fields:{title:{tooltip:'Application\'s title',id:'setting-app-title',defaultValue:'Application 1',required:true,template:'<string>'},ns:{tooltip:'Namespace path',id:'setting-app-ns',defaultValue:'app1',required:true,template:'<string>'},init:{tooltip:'Application instantiation method',id:'setting-app-init',template:' function() { ... }',required:true,defaultValue:function(){for(var sItem in this.modules){if(this.modules.hasOwnProperty(sItem)){var sNS=this.modules[sItem].ns;if(sNS.substr(0,1)==='.'){sNS=this.ns+sNS}var oModule=JUL.get(sNS);if(!oModule){continue}var oParser=new JUL.UI.Parser(oModule.parserConfig);oParser.create(oModule.ui,oModule.logic)}}}},preferredFramework:{tooltip:'If supplied, will act as the suggested framework for new projects',id:'setting-app-framework',template:'<string>'}},parserFields:null,state:{currentOperation:'',newApp:null},addModule:function(oInit){var oModules=this.state.newApp.modules;var nLast=1;var sName=JUL.trim(ample.getElementById('textbox-module-name').getAttribute('value'));if(!sName||oModules[sName]){while((sName='module'+nLast++)&&oModules[sName]){}}ample.getElementById('textbox-module-name').setAttribute('value','');oModules[sName]=JUL.apply({ns:'.'+sName},oInit||{});var oFields={};oFields[sName]={ns:{required:true,defaultValue:oModules[sName].ns}};JUL.Designer.fillListbox('listbox-app-modules',oFields,oModules,['label','value-ns','description-description'],true);ample.getElementById('listbox-app-modules').querySelector('xul|listbody').lastChild.scrollIntoView();ample.getElementById('listbox-app-modules').clearSelection()},addProject:function(){var oProject=JUL.Designer.designer.current;if(!oProject.ns){return}var oInit={ns:oProject.ns,description:oProject.title};var oApp=this.state.newApp;if(oInit.ns.substr(0,oApp.ns.length+1)===oApp.ns+'.'){oInit.ns=oInit.ns.substr(oApp.ns.length)}var sName=JUL.trim(ample.getElementById('textbox-module-name').getAttribute('value'));if(!sName){ample.getElementById('textbox-module-name').setAttribute('value',oProject.ns.split('.').pop())}this.addModule(oInit)},cancel:function(){this.state.newApp=null;JUL.Designer.panels.app.hide();JUL.Designer.state.lastDialog=null},changeModule:function(){var oSelected=ample.getElementById('listbox-app-modules').selectedItems;if(!oSelected.length){window.alert('Please select an item');return}var oItem=oSelected.item(oSelected.length-1);var sItem=JUL.Designer.getWhere(oItem);var oModules=this.state.newApp.modules;var sName=JUL.trim(ample.getElementById('textbox-module-name').getAttribute('value'));if(!sName||sName===sItem||oModules[sName]){ample.getElementById('textbox-module-name').setAttribute('value',sItem);return}oModules[sName]=oModules[sItem];delete oModules[sItem];JUL.Designer.state.map[oItem.getAttribute('id')]=sName;oItem.firstChild.setAttribute('label',sName);var oNode=oItem.childNodes[1];while(oNode){var oWhere=JUL.Designer.getWhere(oNode.firstChild);oWhere.field.label=sName+' - '+oWhere.key();if(oWhere.key()==='ns'){oWhere.field.defaultValue='.'+sName}oNode=oNode.nextSibling}ample.getElementById('listbox-app-modules').clearSelection()},cleanApp:function(oApp){oApp=JUL.apply({},oApp);JUL.Designer.applyRequired(this.fields,oApp);JUL.Designer.applyRequired(this.parserFields,oApp.defaultParser);oApp=JUL.Designer.keySort(oApp,['modules','defaultParser','template']);var aSort=[];var oNode=ample.getElementById('listbox-app-modules').querySelector('xul|listbody').firstChild;while(oNode){aSort.push(JUL.Designer.getWhere(oNode));oNode=oNode.nextSibling}oApp.modules=JUL.Designer.keySort(oApp.modules,aSort);return oApp},close:function(){this.current={};this.onSwitchCurrent()},del:function(){if(!this.current.ns){window.alert('There is no current application');return}if(!window.confirm('Are you sure to permanently delete \''+this.current.title+'\' app?')){return}ample.get('assets/alter.txt',{ts:(new Date).getTime()},function(sResponse){sResponse=JSON.parse(sResponse);if(sResponse.error){window.alert(sResponse.error)}else{JUL.Designer.app.close()}})},downloadUrl:function(){return'#'},fillJs:function(){var oScript=this.cleanApp(this.state.newApp);delete oScript.template;ample.getElementById('textbox-app-js').setAttribute('value',this.testJs(oScript,true))},fillMenupopup:function(bSelectOnly){var oPopup=ample.getElementById('menupopup-switch-module');var oPopupButton=ample.getElementById('menupopup-switch-module-button');var oModules=this.current.modules;if(!bSelectOnly){JUL.Designer.empty(oPopup);JUL.Designer.empty(oPopupButton);if(!this.current.ns){return}var n=1;for(var sItem in oModules){if(oModules.hasOwnProperty(sItem)){var oConfig={tag:'menuitem',id:'menuitem-switch-module-'+n,type:'radio',label:sItem,listeners:{command:function(){JUL.Designer.app.fillMenupopup(true);JUL.Designer.app.switchModule(JUL.Designer.getWhere(this))}},parent:oPopup};JUL.Designer.state.map[oConfig.id]=sItem;if(oModules[sItem].description){oConfig.tooltiptext=oModules[sItem].description}JUL.Designer.parser.createComponent(oConfig);oConfig.id='menubutton-switch-module-'+n;oConfig.parent=oPopupButton;JUL.Designer.state.map[oConfig.id]=sItem;JUL.Designer.parser.createComponent(oConfig);n++}}}if(this.state.radioTimer){clearTimeout(this.state.radioTimer)}this.state.radioTimer=setTimeout(function(){delete JUL.Designer.app.state.radioTimer;var n=1;for(var sItem in oModules){if(oModules.hasOwnProperty(sItem)){var sNS=oModules[sItem].ns;if(sNS.substr(0,1)==='.'){sNS=JUL.Designer.app.current.ns+sNS}ample.getElementById('menuitem-switch-module-'+n).setAttribute('checked',sNS===JUL.Designer.designer.current.ns);ample.getElementById('menubutton-switch-module-'+n).setAttribute('checked',sNS===JUL.Designer.designer.current.ns);n++}}},100)},onSwitchCurrent:function(){JUL.Designer.designer.setTitle();ample.getElementById('anchor-test-app').setAttribute('href',this.current.ns?this.testUrl():'#');ample.getElementById('anchor-download-app').setAttribute('href',this.current.ns?this.downloadUrl():'#');if(JUL.Designer.state.oTestAppWnd&&!JUL.Designer.state.oTestAppWnd.closed){JUL.Designer.state.oTestAppWnd.close()}this.fillMenupopup()},open:function(sItem){ample.get('assets/apps/'+sItem.split('.').join('/')+'.txt',{ts:(new Date).getTime()},function(sResponse){var oResult=JSON.parse(sResponse,JUL.makeCaller(JUL.Designer.parser,JUL.Designer.jsonReviver));if(oResult.error){window.alert(oResult.error);return}JUL.Designer.makeCompat(oResult,sResponse);var oApp=JUL.Designer.app;JUL.Designer.panels.browse.hide();oApp.current=oResult.result;oApp.onSwitchCurrent();setTimeout(function(){for(var sItem in oApp.current.modules){if(oApp.current.modules.hasOwnProperty(sItem)){oApp.switchModule(sItem);break}}},100)})},removeModules:function(){var oSelected=ample.getElementById('listbox-app-modules').selectedItems;if(!oSelected.length){window.alert('Please select some items');return}var oModules=this.state.newApp.modules;for(var i=oSelected.length-1;i>=0;i--){var sItem=JUL.Designer.getWhere(oSelected.item(i));delete oModules[sItem]}JUL.Designer.empty(oSelected,true)},save:function(){var oApp=this.state.currentOperation==='save'?this.current:this.state.newApp;if(!JUL.Designer.validNS(oApp.ns)){window.alert('Invalid namespace');return}oApp.version='1.'+(new Date).getTime();if(this.state.currentOperation!=='save'){oApp=this.cleanApp(oApp)}var oScript=JUL.apply({},oApp);delete oScript.template;ample.get('assets/alter.txt',{ts:(new Date).getTime()},function(sResponse){sResponse=JSON.parse(sResponse);if(sResponse.error){window.alert(sResponse.error)}else{var oApp=JUL.Designer.app;if(oApp.state.currentOperation==='save'){ample.getElementById('anchor-test-app').setAttribute('href',oApp.testUrl());ample.getElementById('anchor-download-app').setAttribute('href',oApp.downloadUrl())}else{JUL.Designer.panels.app.hide();JUL.Designer.state.lastDialog=null;oApp.current=oApp.cleanApp(oApp.state.newApp);oApp.state.newApp=null;oApp.onSwitchCurrent()}}})},shiftModule:function(bUp){var oSelected=ample.getElementById('listbox-app-modules').selectedItems;if(!oSelected.length){return}var oNode=oSelected.item(oSelected.length-1);if(bUp&&!oNode.previousSibling){return}if(!bUp&&!oNode.nextSibling){return}var oPreviousNode=bUp?oNode.previousSibling:oNode;var oNextNode=bUp?oNode:oNode.nextSibling;var oParent=oNode.parentNode;oParent.removeChild(oNextNode);oParent.insertBefore(oNextNode,oPreviousNode);ample.getElementById('listbox-app-modules').reflow();ample.getElementById('listbox-app-modules').selectItem(oNode)},show:function(sOperation){if(sOperation==='edit'&&!this.current.ns){window.alert('There is no current application');return}this.state.newApp={defaultParser:{},modules:{},version:'0.'+(new Date).getTime()};var oCurrent=this.state.newApp;var oDesigner=JUL.Designer.designer;if(sOperation==='edit'){for(var sItem in this.current){if(this.current.hasOwnProperty(sItem)){oCurrent[sItem]=oDesigner.copy(this.current[sItem])}}}var sField;if(!this.parserFields){this.parserFields={};for(sField in oDesigner.parserFields){if(oDesigner.parserFields.hasOwnProperty(sField)){this.parserFields[sField]=JUL.apply({},oDesigner.parserFields[sField]);if(this.parserFields[sField].id){this.parserFields[sField].id=this.parserFields[sField].id+'-app'}}}}JUL.Designer.empty(ample.getElementById('listbox-app-settings').body);JUL.Designer.empty(ample.getElementById('listbox-app-parser').body);JUL.Designer.empty(ample.getElementById('listbox-app-modules').body);if(!oCurrent.template){oCurrent.template=JUL.Designer.config.defaultAppTemplate}ample.getElementById('textbox-app-template').setAttribute('value',oCurrent.template);JUL.Designer.fillListbox('listbox-app-settings',this.fields,oCurrent);JUL.Designer.fillListbox('listbox-app-parser',this.parserFields,oCurrent.defaultParser);var oFields={};for(sField in oCurrent.modules){if(oCurrent.modules.hasOwnProperty(sField)){oFields[sField]={ns:{required:true,defaultValue:'.'+sField}}}}JUL.Designer.fillListbox('listbox-app-modules',oFields,oCurrent.modules,['label','value-ns','description-description'],true);this.state.currentOperation=sOperation;JUL.Designer.panels.app.setAttribute('title',sOperation==='new'?'New application':'Edit application - '+oCurrent.title);JUL.Designer.state.lastDialog=JUL.Designer.panels.app;ample.getElementById('menuitem-add-current-project').setAttribute('disabled',!JUL.Designer.designer.current.ns);JUL.Designer.panels.app.showModal();var oTabs=JUL.Designer.panels.app.querySelector('xul|tabs');oTabs.firstChild.$activate()},switchModule:function(sItem){var oModule=this.current.modules[sItem];var sNS=oModule.ns;if(sNS.substr(0,1)==='.'){sNS=this.current.ns+sNS}var oProject=JUL.Designer.designer;if(oProject.current.ns===sNS){return}oProject.state.initProject={ns:sNS,title:this.current.title+' - '+(oModule.description||sItem.substr(0,1).toUpperCase()+sItem.substr(1)),parserConfig:oProject.copy(this.current.defaultParser)};if(this.current.preferredFramework){oProject.state.initProject.suggestedFramework=this.current.preferredFramework}if(oProject.current.ns&&oProject.checkSave('open_new',sNS)){return}oProject.open(sNS,true)},testJs:function(oJs,bComment){var sJs='/* generated by '+JUL.Designer.title+' version '+JUL.Designer.version+' */\n';if(bComment){var oApp=JUL.Designer.keySort(oJs,['modules']);delete oApp.defaultParser;var oParser=JUL.Designer.keySort(oJs.defaultParser);for(var sItem in oParser){if(oParser.hasOwnProperty(sItem)&&typeof JUL.UI[sItem]!=='undefined'&&JSON.stringify(oParser[sItem])===JSON.stringify(JUL.UI[sItem])){delete oParser[sItem]}}var aItems=[{suf:'',ref:oApp,desc:''},{suf:'.defaultParser',ref:oParser,desc:' default parser'}];sJs=sJs+'/* \''+oApp.title+'\' namespace */\n';sJs=sJs+"JUL.ns('"+oApp.ns+"');\n\n";for(var i=0;i<aItems.length;i++){var oItem=aItems[i];sJs=sJs+(oItem.suf?oApp.ns+oItem.suf+' =\n':'JUL.apply('+oApp.ns+',\n');sJs=sJs+'/* begin \''+oApp.title+"'"+oItem.desc+' */\n';sJs=sJs+JUL.Designer.parser.obj2str(oItem.ref)+'\n';sJs=sJs+'/* end \''+oApp.title+"'"+oItem.desc+' */\n';sJs=sJs+(oItem.suf?'':')')+';\n\n'}}else{sJs=sJs+"JUL.ns('"+oJs.ns+"');\n";sJs=sJs+'JUL.apply('+oJs.ns+', '+JUL.Designer.parser.obj2str(oJs)+');\n'}return sJs},testUrl:function(){return'assets/apps/'+encodeURIComponent(this.current.ns)+'.html?'+'version='+encodeURIComponent(this.current.version)+'&current='+encodeURIComponent(JUL.Designer.designer.current.ns||'')}})})();(function(){'use strict';JUL.ns('JUL.Designer.designer');JUL.Designer.designer.ui={tag:'page',children:[{tag:'commandset',hidden:true,children:[{tag:'command',id:'command-new-app'},{tag:'command',id:'command-open-app'},{tag:'command',id:'command-edit-app'},{tag:'command',id:'command-close-app'},{tag:'command',id:'command-delete-app'},{tag:'command',id:'command-new-project'},{tag:'command',id:'command-open-project'},{tag:'command',id:'command-edit-project'},{tag:'command',id:'command-save-project'},{tag:'command',id:'command-close-project'},{tag:'command',id:'command-delete-project'},{tag:'command',id:'command-no-logic'},{tag:'command',id:'command-view-js'},{tag:'command',id:'command-xml-layout'},{tag:'command',id:'command-copy-node'},{tag:'command',id:'command-cut-node'},{tag:'command',id:'command-paste-node'},{tag:'command',id:'command-up-node'},{tag:'command',id:'command-down-node'},{tag:'command',id:'command-remove-node'},{tag:'command',id:'command-copy-members'},{tag:'command',id:'command-cut-members'},{tag:'command',id:'command-paste-members'},{tag:'command',id:'command-remove-members'},{tag:'command',id:'command-undo'},{tag:'command',id:'command-new-framework'},{tag:'command',id:'command-open-framework'},{tag:'command',id:'command-edit-framework'},{tag:'command',id:'command-close-framework'},{tag:'command',id:'command-delete-framework'},{tag:'command',id:'command-prepend-namespace'},{tag:'command',id:'command-help-contents'},{tag:'command',id:'command-help-about'},{tag:'command',id:'command-show-clipboard'},{tag:'command',id:'command-show-menu',checked:true},{tag:'command',id:'command-show-status',checked:true},{tag:'command',id:'command-show-add',checked:true}]},{xclass:'html',tag:'div',children:[{tag:'menupopup',id:'menupopup-show-bars',children:[{tag:'menuitem',command:'command-show-menu',type:'checkbox',label:'Show menu bar'},{tag:'menuitem',command:'command-show-add',type:'checkbox',label:'Show add component'},{tag:'menuitem',command:'command-show-status',type:'checkbox',label:'Show status bar'}]},{tag:'menupopup',id:'menupopup-edit',_inc_:'JUL.Designer.designer.editUi'}]},{tag:'menubar',id:'menubar-app',context:'menupopup-show-bars',children:[{tag:'toolbargrippy'},{tag:'menu',label:'Application  ',children:[{tag:'menupopup',children:[{tag:'menuitem',command:'command-new-app',label:'New application ...'},{tag:'menuitem',command:'command-open-app',label:'Open application ...'},{tag:'menuitem',command:'command-edit-app',label:'Edit application ...'},{tag:'menu',label:'Switch module',children:[{tag:'menupopup',id:'menupopup-switch-module'}]},{tag:'menuitem',command:'command-close-app',label:'Close application'},{tag:'menuitem',command:'command-delete-app',label:'Delete application'}]}]},{tag:'menu',label:'Project  ',children:[{tag:'menupopup',children:[{tag:'menuitem',command:'command-new-project',label:'New project ...'},{tag:'menuitem',command:'command-open-project',label:'Open project ...'},{tag:'menuitem',command:'command-edit-project',label:'Edit project ...'},{tag:'menuitem',command:'command-save-project',label:'Save project'},{tag:'menuitem',command:'command-close-project',label:'Close project'},{tag:'menuitem',command:'command-delete-project',label:'Delete project'},{tag:'menuseparator'},{tag:'menuitem',type:'checkbox',command:'command-no-logic',label:'Don\'t separate logic'},{tag:'menuseparator'},{tag:'menuitem',command:'command-view-js',label:'View JavaScript'},{tag:'menuitem',command:'command-xml-layout',label:'XML layout'}]}]},{tag:'menu',label:'Edit  ',children:[{tag:'menupopup',id:'menu-edit',_inc_:'JUL.Designer.designer.editUi'}]},{tag:'menu',label:'Framework  ',children:[{tag:'menupopup',children:[{tag:'menuitem',command:'command-new-framework',label:'New framework ...'},{tag:'menuitem',command:'command-open-framework',label:'Open framework ...'},{tag:'menuitem',command:'command-edit-framework',label:'Edit framework ...'},{tag:'menuitem',command:'command-close-framework',label:'Close framework'},{tag:'menuitem',command:'command-delete-framework',label:'Delete framework'},{tag:'menuseparator'},{tag:'menuitem',type:'checkbox',command:'command-prepend-namespace',label:'Prepend namespace'}]}]},{tag:'menu',label:'Help  ',children:[{tag:'menupopup',children:[{tag:'menuitem',command:'command-help-contents',label:'Contents'},{tag:'menuitem',command:'command-help-about',label:'About'},{tag:'menuseparator'},{tag:'menuitem',command:'command-show-clipboard',label:'Show clipboard'}]}]}]},{tag:'toolbar',context:'menupopup-show-bars',children:[{tag:'toolbargrippy'},{tag:'toolbarbutton',label:'NA',css:'tbutton darkm',command:'command-new-app',tooltiptext:'New application'},{tag:'toolbarbutton',label:'OA',css:'tbutton darkm',command:'command-open-app',tooltiptext:'Open application'},{tag:'toolbarbutton',label:'EA',css:'tbutton darkm',command:'command-edit-app',tooltiptext:'Edit application'},{tag:'toolbarbutton',label:'SM',type:'menu',css:'tbutton darkm',tooltiptext:'Switch module',children:[{tag:'menupopup',id:'menupopup-switch-module-button'}]},{tag:'toolbarbutton',label:'CA',css:'tbutton darkm',command:'command-close-app',tooltiptext:'Close application'},{tag:'toolbarbutton',label:'XA',css:'tbutton darkm',command:'command-delete-app',tooltiptext:'Delete application'},{tag:'toolbarseparator'},{tag:'toolbarbutton',label:'NP',css:'tbutton darkr',tooltiptext:'New project',command:'command-new-project'},{tag:'toolbarbutton',label:'OP',css:'tbutton darkr',tooltiptext:'Open project',command:'command-open-project'},{tag:'toolbarbutton',label:'EP',css:'tbutton darkr',tooltiptext:'Edit project',command:'command-edit-project'},{tag:'toolbarbutton',label:'SP',css:'tbutton darkr',tooltiptext:'Save project',command:'command-save-project'},{tag:'toolbarbutton',label:'CP',css:'tbutton darkr',tooltiptext:'Close project',command:'command-close-project'},{tag:'toolbarbutton',label:'XP',css:'tbutton darkr',tooltiptext:'Delete project',command:'command-delete-project'},{tag:'toolbarbutton',label:'NL',type:'checkbox',css:'tbutton darkr',tooltiptext:'Don\'t separate logic',command:'command-no-logic'},{tag:'toolbarbutton',label:'JS',css:'tbutton darkr',tooltiptext:'View JavaScript',command:'command-view-js'},{tag:'toolbarbutton',label:'XL',css:'tbutton darkr',tooltiptext:'XML layout',command:'command-xml-layout'},{tag:'toolbarseparator'},{tag:'toolbarbutton',label:'AC',id:'tbutton-add-component',type:'menu',css:'tbutton darky',tooltiptext:'Add component',children:[{tag:'menupopup',children:[{xclass:'html',tag:'td',colspan:4,height:1,width:148,children:[{tag:'scrollbox',flex:1,orient:'vertical',children:[{xclass:'html',tag:'table',id:'table-add-component',cols:4,width:'100%',border:0,cellspacing:0,cellpadding:0,children:[{xclass:'html',tag:'tbody'}]}]}]}]}]},{tag:'toolbarbutton',label:'CC',css:'tbutton darky',tooltiptext:'Copy components',command:'command-copy-node'},{tag:'toolbarbutton',label:'TC',css:'tbutton darky',tooltiptext:'Cut components',command:'command-cut-node'},{tag:'toolbarbutton',label:'PC',css:'tbutton darky',tooltiptext:'Paste components',command:'command-paste-node'},{tag:'toolbarbutton',label:'UP',css:'tbutton darky',tooltiptext:'Move component up',command:'command-up-node'},{tag:'toolbarbutton',label:'DN',css:'tbutton darky',tooltiptext:'Move component down',command:'command-down-node'},{tag:'toolbarbutton',label:'XC',css:'tbutton darky',tooltiptext:'Remove components',command:'command-remove-node'},{tag:'toolbarbutton',label:'CM',css:'tbutton darky',tooltiptext:'Copy members',command:'command-copy-members'},{tag:'toolbarbutton',label:'TM',css:'tbutton darky',tooltiptext:'Cut members',command:'command-cut-members'},{tag:'toolbarbutton',label:'PM',css:'tbutton darky',tooltiptext:'Paste members',command:'command-paste-members'},{tag:'toolbarbutton',label:'XM',css:'tbutton darky',tooltiptext:'Remove members',command:'command-remove-members'},{tag:'toolbarbutton',label:'UN',css:'tbutton darky',tooltiptext:'Undo',command:'command-undo'},{tag:'toolbarseparator'},{tag:'toolbarbutton',label:'NF',css:'tbutton darkg',tooltiptext:'New framework',command:'command-new-framework'},{tag:'toolbarbutton',label:'OF',css:'tbutton darkg',tooltiptext:'Open framework',command:'command-open-framework'},{tag:'toolbarbutton',label:'EF',css:'tbutton darkg',tooltiptext:'Edit framework',command:'command-edit-framework'},{tag:'toolbarbutton',label:'CF',css:'tbutton darkg',tooltiptext:'Close framework',command:'command-close-framework'},{tag:'toolbarbutton',label:'XF',css:'tbutton darkg',tooltiptext:'Delete framework',command:'command-delete-framework'},{tag:'toolbarbutton',label:'PN',type:'checkbox',css:'tbutton darkg',tooltiptext:'Prepend namespace',command:'command-prepend-namespace'},{tag:'toolbarseparator'},{tag:'toolbarbutton',label:'HC',css:'tbutton darkb',tooltiptext:'Contents',command:'command-help-contents'},{tag:'toolbarbutton',label:'HA',css:'tbutton darkb',tooltiptext:'About',command:'command-help-about'},{tag:'toolbarbutton',label:'SC',css:'tbutton darkb',tooltiptext:'Show clipboard',command:'command-show-clipboard'},{tag:'toolbarbutton',label:'SB',css:'tbutton darkb',type:'menu',tooltiptext:'Show bars',children:[{tag:'menupopup',children:[{tag:'menuitem',command:'command-show-menu',type:'checkbox',label:'Show menu bar'},{tag:'menuitem',command:'command-show-add',type:'checkbox',label:'Show add component'},{tag:'menuitem',command:'command-show-status',type:'checkbox',label:'Show status bar'}]}]},{tag:'vbox',flex:1},{xclass:'html',tag:'div',width:205,style:'padding:5px 17px 0 0;text-align:right',children:[{xclass:'html',tag:'a',id:'anchor-test',css:'tbutton',target:'_test',href:'#',html:'TP',title:'Open the project in a separate window'},{xclass:'html',tag:'a',id:'anchor-download',css:'tbutton',style:'margin-left:10px',href:'#',html:'DP',title:'Download saved project'},{xclass:'html',tag:'a',id:'anchor-test-app',css:'tbutton',style:'margin-left:10px',target:'_test_app',href:'#',html:'TA',title:'Open the application in a separate window'},{xclass:'html',tag:'a',id:'anchor-download-app',css:'tbutton',style:'margin-left:10px',href:'#',html:'DA',title:'Download saved application'}]}]},{tag:'hbox',flex:1,children:[{tag:'vbox',id:'vbox-project',width:495,context:'menupopup-edit',children:[{tag:'hbox',flex:1,children:[{tag:'vbox',width:'100%',children:[{tag:'description',value:'Component tree',css:'caption'},{tag:'toolbar',children:[{tag:'toolbargrippy'},{tag:'toolbarbutton',label:'Up',command:'command-up-node'},{tag:'toolbarseparator'},{tag:'toolbarbutton',label:'Down',command:'command-down-node'},{tag:'toolbarseparator'},{tag:'toolbarbutton',label:'Remove',command:'command-remove-node'},{tag:'toolbarseparator'},{tag:'toolbarbutton',label:'Find',id:'button-tree-search'},{tag:'toolbarseparator'},{tag:'hbox',width:'95%',children:[{tag:'textbox',id:'textbox-tree-search',style:'margin-top:6px',tooltiptext:'Component ID or binding ID',maxwidth:200,width:'100%'}]}]},{tag:'hbox',children:[{tag:'label',value:'Show'},{tag:'menulist',id:'menulist-designer-members',children:[{tag:'menupopup'}]},{tag:'label',value:'in'},{tag:'menulist',id:'menulist-designer-members-where',children:[{tag:'menupopup',children:[{tag:'menuitem',label:'ui',value:'ui'},{tag:'menuitem',label:'logic',value:'logic'}]}]}]},{tag:'hbox',children:[{tag:'spacer',width:80},{tag:'label',value:'as'},{tag:'menulist',id:'menulist-designer-members-type',children:[{tag:'menupopup',children:[{tag:'menuitem',label:'Array',value:'Array'},{tag:'menuitem',label:'Object',value:'Object'}]}]}]},{tag:'tree',id:'tree-interface',minheight:120,height:180,children:[{tag:'treecols',children:[{tag:'treecol',width:220,label:'Component',primary:true},{tag:'treecol',width:160,label:'ID'},{tag:'treecol',width:145,label:'Members'}]},{tag:'treebody'}]},{tag:'splitter'},{tag:'description',value:'Component members',css:'caption',id:'label-component'},{tag:'tabbox',id:'tabbox-designer-members',children:[{tag:'tabs',id:'tabs-designer-members',children:[{tag:'tab',label:'UI',width:60,pack:'center'},{tag:'tab',label:'Logic',width:60,pack:'center'},{tag:'tab',label:'Listeners',width:60,pack:'center'}]}]},{tag:'toolbar',children:[{tag:'toolbargrippy'},{tag:'toolbarbutton',label:'Add',id:'button-designer-add'},{tag:'toolbarseparator'},{tag:'toolbarbutton',label:'Remove',command:'command-remove-members'},{tag:'toolbarseparator'},{tag:'toolbarbutton',label:'Change',id:'button-designer-change'},{tag:'toolbarseparator'},{tag:'hbox',width:'95%',children:[{tag:'textbox',id:'textbox-designer-name',style:'margin-top:6px',tooltiptext:'Member or event name',maxwidth:200,width:'100%'}]}]},{tag:'deck',id:'deck-designer-members',flex:1,children:[{tag:'vbox',flex:1,children:[{tag:'listbox',flex:1,id:'listbox-designer-ui',children:[{tag:'listhead',children:[{tag:'listheader',label:'Member',width:115},{tag:'listheader',label:'Value',width:170},{tag:'listheader',label:'Code',width:40}]},{tag:'listbody'}]}]},{tag:'vbox',flex:1,children:[{tag:'listbox',
flex:1,id:'listbox-designer-logic',children:[{tag:'listhead',children:[{tag:'listheader',label:'Member',width:115},{tag:'listheader',label:'Value',width:170},{tag:'listheader',label:'Code',width:40}]},{tag:'listbody'}]}]},{tag:'vbox',flex:1,children:[{tag:'listbox',flex:1,id:'listbox-designer-listeners',children:[{tag:'listhead',children:[{tag:'listheader',label:'Listener',width:115},{tag:'listheader',label:'Value',width:170},{tag:'listheader',label:'Code',width:40}]},{tag:'listbody'}]}]}]}]},{tag:'spacer',width:3},{tag:'vbox',id:'vbox-add-component',width:145,children:[{tag:'description',value:'Add component',css:'caption'},{tag:'scrollbox',id:'scrollbox-components',flex:1,orient:'vertical'}]}]}]},{tag:'splitter',id:'splitter-test'},{tag:'vbox',flex:1,children:[{tag:'description',value:'Project',css:'caption',id:'label-project'},{tag:'deck',id:'deck-test',flex:1,children:[{tag:'vbox',flex:1,children:[{xclass:'html',tag:'div',flex:1,children:[{xclass:'html',tag:'iframe',id:'iframe-test',name:'iframe-test',width:'100%',height:'100%',seamless:'yes',style:'border:0'}]}]},{tag:'vbox',flex:1,children:[{xclass:'html',tag:'div',flex:1,id:'test-bck'}]}]}]}]},{tag:'statusbar',id:'statusbar-app',context:'menupopup-show-bars',children:[{tag:'spacer',width:4},{tag:'statusbarpanel',id:'statusbarpanel-main',label:'JUL Designer',flex:1},{tag:'spacer',width:4},{tag:'statusbarpanel',id:'statusbarpanel-app',label:'',flex:1},{tag:'spacer',width:4},{tag:'statusbarpanel',id:'statusbarpanel-project',label:'',flex:1},{tag:'spacer',width:4},{tag:'statusbarpanel',id:'statusbarpanel-framework',label:'',flex:1},{tag:'spacer',width:4},{tag:'statusbarpanel',id:'statusbarpanel-selection',label:'',flex:1},{tag:'spacer',width:4}]}]};JUL.Designer.designer.logic={'anchor-download':{listeners:{click:function(){var sSrc=this.getAttribute('href');if(sSrc.substr(0,1)==='#'){return false}}}},'anchor-download-app':{listeners:{click:function(){var sSrc=this.getAttribute('href');if(sSrc.substr(0,1)==='#'){return false}}}},'anchor-test':{listeners:{click:function(){var sSrc=this.getAttribute('href');if(sSrc.substr(0,1)==='#'){return false}if(JUL.Designer.state.oTestWnd&&!JUL.Designer.state.oTestWnd.closed){JUL.Designer.state.oTestWnd.close()}JUL.Designer.state.oTestWnd=window.open(sSrc,'_test');return false}}},'anchor-test-app':{listeners:{click:function(){var sSrc=this.getAttribute('href');if(sSrc.substr(0,1)==='#'){return false}if(JUL.Designer.state.oTestAppWnd&&!JUL.Designer.state.oTestAppWnd.closed){JUL.Designer.state.oTestAppWnd.close()}JUL.Designer.state.oTestAppWnd=window.open(sSrc,'_test_app');return false}}},'button-designer-add':{listeners:{command:function(){var nIndex=ample.getElementById('tabbox-designer-members').selectedIndex;JUL.Designer.designer.addMember(nIndex?nIndex<2?'logic':'listeners':'ui')}}},'button-designer-change':{listeners:{command:function(){var nIndex=ample.getElementById('tabbox-designer-members').selectedIndex;var sType=nIndex?nIndex<2?'logic':'listeners':'ui';var oItems=ample.getElementById('listbox-designer-'+sType).selectedItems;if(!oItems.length){window.alert('Please select an item');return}var oItem=oItems.item(oItems.length-1);JUL.Designer.designer.changeMember(JUL.Designer.getWhere(oItem),sType,oItem)}}},'button-tree-search':{listeners:{command:function(){if(!JUL.Designer.designer.current.ui){return}JUL.Designer.designer.searchId(ample.getElementById('textbox-tree-search').getAttribute('value'))}}},'command-close-app':{listeners:{command:function(){JUL.Designer.app.close()}}},'command-close-framework':{listeners:{command:function(){JUL.Designer.framework.close()}}},'command-close-project':{listeners:{command:function(){JUL.Designer.designer.close();JUL.Designer.cleanMap()}}},'command-copy-members':{listeners:{command:function(){JUL.Designer.designer.onCopyMembers()}}},'command-copy-node':{listeners:{command:function(){JUL.Designer.designer.onCopyNode()}}},'command-cut-members':{listeners:{command:function(){JUL.Designer.designer.onCopyMembers(true)}}},'command-cut-node':{listeners:{command:function(){JUL.Designer.designer.onCopyNode(true)}}},'command-delete-app':{listeners:{command:function(){JUL.Designer.app.del()}}},'command-delete-framework':{listeners:{command:function(){JUL.Designer.framework.del()}}},'command-delete-project':{listeners:{command:function(){JUL.Designer.designer.del()}}},'command-down-node':{listeners:{command:function(){var oNodeList=ample.getElementById('tree-interface').selectedItems;if(!oNodeList.length){window.alert('Please select a component');return}var oNode=oNodeList.item(oNodeList.length-1);if(oNode.nextSibling){JUL.Designer.designer.shiftNode(oNode)}}}},'command-edit-app':{listeners:{command:function(){JUL.Designer.app.show('edit')}}},'command-edit-framework':{listeners:{command:function(){JUL.Designer.framework.show('edit')}}},'command-edit-project':{listeners:{command:function(){JUL.Designer.designer.show('edit')}}},'command-help-about':{listeners:{command:function(){JUL.Designer.panels.about.showModal()}}},'command-help-contents':{listeners:{command:function(){JUL.Designer.panels.help.showModal()}}},'command-new-app':{listeners:{command:function(){JUL.Designer.app.show('new')}}},'command-new-framework':{listeners:{command:function(){JUL.Designer.framework.show('new')}}},'command-new-project':{listeners:{command:function(){JUL.Designer.designer.show('new')}}},'command-no-logic':{listeners:{command:function(){var bCheck=this.getAttribute('checked')!=='true';this.setAttribute('checked',bCheck);if(JUL.Designer.designer.current.ns){JUL.Designer.designer.current.noLogic=bCheck;delete JUL.Designer.designer.state.clipboard.undo;JUL.Designer.designer.onSelectNode(JUL.Designer.designer.currentNode)}}}},'command-open-app':{listeners:{command:function(){JUL.Designer.designer.showBrowse('app')}}},'command-open-framework':{listeners:{command:function(){JUL.Designer.designer.showBrowse('framework')}}},'command-open-project':{listeners:{command:function(){JUL.Designer.designer.showBrowse('project')}}},'command-paste-members':{listeners:{command:function(){JUL.Designer.designer.onPasteMembers()}}},'command-paste-node':{listeners:{command:function(){JUL.Designer.designer.onPasteNode()}}},'command-prepend-namespace':{listeners:{command:function(){var bCheck=this.getAttribute('checked')!=='true';this.setAttribute('checked',bCheck);if(JUL.Designer.framework.current.ns){JUL.Designer.framework.current.prependNS=bCheck}}}},'command-remove-members':{listeners:{command:function(){JUL.Designer.designer.onCopyMembers(true,true)}}},'command-remove-node':{listeners:{command:function(){JUL.Designer.designer.onCopyNode(true,true)}}},'command-save-project':{listeners:{command:function(){JUL.Designer.designer.saveCurrent();JUL.Designer.cleanMap()}}},'command-show-add':{listeners:{command:function(){var bCheck=this.getAttribute('checked')!=='true';this.setAttribute('checked',bCheck);ample.getElementById('vbox-add-component').setAttribute('hidden',!bCheck)}}},'command-show-clipboard':{listeners:{command:function(){JUL.Designer.designer.showClipboard()}}},'command-show-menu':{listeners:{command:function(){var bCheck=this.getAttribute('checked')!=='true';this.setAttribute('checked',bCheck);ample.getElementById('menubar-app').setAttribute('hidden',!bCheck)}}},'command-show-status':{listeners:{command:function(){var bCheck=this.getAttribute('checked')!=='true';this.setAttribute('checked',bCheck);ample.getElementById('statusbar-app').setAttribute('hidden',!bCheck)}}},'command-undo':{listeners:{command:function(){JUL.Designer.designer.undo()}}},'command-up-node':{listeners:{command:function(){var oNodeList=ample.getElementById('tree-interface').selectedItems;if(!oNodeList.length){window.alert('Please select a component');return}var oNode=oNodeList.item(oNodeList.length-1);if(oNode.previousSibling){JUL.Designer.designer.shiftNode(oNode,true)}}}},'command-view-js':{listeners:{command:function(){JUL.Designer.designer.showJs()}}},'command-xml-layout':{listeners:{command:function(){JUL.Designer.designer.showXml()}}},'listbox-designer-listeners':{listeners:{select:function(oEvent){var oNodeList=this.selectedItems;ample.getElementById('textbox-designer-name').setAttribute('value',oNodeList.length?JUL.Designer.getWhere(oNodeList.item(oNodeList.length-1)):'')}}},'listbox-designer-logic':{listeners:{select:function(oEvent){var oNodeList=this.selectedItems;ample.getElementById('textbox-designer-name').setAttribute('value',oNodeList.length?JUL.Designer.getWhere(oNodeList.item(oNodeList.length-1)):'')}}},'listbox-designer-ui':{listeners:{select:function(oEvent){var oNodeList=this.selectedItems;ample.getElementById('textbox-designer-name').setAttribute('value',oNodeList.length?JUL.Designer.getWhere(oNodeList.item(oNodeList.length-1)):'')}}},'menuliist-designer-members':{listeners:{command:function(){if(!JUL.Designer.designer.currentNode){this.setAttribute('value','')}var sValue=this.getAttribute('value');JUL.Designer.designer.onMembersSelect(sValue)}}},'menuliist-designer-members-type':{listeners:{command:function(){if(!JUL.Designer.designer.currentNode){this.setAttribute('value','')}var sValue=this.getAttribute('value');JUL.Designer.designer.onMembersTypeSelect(sValue)}}},'menulist-designer-members':{listeners:{command:function(){var oList=this;setTimeout(function(){if(!JUL.Designer.designer.currentNode){oList.setAttribute('value','');return}JUL.Designer.designer.showMembers(oList.getAttribute('value'))},50)}}},'menulist-designer-members-type':{listeners:{command:function(){var oList=this;setTimeout(function(){if(!JUL.Designer.designer.currentNode){oList.setAttribute('value','');return}JUL.Designer.designer.changeType(oList.getAttribute('value'))},50)}}},'menulist-designer-members-where':{listeners:{command:function(){var oList=this;var sValue=this.getAttribute('value');setTimeout(function(){if(!JUL.Designer.designer.currentNode){oList.setAttribute('value','');return}if(JUL.Designer.designer.current.noLogic){oList.setAttribute('value',sValue);return}JUL.Designer.designer.changeWhere(oList.getAttribute('value'))},50)}}},'splitter-test':{listeners:{mousedown:function(){ample.getElementById('deck-test').setAttribute('selectedIndex',1)},mouseup:function(){if(JUL.Designer.designer.current.ns){ample.getElementById('deck-test').setAttribute('selectedIndex',0)}}}},'tabs-designer-members':{listeners:{select:function(){var nIndex=ample.getElementById('tabbox-designer-members').selectedIndex;ample.getElementById('deck-designer-members').setAttribute('selectedIndex',nIndex);var sType=nIndex?nIndex<2?'logic':'listeners':'ui';if(JUL.Designer.designer.currentNode){var oConfig=JUL.Designer.getWhere(JUL.Designer.designer.currentNode).val();var oTarget=JUL.Designer.designer.getTarget(oConfig);switch(sType){case'ui':JUL.Designer.designer.currentConfig=oConfig;break;case'logic':JUL.Designer.designer.currentConfig=oTarget;break;case'listeners':JUL.Designer.designer.currentConfig=oTarget[JUL.Designer.designer.current.listenersProperty];break}}else{JUL.Designer.designer.currentConfig=null}var oNodeList=ample.getElementById('listbox-designer-'+sType).selectedItems;ample.getElementById('textbox-designer-name').setAttribute('value',oNodeList.length?JUL.Designer.getWhere(oNodeList.item(oNodeList.length-1)):'')}}},'tbutton-add-component':{listeners:{click:function(){this.firstChild.firstChild.setAttribute('height',1);if(this.firstChild.getAttribute('hidden')==='true'){return}var oTable=ample.getElementById('table-add-component').lastChild;if(!oTable.childNodes.length){return}var nSize=ample.documentElement.getBoundingClientRect().bottom-this.getBoundingClientRect().bottom;nSize=nSize<21?0:nSize-21;var nHeight=oTable.lastChild.getBoundingClientRect().bottom-this.getBoundingClientRect().bottom+6;this.firstChild.firstChild.setAttribute('height',nHeight<nSize?nHeight:nSize)}}},'textbox-designer-name':{listeners:{keypress:function(oEvent){if(oEvent.keyIdentifier==='Enter'){var nIndex=ample.getElementById('tabbox-designer-members').selectedIndex;var sType=nIndex?nIndex<2?'logic':'listeners':'ui';var oItems=ample.getElementById('listbox-designer-'+sType).selectedItems;if(oItems.length&&!oEvent.shiftKey){var oItem=oItems.item(oItems.length-1);JUL.Designer.designer.changeMember(JUL.Designer.getWhere(oItem),sType,oItem)}else{JUL.Designer.designer.addMember(sType)}}}}},'textbox-tree-search':{listeners:{keypress:function(oEvent){if(oEvent.keyIdentifier==='Enter'){if(!JUL.Designer.designer.current.ui){return}JUL.Designer.designer.searchId(this.getAttribute('value'))}}}},'tree-interface':{listeners:{select:function(oEvent){var oDesigner=JUL.Designer.designer;if(oDesigner.state.selectTimer){clearTimeout(oDesigner.state.selectTimer)}oDesigner.state.selectTimer=setTimeout(function(){delete oDesigner.state.selectTimer;var oNodeList=ample.getElementById('tree-interface').selectedItems;oDesigner.onSelectNode(oNodeList.length?oNodeList.item(oNodeList.length-1):null)},100)},click:function(oEvent){if(oEvent.target.nodeName==='xul:treecell'){setTimeout(function(){JUL.Designer.designer.onCellClick()},150)}}}}};JUL.Designer.designer.projectUi={tag:'dialog',id:'dialog-project',title:'Project',width:980,height:470,hidden:true,children:[{tag:'tabbox',children:[{tag:'tabs',id:'tabs-project',children:[{tag:'tab',label:'Settings',width:80,pack:'center'},{tag:'tab',label:'Parser',width:80,pack:'center'},{tag:'tab',label:'Template',width:80,pack:'center'}]}]},{tag:'deck',id:'deck-project',flex:1,children:[{tag:'vbox',flex:1,children:[{tag:'listbox',flex:1,id:'listbox-project-settings',children:[{tag:'listhead',children:[{tag:'listheader',label:'Setting',width:250},{tag:'listheader',label:'Value',width:380},{tag:'listheader',label:'Code',width:40}]},{tag:'listbody'}]}]},{tag:'vbox',flex:1,children:[{tag:'listbox',flex:1,id:'listbox-project-parser',children:[{tag:'listhead',children:[{tag:'listheader',label:'Member',width:250},{tag:'listheader',label:'Value',width:380},{tag:'listheader',label:'Code',width:40}]},{tag:'listbody'}]}]},{tag:'vbox',flex:1,children:[{tag:'description',value:'Testing HTML page. Besides {jul_script} and {project_script}, all {project_<property>} properties are available; page timestamp {ts}.'},{tag:'textbox',id:'textbox-project-template',width:'100%',multiline:true,flex:1}]}]}]};JUL.Designer.designer.projectLogic={'dialog-project':{listeners:{dialogaccept:function(){JUL.Designer.designer.save();JUL.Designer.cleanMap();return false},dialogcancel:function(){JUL.Designer.designer.cancel();JUL.Designer.cleanMap();return false}}},'tabs-project':{listeners:{select:function(){ample.getElementById('deck-project').setAttribute('selectedIndex',this.parentNode.selectedIndex)}}},'textbox-project-template':{listeners:{keydown:'JUL.Designer.filterTab',blur:function(){JUL.Designer.designer.state.newProject.template=JUL.trim(this.getAttribute('value'))}}}};JUL.Designer.designer.editUi={children:[{tag:'menuitem',label:'Copy components',command:'command-copy-node'},{tag:'menuitem',label:'Cut components',command:'command-cut-node'},{tag:'menuitem',label:'Paste components',command:'command-paste-node'},{tag:'menuitem',label:'Move component up',command:'command-up-node'},{tag:'menuitem',label:'Move component down',command:'command-down-node'},{tag:'menuitem',label:'Remove components',command:'command-remove-node'},{tag:'menuseparator'},{tag:'menuitem',label:'Copy members',command:'command-copy-members'},{tag:'menuitem',label:'Cut members',command:'command-cut-members'},{tag:'menuitem',label:'Paste members',command:'command-paste-members'},{tag:'menuitem',label:'Remove members',command:'command-remove-members'},{tag:'menuseparator'},{tag:'menuitem',label:'Undo',command:'command-undo'}]};JUL.apply(JUL.Designer.designer,{current:{},currentConfig:null,currentNode:null,fields:{title:{tooltip:'Project\'s title',id:'setting-project-title',defaultValue:'Project 1',required:true,template:'<string>'},ns:{tooltip:'Namespace path',id:'setting-project-ns',defaultValue:'project1',required:true,template:'<string>'},init:{tooltip:'Project instantiation method',id:'setting-project-init',template:' function() { ... }',required:true,defaultValue:function(){var oParser=new JUL.UI.Parser(this.parserConfig);oParser.create(this.ui,this.logic)}},suggestedFramework:{tooltip:'If not empty, will try to open this framework when opening the project',id:'setting-project-framework',template:'<string>'},listenersProperty:{tooltip:'Name of the event listeners property',id:'setting-project-listeners-property',defaultValue:'listeners',required:true,template:'<string>'},noLogic:{tooltip:'Don\'t separate logic from UI',required:true,defaultValue:false,template:'<boolean>'},keepBindings:{tooltip:'Keep all binding IDs in the generated code',required:true,defaultValue:false,template:'<boolean>'}},parserFields:{classProperty:{tooltip:'Name of the class property',id:'setting-parser-class-property',defaultValue:'xclass',required:true,template:'<string>'},defaultClass:{tooltip:'Name of the default class',id:'setting-parser-default-class',required:true,defaultValue:'Object',template:'<string>'},childrenProperty:{tooltip:'Name of the children property',id:'setting-parser-children-property',defaultValue:'children',required:true,template:'<string>'},membersProperties:{tooltip:'Array of other members properties',id:'setting-parser-members-properties',defaultValue:[],required:true,template:'["category1", "category2" ... ]'},membersMappings:{tooltip:'Per-class mappings between a class name and a members array',id:'setting-parser-members-mappingss',defaultValue:{},required:true,template:'{"class1":<array1>, "class2":<array2> ... }'},idProperty:{tooltip:'Name of the ID property',id:'settingparser-id-property',defaultValue:'id',required:true,template:'<string>'},bindingProperty:{tooltip:'Name of the binding ui with logic property',id:'setting-parser-binding-property',defaultValue:'cid',required:true,template:'<string>'},useTags:{tooltip:'Whether to use tags in configs',id:'setting-parser-use-tags',required:true,defaultValue:false,template:'<boolean>'},tagProperty:{tooltip:'Name of the tag property',id:'setting-parser-tag-property',defaultValue:'tag',required:true,template:'<string>'},customFactory:{tooltip:'If supplied, it will be passed the component config',id:'setting-parser-custom-factory',template:' function(oConfig) { ... return oInstance; }'},topDown:{tooltip:'Check this for a top-down instantiation',id:'setting-parser-top-down',required:true,defaultValue:false,template:'<boolean>'},_otherProperties:{tooltip:'Object with other parser properties to be applied over',id:'setting-parser-other-properies',defaultValue:{},template:'<object>'}},state:{clipboard:{},currentOperation:'',newProject:null,notSaved:false},addComponent:function(sItem){if(!this.current.ns){this.show('new');return}var oCurrent=this.currentParser;var oFramework=JUL.Designer.framework.current;var oComponent=oFramework.components[sItem];var oWhere=null;var bToArray=false;if(this.currentNode){var oParentWhere=JUL.Designer.getWhere(this.currentNode);var oParentConfig=oParentWhere.val();var sParentId=this.getId(oParentConfig);if(sParentId&&this.current.logic[sParentId]&&ample.getElementById('menulist-designer-members-where').getAttribute('value')==='logic'){oParentConfig=this.current.logic[sParentId]}if(ample.getElementById('menulist-designer-members-type').getAttribute('value')==='Object'){if(!oParentConfig[oParentWhere.showWhat]){oWhere=new JUL.Ref({ref:oParentConfig,key:oParentWhere.showWhat})}}if(!oWhere){if(!oParentConfig[oParentWhere.showWhat]){oParentConfig[oParentWhere.showWhat]=[]}if(JUL.typeOf(oParentConfig[oParentWhere.showWhat])!=='Array'){oParentConfig[oParentWhere.showWhat]=[oParentConfig[oParentWhere.showWhat]];var oChildWhere=JUL.Designer.getWhere(this.currentNode.querySelector('xul|treechildren').firstChild);oChildWhere.ref(oParentConfig[oParentWhere.showWhat],0);oChildWhere.parent=new JUL.Ref({ref:oParentConfig,key:oParentWhere.showWhat});ample.getElementById('menulist-designer-members-type').setAttribute('value','Array');bToArray=true}oWhere=new JUL.Ref({ref:oParentConfig[oParentWhere.showWhat],key:oParentConfig[oParentWhere.showWhat].length,parent:new JUL.Ref({ref:oParentConfig,key:oParentWhere.showWhat})})}}else{if(this.current.ui){if(JUL.typeOf(this.current.ui)!=='Array'){this.current.ui=[this.current.ui];var oFirstWhere=JUL.Designer.getWhere(ample.getElementById('tree-interface').querySelector('xul|treechildren').firstChild);oFirstWhere.ref(this.current.ui,0);oFirstWhere.parent=new JUL.Ref({ref:this.current,key:'ui'});bToArray=true}oWhere=new JUL.Ref({ref:this.current.ui,key:this.current.ui.length,parent:new JUL.Ref({ref:this.current,key:'ui'})})}else{oWhere=new JUL.Ref({ref:this.current,key:'ui'})}}var oConfig={};var sFrameworkNS=oFramework.nsAlias||oFramework.ns;oWhere.val(oConfig);var sClass=oCurrent.useTags?sFrameworkNS:oFramework.prependNS?sFrameworkNS+'.'+sItem:sItem;oConfig[oCurrent.classProperty]=sClass;if(oCurrent.useTags){oConfig[oCurrent.tagProperty]=sItem}var sId=false;if(!this.current.noLogic){sId=(oCurrent.useTags?oConfig[oCurrent.tagProperty]:sClass)+'-'+this.current.lastComponentId++;oConfig[oCurrent.bindingProperty]=sId}if(oComponent){var oMembers=JUL.Designer.framework.getInherited(oComponent,'members')||{};for(var sMember in JUL.Designer.keySort(oMembers)){if(oMembers.hasOwnProperty(sMember)&&(oMembers[sMember].required||typeof oMembers[sMember].defaultValue)==='string'){var oMember=oMembers[sMember];var oTarget=oConfig;if(!this.current.noLogic&&oMember.logic){if(!this.current.logic[sId]){this.current.logic[sId]={}}oTarget=this.current.logic[sId]}oTarget[sMember]=oMember.defaultValue}}}this.state.clipboard.undo={operation:'addNodes',where:[oWhere],logic:[],toArray:bToArray,show:false};if(this.currentNode){this.state.clipboard.undo.show=this.findPath(oParentWhere.val())}if(sId&&this.current.logic[sId]){this.state.clipboard.undo.logic.push(sId)}this.save(true,true);var oNode=this.buildTree(this.currentNode,oWhere);ample.getElementById('tree-interface').reflow();oNode.scrollIntoView()},addConfigListeners:function(oConfig){var oTarget=this.getTarget(oConfig);JUL.Designer.addValueListener(oConfig,this.currentParser.classProperty,this.onClassUpdated,this);if(this.currentParser.useTags){JUL.Designer.addValueListener(oConfig,this.currentParser.tagProperty,this.onClassUpdated,this)}JUL.Designer.addValueListener(oConfig,this.currentParser.idProperty,this.onIdUpdated,this);if(!this.current.noLogic){JUL.Designer.addValueListener(oConfig,this.currentParser.bindingProperty,this.onBindingUpdated,this)}JUL.Designer.addValueListener(oConfig,this.currentParser.instantiateProperty,this.onInstantiateUpdated,this);JUL.Designer.addValueListener(oConfig,null,this.onConfigUpdated,this);if(oTarget!==oConfig){JUL.Designer.addValueListener(oTarget,null,this.onConfigUpdated,this)}JUL.Designer.addValueListener(oTarget[this.current.listenersProperty],null,this.onConfigUpdated,this)},addMember:function(sType){if(!this.currentNode){window.alert('Please select a component from the top');return}var nLast=1;var sName=JUL.trim(ample.getElementById('textbox-designer-name').getAttribute('value'));var aExclude=this.getExclude();if(!sName||typeof this.currentConfig[sName]!=='undefined'||sName!==this.currentParser.instantiateProperty&&aExclude.indexOf(sName)>-1||ample.query('#listbox-designer-'+sType+'>xul|listbody xul|listcell[label='+sName+']').length){while((sName=(sType==='listeners'?'event':'member')+nLast++)&&(typeof this.currentConfig[sName]!=='undefined'||aExclude.indexOf(sName)>-1||ample.query('#listbox-designer-'+sType+'>xul|listbody xul|listcell[label='+sName+']').length)){}}ample.getElementById('textbox-designer-name').setAttribute('value','');var oFields={};oFields[sName]={tooltip:sType==='listeners'?'Custom event':'Custom '+sType+' member'};JUL.Designer.fillListbox('listbox-designer-'+sType,oFields,this.currentConfig);ample.getElementById('listbox-designer-'+sType).querySelector('xul|listbody').lastChild.scrollIntoView();ample.getElementById('listbox-designer-'+sType).clearSelection()},buildTree:function(oParent,oWhere,bOnlyChildren,bSelf){var oCurrent=this.currentParser;var oNode=null;if(!oWhere){oWhere=new JUL.Ref({ref:this.current,key:'ui'})}if(!oWhere.val()){return}if(JUL.typeOf(oWhere.val())==='Array'){var aUi=oWhere.val();for(var u=0;u<aUi.length;u++){this.buildTree(oParent,new JUL.Ref({ref:aUi,key:u,parent:oWhere}),bOnlyChildren)}return}if(!oParent){oParent=ample.getElementById('tree-interface').querySelector('xul|treebody')}if(!bSelf&&oParent.nodeName==='xul:treeitem'){oParent.setAttribute('container',true);oParent.setAttribute('open',true)}if(!oParent.querySelector('xul|treechildren')){if(!bSelf&&oParent.nodeName==='xul:treeitem'){oParent.parentNode.reflow()}JUL.Designer.parser.createComponent({tag:'treechildren',parent:oParent})}var oConfig=oWhere.val();oWhere.showWhat=oWhere.showWhat||this.getFirstChildren(oConfig);var sId=this.getId(oConfig);if(bOnlyChildren){oNode=oParent}else{var sClass=oConfig[oCurrent.classProperty]||oCurrent.defaultClass;var aMembers=[];var aSearch=oCurrent.getMembers(oConfig);for(var k=0;k<aSearch.length;k++){if(sId&&this.current.logic[sId]&&this.current.logic[sId][aSearch[k]]&&typeof this.current.logic[sId][aSearch[k]]==='object'){aMembers.push(aSearch[k])}else if(oConfig[aSearch[k]]&&typeof oConfig[aSearch[k]]==='object'){aMembers.push(aSearch[k])}}var oNodeConfig={tag:'treeitem',id:'node-'+JUL.Designer.state.lastId++,container:true,open:true,children:[{tag:'treerow',children:[{tag:'treecell',label:oCurrent.useTags?(sClass===oCurrent.defaultClass?'':sClass+':')+oConfig[oCurrent.tagProperty]:sClass},{tag:'treecell',label:oConfig[oCurrent.idProperty]||' '},{tag:'treecell',label:aMembers.join(', ')}]}]};JUL.Designer.state.map[oNodeConfig.id]=oWhere;oNode=JUL.Designer.parser.create(oNodeConfig,null,oParent.querySelector('xul|treechildren'))}if(sId&&this.current.logic[sId]&&this.current.logic[sId][oWhere.showWhat]&&typeof this.current.logic[sId][oWhere.showWhat]==='object'){oConfig=this.current.logic[sId]}if(oConfig[oWhere.showWhat]&&typeof oConfig[oWhere.showWhat]==='object'){var sType=JUL.typeOf(oConfig[oWhere.showWhat]);var aItems=[].concat(oConfig[oWhere.showWhat]);for(var i=0;i<aItems.length;i++){var oChildWhere=null;if(sType==='Array'){oChildWhere=new JUL.Ref({ref:oConfig[oWhere.showWhat],key:i,parent:new JUL.Ref({ref:oConfig,key:oWhere.showWhat})})}else{oChildWhere=new JUL.Ref({ref:oConfig,key:oWhere.showWhat})}this.buildTree(oNode,oChildWhere,false,true)}}else{oNode.setAttribute('container',false)}if(!bSelf&&oParent.nodeName==='xul:treeitem'){this.setCellLabel(oParent,'members')}if(!bSelf){return oNode}},cancel:function(){this.state.newProject=null;JUL.Designer.panels.project.hide();JUL.Designer.state.lastDialog=null},changeMember:function(sItem,sType,oNode){var sName=JUL.trim(ample.getElementById('textbox-designer-name').getAttribute('value'));var aExclude=this.getExclude();if(!sName||sName===sItem||typeof this.currentConfig[sName]!=='undefined'||aExclude.indexOf(sName)>-1||aExclude.indexOf(sItem)>-1||ample.query('#listbox-designer-'+sType+'>xul|listbody xul|listcell[label='+sName+']').length){ample.getElementById('textbox-designer-name').setAttribute('value',sItem);return false}var bSave=false;if(typeof this.currentConfig[sItem]!=='undefined'){this.state.clipboard.undo={operation:'changeMembers',owner:this.currentConfig,items:{},del:[],show:JUL.Designer.getWhere(this.currentNode),tabIndex:ample.getElementById('tabbox-designer-members').selectedIndex};this.state.clipboard.undo.del.push(sName);this.state.clipboard.undo.items[sItem]=this.currentConfig[sItem];this.currentConfig[sName]=this.currentConfig[sItem];var oWhere=JUL.Designer.getWhere(oNode.childNodes[1].firstChild);if(oWhere.field.required){this.currentConfig[sItem]=oWhere.field.defaultValue}else{delete this.currentConfig[sItem]}bSave=true}if(bSave){this.save(true,true)}JUL.Designer.state.map[oNode.getAttribute('id')]=sName;oNode.firstChild.setAttribute('label',sName);var sId=oNode.childNodes[1].firstChild.getAttribute('id');JUL.Designer.state.map[sId].key(sName);JUL.Designer.state.map[sId].field.label=sName;JUL.Designer.state.map['button-code-'+sId].key(sName);JUL.Designer.state.map['button-code-'+sId].field.label=sName;ample.getElementById('button-code-'+sId).setAttribute('tooltiptext',JUL.Designer.state.map[sId].field.template?sName+': '+JUL.Designer.state.map[sId].field.template:sName);ample.getElementById('listbox-designer-'+sType).clearSelection();return sName},changeType:function(sType){var oWhere=JUL.Designer.getWhere(this.currentNode);var oConfig=oWhere.val();var sId=this.getId(oConfig);if(sId&&this.current.logic[sId]&&this.current.logic[sId][oWhere.showWhat]&&typeof this.current.logic[sId][oWhere.showWhat]==='object'){oConfig=this.current.logic[sId]}if(!oConfig[oWhere.showWhat]||JUL.typeOf(oConfig[oWhere.showWhat])===sType){return}if(sType==='Object'&&JUL.typeOf(oConfig[oWhere.showWhat])==='Array'){if(oConfig[oWhere.showWhat].length>1){ample.getElementById('menulist-designer-members-type').setAttribute('value','Array');window.alert('Please reduce the array to at most one element');return}var oChildWhere=null;if(oConfig[oWhere.showWhat].length){this.state.clipboard.undo={operation:'changeType',target:oConfig,what:oWhere.showWhat,toArray:false,show:this.findPath(oWhere.val())};oConfig[oWhere.showWhat]=oConfig[oWhere.showWhat][0];oChildWhere=JUL.Designer.getWhere(this.currentNode.querySelector('xul|treechildren').firstChild);oChildWhere.ref(oConfig,oWhere.showWhat);delete oChildWhere.parent;this.save(true,true)}}if(sType==='Array'&&JUL.typeOf(oConfig[oWhere.showWhat])==='Object'){this.state.clipboard.undo={operation:'changeType',target:oConfig,what:oWhere.showWhat,toArray:true,show:this.findPath(oWhere.val())};oConfig[oWhere.showWhat]=[oConfig[oWhere.showWhat]];oChildWhere=JUL.Designer.getWhere(this.currentNode.querySelector('xul|treechildren').firstChild);oChildWhere.ref(oConfig[oWhere.showWhat],0);oChildWhere.parent=new JUL.Ref({ref:oConfig,key:oWhere.showWhat});this.save(true,true)}},changeWhere:function(sTarget){var oWhere=JUL.Designer.getWhere(this.currentNode);var sWhere='ui';var oConfig=oWhere.val();var sId=this.getId(oConfig);if(sId&&this.current.logic[sId]&&this.current.logic[sId].hasOwnProperty(oWhere.showWhat)){sWhere='logic'}if(sTarget===sWhere){return}var bArray=JUL.typeOf(oConfig[oWhere.showWhat])==='Array';var oChild=null;var oChildWhere=null;if(sTarget==='logic'&&sWhere==='ui'){if(!sId){ample.getElementById('menulist-designer-members-where').setAttribute('value','ui');window.alert('The component must have an ID or a binding ID');return}if(!oConfig[oWhere.showWhat]){return}this.state.clipboard.undo={operation:'changeWhere',where:oWhere,what:oWhere.showWhat,toLogic:true,show:this.findPath(oWhere.val())};this.current.logic[sId][oWhere.showWhat]=oConfig[oWhere.showWhat];delete oConfig[oWhere.showWhat];oChild=this.currentNode.querySelector('xul|treechildren').firstChild;while(oChild){oChildWhere=JUL.Designer.getWhere(oChild);if(bArray){oChildWhere.parent.ref(this.current.logic[sId])}else{oChildWhere.ref(this.current.logic[sId])}oChild=oChild.nextSibling}this.save(true,true)}if(sTarget==='ui'&&sWhere==='logic'){this.state.clipboard.undo={operation:'changeWhere',where:oWhere,what:oWhere.showWhat,toLogic:false,show:this.findPath(oWhere.val())};oConfig[oWhere.showWhat]=this.current.logic[sId][oWhere.showWhat];delete this.current.logic[sId][oWhere.showWhat];oChild=this.currentNode.querySelector('xul|treechildren').firstChild;while(oChild){oChildWhere=JUL.Designer.getWhere(oChild);if(bArray){oChildWhere.parent.ref(oConfig)}else{oChildWhere.ref(oConfig)}oChild=oChild.nextSibling}this.save(true,true)}},checkSave:function(sPending,oArg){if(this.state.notSaved&&window.confirm('Project not saved. Do you want to save it now?')){if(sPending){this.state.pending=sPending}if(oArg){this.state.pendingArg=oArg}this.state.currentOperation='save';
this.save();return true}return false},cleanConfig:function(oConfig){var oCurrent=this.currentParser;if(!oCurrent){return}var aInstantiate=oCurrent.getMembers(oConfig);JUL.Designer.keySort(oConfig,[].concat(this.current.listenersProperty,aInstantiate),[oCurrent.classProperty,oCurrent.tagProperty,oCurrent.idProperty,oCurrent.bindingProperty,oCurrent.instantiateProperty],true);var sId=this.getId(oConfig);var oTarget=this.getTarget(oConfig,sId);if(oTarget[this.current.listenersProperty]){if(JUL.Designer.isEmpty(oTarget[this.current.listenersProperty])){delete oTarget[this.current.listenersProperty]}else{JUL.Designer.keySort(oTarget[this.current.listenersProperty],null,null,true)}}if(oTarget!==oConfig){if(JUL.Designer.isEmpty(oTarget)){delete this.current.logic[sId]}else{JUL.Designer.keySort(oTarget,[].concat(this.current.listenersProperty,aInstantiate),[oCurrent.classProperty,oCurrent.tagProperty,oCurrent.idProperty,oCurrent.bindingProperty,oCurrent.instantiateProperty],true)}}},cleanTree:function(oUi,oLogic){oUi=oUi||this.current.ui;oLogic=oLogic||this.current.logic;var oTree={ui:null,logic:null};if(!oUi){return oTree}oTree.logic=JUL.Designer.keySort(oLogic);var oCurrent=this.currentParser;var sListeners=this.current.listenersProperty;var fClean=function(oConfig){var aMembers=oCurrent.getMembers(oConfig);oConfig=JUL.Designer.keySort(oConfig,[].concat(sListeners,aMembers),[oCurrent.classProperty,oCurrent.tagProperty,oCurrent.idProperty,oCurrent.bindingProperty,oCurrent.instantiateProperty]);if(oConfig[oCurrent.classProperty]===oCurrent.defaultClass){delete oConfig[oCurrent.classProperty]}var sId=this.getId(oConfig,oCurrent);var oTarget=this.getTarget(oConfig,sId,oTree.logic,oCurrent);if(oTarget[sListeners]){if(JUL.Designer.isEmpty(oTarget[sListeners])){delete oTarget[sListeners]}else{oTarget[sListeners]=JUL.Designer.keySort(oTarget[sListeners])}}if(oTarget!==oConfig){if(JUL.Designer.isEmpty(oTarget)){delete oTree.logic[sId]}else{oTree.logic[sId]=JUL.Designer.keySort(oTarget,[].concat(sListeners,aMembers),[oCurrent.classProperty,oCurrent.tagProperty,oCurrent.idProperty,oCurrent.bindingProperty,oCurrent.instantiateProperty])}}if(!this.current.keepBindings&&(oConfig[oCurrent.idProperty]||sId&&!oTree.logic[sId])){delete oConfig[oCurrent.bindingProperty]}for(var k=0;k<aMembers.length;k++){var sMember=aMembers[k];oTarget=null;if(sId&&oTree.logic[sId]&&oTree.logic[sId][sMember]&&typeof oTree.logic[sId][sMember]==='object'){oTarget=oTree.logic[sId]}else if(oConfig[sMember]&&typeof oConfig[sMember]==='object'){oTarget=oConfig}if(!oTarget){continue}var sType=JUL.typeOf(oTarget[sMember]);if(sType==='Array'){var aChildren=[];for(var i=0;i<oTarget[sMember].length;i++){aChildren[i]=fClean.call(this,oTarget[sMember][i])}oTarget[sMember]=aChildren}else if(sType==='Object'){oTarget[sMember]=fClean.call(this,oTarget[sMember])}}return oConfig};oTree.ui=JUL.typeOf(oUi)==='Array'?oUi.map(fClean,this):fClean.call(this,oUi);if(JUL.Designer.isEmpty(oTree.logic)){oTree.logic=null}return oTree},close:function(){if(!this.state.pending&&this.checkSave('close')){return}this.onSelectNode(null);this.removeTree();this.current={};this.onSwitchCurrent(true)},copy:function(oConfig,bInstance,bNewBinding,oRootLogic,oMapClass){var oLogic={};var oCurrent=null;if(bInstance){oRootLogic=oRootLogic||this.current.logic;var oCheckLogic=this.current.logic;oCurrent=this.currentParser}var fCopy=function(oConfig,bInstance){if(!oConfig||typeof oConfig!=='object'){return oConfig}var sType=JUL.typeOf(oConfig);var oNew;if(sType==='Array'){oNew=[];for(var i=0;i<oConfig.length;i++){oNew.push(fCopy(oConfig[i],bInstance))}return oNew}else if(sType==='Object'){oNew={};var sNewBinding=false;var sId=bInstance?JUL.Designer.designer.getId(oConfig,oCurrent):false;var aMembers=bInstance?oCurrent.getMembers(oConfig):null;if(bInstance&&bNewBinding&&sId&&(!oConfig[oCurrent.idProperty]&&!JUL.Designer.designer.current.noLogic||oCheckLogic[sId])){sNewBinding=(oCurrent.useTags?oConfig[oCurrent.tagProperty]:oConfig[oCurrent.classProperty]||oCurrent.defaultClass)+'-'+JUL.Designer.designer.current.lastComponentId++}for(var sItem in oConfig){if(oConfig.hasOwnProperty(sItem)){oNew[sItem]=fCopy(oConfig[sItem],bInstance&&aMembers.indexOf(sItem)>-1)}}if(bInstance){if(sId&&oRootLogic[sId]){oLogic[sId]=fCopy(oRootLogic[sId],true)}if(sNewBinding){delete oNew[oCurrent.idProperty];oNew[oCurrent.bindingProperty]=sNewBinding;if(oLogic[sId]){oLogic[sNewBinding]=oLogic[sId];delete oLogic[sId]}}if(oMapClass){var sClass=oNew[oCurrent.classProperty]||oCurrent.defaultClass;if(oMapClass[sClass]&&oMapClass[sClass]!==sClass){oNew[oCurrent.classProperty]=oMapClass[sClass]}}}return oNew}else{return oConfig}};if(bInstance){var oResult={ui:fCopy(oConfig,true)};oResult.logic=oLogic;return oResult}else{return fCopy(oConfig)}},createXml:function(oConfig){if(!oConfig){return null}var aTag=(oConfig[this.classProperty]+(this.useTags?':'+oConfig[this.tagProperty]:'')).split(':');if(aTag.length>2){aTag=[aTag.shift()].concat(aTag.join(':'))}var oWidget=aTag.length>1&&this.xmlDoc.createElementNS?this.xmlDoc.createElementNS(this.xmlNS[aTag[0]]||null,aTag[0]===this.defaultClass?aTag[1]:aTag.join(':')):this.xmlDoc.createElement(aTag.length>1&&aTag[0]===this.defaultClass?aTag[1]:aTag.join(':'));if(!oWidget){return null}var aInstantiate=this.getMembers(oConfig);for(var sItem in JUL.Designer.keySort(oConfig,null,['type',this.idProperty,this.cssProperty,'style'])){if(oConfig.hasOwnProperty(sItem)&&aInstantiate.indexOf(sItem)<0&&[this.listenersProperty,this.htmlProperty,this.tagProperty,this.classProperty,this.parentProperty].indexOf(sItem)<0){var aAttr=sItem.split(':');if(aAttr.length>2){aAttr=[aAttr.shift()].concat(aAttr.join(':'))}if(aAttr[aAttr.length-1]===this.cssProperty){aAttr[aAttr.length-1]='class'}var sAttr=['Array','Date','Function','Object','Null','RegExp'].indexOf(JUL.typeOf(oConfig[sItem]))>-1?this.obj2str(oConfig[sItem]):oConfig[sItem].toString();if(this.referencePrefix&&typeof oConfig[sItem]==='string'&&sAttr.substr(0,this.referencePrefix.length)===this.referencePrefix){sAttr=JUL.trim(sAttr.substr(this.referencePrefix.length))}if(aAttr.length>1&&oWidget.setAttributeNS){oWidget.setAttributeNS(this.xmlNS[aAttr[0]]||null,aAttr[0]===this.defaultClass?aAttr[1]:aAttr.join(':'),sAttr)}else{oWidget.setAttribute(aAttr.length>1&&aAttr[0]===this.defaultClass?aAttr[1]:aAttr.join(':'),sAttr)}}}if(this.exportListeners&&oConfig[this.listenersProperty]&&typeof oConfig[this.listenersProperty]==='object'){var oListeners=oConfig[this.listenersProperty];for(sItem in JUL.Designer.keySort(oListeners)){if(oListeners.hasOwnProperty(sItem)){var aAll=[].concat(oListeners[sItem]);for(var j=0;j<aAll.length;j++){var sListener=['Array','Date','Function','Object','Null','RegExp'].indexOf(JUL.typeOf(aAll[j]))>-1?JUL.Designer.parser.obj2str(aAll[j]):aAll[j].toString();if(this.stripFunction&&typeof aAll[j]==='function'){sListener=sListener.slice(sListener.indexOf('{')+1,sListener.lastIndexOf('}'));if(JUL.trim(sListener).split('\n').length<2){sListener=JUL.trim(sListener)}}oWidget.setAttribute(this.listenerPrefix+sItem,sListener)}}}}if(typeof oConfig[this.htmlProperty]!=='undefined'){var oDiv=document.getElementById('div-process-xml');if(!oDiv){oDiv=document.createElement('div');oDiv.setAttribute('id','div-process-xml');oDiv.style.cssText='display:none';document.body.appendChild(oDiv)}oDiv.innerHTML=oConfig[this.htmlProperty].toString().replace(/</g,'&lt;').replace(/>/g,'&gt;');var oText=this.xmlDoc.createTextNode(oDiv.textContent||oDiv.innerText||'');oDiv.innerHTML='';oWidget.appendChild(oText)}if(oConfig[this.parentProperty]&&typeof oConfig[this.parentProperty]==='object'){oConfig[this.parentProperty].appendChild(oWidget)}return oWidget},del:function(){if(!this.current.ns){window.alert('There is no current project');return}if(!window.confirm('Are you sure to permanently delete \''+this.current.title+'\' project?')){return}ample.get('assets/alter.txt',{ts:(new Date).getTime()},function(sResponse){sResponse=JSON.parse(sResponse);if(sResponse.error){window.alert(sResponse.error)}else{JUL.Designer.designer.state.notSaved=false;JUL.Designer.designer.close()}})},downloadUrl:function(){return'#'},fillComponentLists:function(oConfig,bKeep){var oCurrent=this.currentParser;this.initConfig(oConfig);var sId=this.getId(oConfig);var oUiFields={};var oLogicFields={};var oListenersFields={};oUiFields[oCurrent.classProperty]={tooltip:'Component class',required:true,defaultValue:oCurrent.defaultClass};if(oCurrent.useTags){oUiFields[oCurrent.tagProperty]={tooltip:'Component tag',required:true,defaultValue:''}}oUiFields[oCurrent.idProperty]={tooltip:'Component ID'};if(!this.current.noLogic){oUiFields[oCurrent.bindingProperty]={tooltip:'Component binding ID'}}if(typeof oConfig[oCurrent.instantiateProperty]!=='undefined'){oUiFields[oCurrent.instantiateProperty]={tooltip:'Config node instantiation members'}}var sItem;var oMembers=null;var oEvents=null;var aExclude=this.getExclude(oCurrent,oConfig);if(JUL.Designer.framework.current.components){var oComponent=this.findComponent(oConfig);if(oComponent){oMembers=JUL.Designer.framework.getInherited(oComponent,'members')||{};for(sItem in JUL.Designer.keySort(oMembers)){if(oMembers.hasOwnProperty(sItem)&&aExclude.indexOf(sItem)<0&&!oMembers[sItem].hidden){if(sId&&this.current.logic[sId]&&oMembers[sItem].logic){oLogicFields[sItem]=oMembers[sItem]}else{oUiFields[sItem]=oMembers[sItem]}if(oMembers[sItem].required&&(!oMembers[sItem].logic||!sId||!this.current.logic[sId])&&typeof oConfig[sItem]==='undefined'){oConfig[sItem]=oMembers[sItem].defaultValue}if(oMembers[sItem].required&&oMembers[sItem].logic&&sId&&this.current.logic[sId]&&typeof this.current.logic[sId][sItem]==='undefined'){this.current.logic[sId][sItem]=oMembers[sItem].defaultValue}}}oEvents=JUL.Designer.framework.getInherited(oComponent,'events')||{};for(sItem in JUL.Designer.keySort(oEvents)){if(oEvents.hasOwnProperty(sItem)&&!oEvents[sItem].hidden){oListenersFields[sItem]=oEvents[sItem]}}}}for(sItem in JUL.Designer.keySort(oConfig)){if(oConfig.hasOwnProperty(sItem)&&aExclude.indexOf(sItem)<0&&(!oMembers||!oMembers[sItem]||oMembers[sItem].hidden||sId&&this.current.logic[sId]&&oMembers[sItem].logic)){oUiFields[sItem]={tooltip:'Custom ui member'}}}var oTarget=this.getTarget(oConfig,sId);if(oTarget!==oConfig){for(sItem in JUL.Designer.keySort(oTarget)){if(oTarget.hasOwnProperty(sItem)&&aExclude.indexOf(sItem)<0&&(!oMembers||!oMembers[sItem]||oMembers[sItem].hidden||!oMembers[sItem].logic)){oLogicFields[sItem]={tooltip:'Custom logic member'}}}}for(sItem in JUL.Designer.keySort(oTarget[this.current.listenersProperty])){if(oTarget[this.current.listenersProperty].hasOwnProperty(sItem)&&aExclude.indexOf(sItem)<0&&(!oEvents||!oEvents[sItem])||oEvents[sItem].hidden){oListenersFields[sItem]={tooltip:'Custom event'}}}if(!bKeep){JUL.Designer.empty(ample.getElementById('listbox-designer-ui').body);JUL.Designer.empty(ample.getElementById('listbox-designer-logic').body);JUL.Designer.empty(ample.getElementById('listbox-designer-listeners').body)}JUL.Designer.fillListbox('listbox-designer-ui',oUiFields,oConfig);JUL.Designer.fillListbox('listbox-designer-logic',oLogicFields,oTarget);JUL.Designer.fillListbox('listbox-designer-listeners',oListenersFields,oTarget[this.current.listenersProperty]);var nIndex=ample.getElementById('tabbox-designer-members').selectedIndex;var sType=nIndex?nIndex<2?'logic':'listeners':'ui';switch(sType){case'ui':this.currentConfig=oConfig;break;case'logic':this.currentConfig=oTarget;break;case'listeners':this.currentConfig=oTarget[this.current.listenersProperty];break}},fillInterface:function(){this.removeTree();ample.getElementById('menulist-designer-members').setAttribute('value','');ample.getElementById('menulist-designer-members-type').setAttribute('value','');ample.getElementById('menulist-designer-members-where').setAttribute('value','');this.setMembersMenu();if(this.current.ns){this.buildTree()}ample.getElementById('tree-interface').reflow()},filterMembers:function(oWhere){if(!this.current.ns){return}var oConfig=oWhere?oWhere.val():null;var oComponent=oConfig?this.findComponent(oConfig):null;var oInherit=oComponent?JUL.Designer.framework.getInherited(oComponent,'members')||{}:{};var oDirect=oComponent&&oComponent.members?oComponent.members:{};var aMembers=this.currentParser.getMembers(oConfig);var aMenus=[];for(var j=oComponent?0:2;j<3;j++){for(var i=0;i<aMembers.length;i++){var sItem=aMembers[i];if(!j&&oDirect.hasOwnProperty(sItem)||j===1&&oInherit.hasOwnProperty(sItem)&&!oDirect.hasOwnProperty(sItem)){var oMenu={tag:'menuitem',label:sItem,value:sItem};if(!j&&oDirect[sItem].description){oMenu.tooltiptext=oDirect[sItem].description}if(j===1&&oInherit[sItem].description){oMenu.tooltiptext=oInherit[sItem].description}aMenus.push(oMenu)}if(j===2&&!oInherit.hasOwnProperty(sItem)){aMenus.push({tag:'menuitem',label:sItem,value:sItem,style:'font-style:italic'})}}if(j===1&&aMenus.length&&aMenus.length<aMembers.length){aMenus.push({tag:'menuseparator'})}}var oPopup=ample.getElementById('menulist-designer-members').querySelector('xul|menupopup');JUL.Designer.empty(oPopup);for(i=0;i<aMenus.length;i++){oPopup.appendChild(JUL.Designer.parser.create(aMenus[i]))}},findComponent:function(oConfig){var oComponents=JUL.Designer.framework.current.components;if(!oComponents){return null}var oCurrent=this.currentParser;var sFrameworkNS=JUL.Designer.framework.current.nsAlias||JUL.Designer.framework.current.ns;var sClass=oConfig[oCurrent.classProperty]||oCurrent.defaultClass;if(oCurrent.useTags&&sClass===sFrameworkNS){return oComponents[oConfig[oCurrent.tagProperty]]}if(!oCurrent.useTags){if(JUL.Designer.framework.current.prependNS){var sNs=sFrameworkNS+'.';if(sClass.substr(0,sNs.length)===sNs){return oComponents[sClass.substr(sNs.length)]}}else{return oComponents[sClass]}}return null},findPath:function(oFind,sItem,oRoot,oRootLogic){if(!oRoot){oRoot=this.current.ui}if(!oRootLogic){oRootLogic=this.current.logic}if(!oRoot){return false}var aPath=[];var bFunction=typeof oFind==='function';var bArray=JUL.typeOf(oRoot)==='Array';if(bFunction){if(!bArray&&oFind(oRoot,aPath)){return''}}else{if(!sItem&&oRoot===oFind){return''}if(sItem&&oRoot[sItem]===oFind){return''}}var oParserConfig=this.currentParser;var fobj=function(oCurrent,nLevel){if(!oCurrent){return false}if(bFunction){if(oFind(oCurrent,aPath)){return true}}else{if(!sItem&&oCurrent===oFind){return true}if(sItem&&oCurrent[sItem]===oFind){return true}}var aMembers=oParserConfig.getMembers(oCurrent);var sId=JUL.Designer.designer.getId(oCurrent);for(var i=0;i<aMembers.length;i++){aPath[nLevel]=aMembers[i];var oMember=oCurrent[aMembers[i]];if(sId&&oRootLogic[sId]&&oRootLogic[sId][aMembers[i]]){oMember=oRootLogic[sId][aMembers[i]]}if(oMember){aPath.length=nLevel+1;if(JUL.typeOf(oMember)==='Array'){for(var k=0;k<oMember.length;k++){aPath[nLevel+1]=k;if(oMember[k]&&fobj(oMember[k],nLevel+2)){return true}}}else{if(fobj(oMember,nLevel+1)){return true}}}}aPath.length=nLevel;return false};if(bArray){for(var u=0;u<oRoot.length;u++){aPath=[u];if(fobj(oRoot[u],1)){return aPath.join('.')}}return false}return fobj(oRoot,0)?aPath.join('.'):false},formatXml:function(xml){var reg=/(>)(<)(\/*)/g;var wsexp=/ *(.*) +\n/g;var contexp=/(<.+>)(.+\n)/g;xml=xml.replace(reg,'$1\n$2$3').replace(wsexp,'$1\n').replace(contexp,'$1\n$2');var formatted='';var lines=xml.split('\n');var indent=0;var lastType='other';var transitions={'single->single':0,'single->closing':-1,'single->opening':0,'single->other':0,'closing->single':0,'closing->closing':-1,'closing->opening':0,'closing->other':0,'opening->single':1,'opening->closing':0,'opening->opening':1,'opening->other':1,'other->single':0,'other->closing':-1,'other->opening':0,'other->other':0};for(var i=0;i<lines.length;i++){var ln=lines[i];var single=Boolean(ln.match(/<.+\/>/));var closing=Boolean(ln.match(/<\/.+>/));var opening=Boolean(ln.match(/<[^!].*>/));var type=single?'single':closing?'closing':opening?'opening':'other';var fromTo=lastType+'->'+type;lastType=type;var padding='';indent+=transitions[fromTo];for(var j=0;j<indent;j++){padding+='\t'}if(fromTo==='opening->closing'){formatted=formatted.substr(0,formatted.length-1)+ln+'\n'}else{formatted+=padding+ln+'\n'}}return formatted},getExclude:function(oParserConfig,oConfig){oParserConfig=oParserConfig||this.currentParser;if(!oConfig&&this.currentNode){oConfig=JUL.Designer.getWhere(this.currentNode).val()}var aExclude=oParserConfig.getMembers(oConfig).concat(this.current.listenersProperty,oParserConfig.classProperty,oParserConfig.idProperty,oParserConfig.bindingProperty,oParserConfig.instantiateProperty);if(oParserConfig.useTags){aExclude.push(oParserConfig.tagProperty)}if(oParserConfig.topDown){aExclude.push(oParserConfig.parentProperty)}return aExclude},getFirstChildren:function(oConfig){var sId=this.getId(oConfig);var oLogic=sId?this.current.logic[sId]:false;var aMembers=this.currentParser.getMembers(oConfig);var oComponent=this.findComponent(oConfig);var aDirect=[];for(var j=oComponent&&oComponent.members?0:1;j<2;j++){for(var i=0;i<aMembers.length;i++){var sItem=aMembers[i];if(oConfig[sItem]||oLogic&&oLogic[sItem]){if(j||oComponent.members.hasOwnProperty(sItem)){return sItem}}if(!j&&oComponent.hasOwnProperty(sItem)){aDirect.push(sItem)}}}return aDirect.concat(aMembers)[0]},getFrom:function(sPath,oRoot,oRootLogic){if(!oRoot){oRoot=this.current.ui}if(!oRootLogic){oRootLogic=this.current.logic}if(!oRoot){return this._undef}if(sPath===''){return oRoot}var aPath=sPath.split('.');var oCurrent=oRoot;var sItem='';while(aPath.length){sItem=aPath.shift();if(JUL.typeOf(oCurrent==='Object')){var sId=this.getId(oCurrent);if(sId&&oRootLogic[sId]&&oRootLogic[sId][sItem]){oCurrent=oRootLogic[sId]}}if(typeof oCurrent[sItem]==='undefined'){return oCurrent[sItem]}oCurrent=oCurrent[sItem]}return oCurrent},getId:function(oConfig,oParserConfig){oParserConfig=oParserConfig||this.currentParser;return oConfig[oParserConfig.idProperty]||oConfig[oParserConfig.bindingProperty]},getSelection:function(oNodeList){var aSelect=[];for(var i=0;i<oNodeList.length;i++){var oParent=oNodeList.item(i).parentNode;var bRoot=true;while(oParent&&oParent.nodeName!=='xul:treebody'){if(oNodeList.$indexOf(oParent)>-1){bRoot=false;break}oParent=oParent.parentNode}if(bRoot){aSelect.push(oNodeList.item(i))}}return aSelect},getTarget:function(oConfig,sId,oLogic,oParserConfig){oParserConfig=oParserConfig||this.currentParser;sId=sId||this.getId(oConfig,oParserConfig);oLogic=oLogic||this.current.logic;return sId&&oLogic[sId]?oLogic[sId]:oConfig},initConfig:function(oConfig){var sId=this.getId(oConfig);if(sId&&!this.current.noLogic&&!this.current.logic[sId]&&!oConfig[this.current.listenersProperty]){this.current.logic[sId]={}}var oTarget=this.getTarget(oConfig,sId);if(!oTarget[this.current.listenersProperty]){oTarget[this.current.listenersProperty]={}}},onBindingUpdated:function(oWhere){var sValue=oWhere.val();if(sValue===oWhere.oldValue){return}if(sValue&&typeof this.current.logic[sValue]!=='undefined'){if(typeof oWhere.oldValue==='undefined'){oWhere.del()}else{oWhere.val(oWhere.oldValue)}ample.getElementById(oWhere.field.id).setAttribute('value',oWhere.oldValue||'');return}var sId=oWhere.ref()[this.currentParser.idProperty];this.swapLogic(null,sId||sValue,sId||oWhere.oldValue)},onCellClick:function(){if(!JUL.Designer.framework.current.components){return}if(!this.currentNode){return}var oWhere=JUL.Designer.getWhere(this.currentNode);var oConfig=oWhere.val();var oComponent=this.findComponent(oConfig);if(!oComponent){return}var sPath=this.findPath(oConfig);var oRoot=this.getFrom(this.current.ns,document.getElementById('iframe-test').contentWindow);if(!oRoot){return}var oFind=this.getFrom(sPath,oRoot.ui,oRoot.logic);if(!oFind){return}var fGetRect=JUL.Designer.framework.getInheritedProperty(oComponent,'getBoundingRect');try{if(typeof fGetRect==='string'&&typeof oFind._instance[fGetRect]==='function'){this.showSelect(oFind._instance[fGetRect]())}else if(typeof(fGetRect=JUL.get(fGetRect))==='function'){this.showSelect(fGetRect.call(oFind._instance))}else if(typeof(fGetRect=JUL.get(JUL.Designer.framework.current.getBoundingRect))==='function'){JUL.Designer.designer.showSelect(fGetRect.call(oFind._instance))}}catch(e){}},onClassUpdated:function(oWhere){if(oWhere.val()===oWhere.oldValue){return}this.setCellLabel(this.currentNode,'name');if(this.state.selectTimer){clearTimeout(this.state.selectTimer)}this.state.selectTimer=setTimeout(function(){var oDesigner=JUL.Designer.designer;delete oDesigner.state.selectTimer;oDesigner.onSelectNode(JUL.Designer.designer.currentNode)},100)},onConfigUpdated:function(oWhere){if(oWhere.val()===oWhere.oldValue){return}this.state.clipboard.undo={operation:'changeMembers',owner:oWhere.ref(),items:{},del:[],show:JUL.Designer.getWhere(this.currentNode),tabIndex:ample.getElementById('tabbox-designer-members').selectedIndex};if(typeof oWhere.oldValue==='undefined'){this.state.clipboard.undo.del.push(oWhere.key())}else{this.state.clipboard.undo.items[oWhere.key()]=oWhere.oldValue}this.save(true,true);var oCurrent=this.currentParser;if([oCurrent.classProperty,oCurrent.idProperty,oCurrent.bindingProperty,oCurrent.classProperty,oCurrent.instantiateProperty].indexOf(oWhere.key())>-1||oCurrent.useTags&&oWhere.key()===oCurrent.tagProperty){ample.getElementById(oWhere.field.id).blur()}},onCopyMembers:function(bCut,bRemove){var nIndex=ample.getElementById('tabbox-designer-members').selectedIndex;var sType=nIndex?nIndex<2?'logic':'listeners':'ui';var oItems=ample.getElementById('listbox-designer-'+sType).selectedItems;if(!oItems.length){window.alert('Please select some items');return}if(!bRemove){this.state.clipboard.contentMembers={}}if(bCut){this.state.clipboard.undo={operation:'changeMembers',owner:this.currentConfig,items:{},del:[],show:JUL.Designer.getWhere(this.currentNode),tabIndex:nIndex}}var oWhere;var aExclude=this.getExclude();for(var i=0;i<oItems.length;i++){oWhere=JUL.Designer.getWhere(oItems.item(i).childNodes[1].firstChild);if(oWhere&&typeof oWhere.val()!=='undefined'){if(!bRemove){this.state.clipboard.contentMembers[oWhere.key()]=this.copy(oWhere.val())}if(bCut&&aExclude.indexOf(oWhere.key())<0){this.state.clipboard.undo.items[oWhere.key()]=oWhere.val();if(oWhere.field.required){oWhere.val(oWhere.field.defaultValue)}else{oWhere.del()}}}if(bCut&&aExclude.indexOf(oWhere.key())<0){JUL.Designer.empty(oItems.item(i),true)}}if(!bRemove){delete this.state.clipboard.pasteFilter}if(!bCut){return}if(JUL.Designer.isEmpty(this.state.clipboard.undo.items)){delete this.state.clipboard.undo}else{this.save(true,true)}},onCopyNode:function(bCut,bRemove){var aSelect=this.getSelection(ample.getElementById('tree-interface').selectedItems);if(!aSelect.length){window.alert('Please select some components');return}var oWhere=JUL.Designer.getWhere(this.currentNode);this.removeConfigListeners(oWhere.val());this.cleanConfig(oWhere.val());var aCopy=[];if(!bRemove){this.state.clipboard.contentNodes=[]}for(var u=0;u<aSelect.length;u++){oWhere=JUL.Designer.getWhere(aSelect[u]);aCopy[u]=this.copy(oWhere.val(),true);if(!bRemove){this.state.clipboard.contentNodes.push(aCopy[u])}}if(!bRemove){delete this.state.clipboard.pasteStart;delete this.state.clipboard.pasteEnd;delete this.state.clipboard.mapClass}if(!bCut){oWhere=JUL.Designer.getWhere(this.currentNode);this.fillComponentLists(oWhere.val());this.addConfigListeners(oWhere.val());return}this.state.clipboard.undo={operation:'removeNodes',ui:[],logic:[],where:[],wasArray:[],show:this.findPath(JUL.Designer.getWhere(this.currentNode).val())};for(u=0;u<aSelect.length;u++){this.state.clipboard.undo.ui.push(aCopy[u].ui);this.state.clipboard.undo.logic.push(aCopy[u].logic);oWhere=JUL.Designer.getWhere(aSelect[u]);this.state.clipboard.undo.where.push(oWhere);this.state.clipboard.undo.wasArray.push(JUL.typeOf(oWhere.ref())==='Array')}for(u=aSelect.length-1;u>=0;u--){this.removeTree(aSelect[u],true)}if(this.current.ui&&JUL.typeOf(this.current.ui)==='Array'&&this.current.ui.length===1){this.current.ui=this.current.ui[0];var oFirstWhere=JUL.Designer.getWhere(ample.getElementById('tree-interface').querySelector('xul|treechildren').firstChild);oFirstWhere.ref(this.current,'ui');delete oFirstWhere.parent}this.save(true,true);ample.getElementById('tree-interface').reflow()},onIdUpdated:function(oWhere){var sValue=oWhere.val();if(sValue===oWhere.oldValue){return}if(sValue&&typeof this.current.logic[sValue]!=='undefined'){if(typeof oWhere.oldValue==='undefined'){oWhere.del()}else{oWhere.val(oWhere.oldValue)}ample.getElementById(oWhere.field.id).setAttribute('value',oWhere.oldValue||'');return}this.setCellLabel(this.currentNode,'id');var sBinding=oWhere.ref()[this.currentParser.bindingProperty];this.swapLogic(null,sValue||sBinding,oWhere.oldValue||sBinding)},onInstantiateUpdated:function(oWhere){if(oWhere.val()===oWhere.oldValue){return}this.setCellLabel(this.currentNode,'members');this.showMembers(oWhere.showWhat||this.currentParser.childrenProperty,true);if(this.state.selectTimer){clearTimeout(this.state.selectTimer)}this.state.selectTimer=setTimeout(function(){var oDesigner=JUL.Designer.designer;delete oDesigner.state.selectTimer;oDesigner.onSelectNode(JUL.Designer.designer.currentNode)},100)},onPasteMembers:function(){if(!this.state.clipboard.contentMembers){return}if(!this.currentNode){window.alert('Please elect a component');return}var nIndex=ample.getElementById('tabbox-designer-members').selectedIndex;this.state.clipboard.undo={operation:'changeMembers',owner:this.currentConfig,items:{},del:[],show:JUL.Designer.getWhere(this.currentNode),tabIndex:nIndex};var aExclude=this.getExclude();for(var sItem in this.state.clipboard.contentMembers){if(this.state.clipboard.contentMembers.hasOwnProperty(sItem)&&aExclude.indexOf(sItem)<0&&(!this.state.clipboard.pasteFilter||this.state.clipboard.pasteFilter.indexOf(sItem)>-1)){if(typeof this.currentConfig[sItem]==='undefined'){this.state.clipboard.undo.del.push(sItem)}else{this.state.clipboard.undo.items[sItem]=this.currentConfig[sItem]}this.currentConfig[sItem]=this.copy(this.state.clipboard.contentMembers[sItem])}}delete this.state.clipboard.pasteFilter;if(JUL.Designer.isEmpty(this.state.clipboard.undo.items)&&!this.state.clipboard.undo.del.length){delete this.state.clipboard.undo}else{this.save(true,true);var oWhere=JUL.Designer.getWhere(this.currentNode);this.fillComponentLists(oWhere.val())}},onPasteNode:function(){if(!this.current.ns){return}if(!this.state.clipboard.contentNodes){return}var nStart=typeof this.state.clipboard.pasteStart==='undefined'?0:this.state.clipboard.pasteStart;var nEnd=typeof this.state.clipboard.pasteEnd==='undefined'?this.state.clipboard.contentNodes.length-1:this.state.clipboard.pasteEnd;if(nEnd<nStart){return}this.state.clipboard.undo={operation:'addNodes',where:[],logic:[],show:this.currentNode?this.findPath(JUL.Designer.getWhere(this.currentNode).val()):false};var oNew=null;var sItem='';var oWhere,oConfig;if(this.currentNode){oWhere=JUL.Designer.getWhere(this.currentNode);oConfig=oWhere.val();var sId=this.getId(oConfig);if(sId&&this.current.logic[sId]&&ample.getElementById('menulist-designer-members-where').getAttribute('value')==='logic'){oConfig=this.current.logic[sId]}}else{oWhere={showWhat:'ui'};oConfig=this.current}for(var u=nStart;u<=nEnd;u++){oNew=this.copy(this.state.clipboard.contentNodes[u].ui,true,true,this.state.clipboard.contentNodes[u].logic,this.state.clipboard.mapClass);if(!oConfig[oWhere.showWhat]&&(!this.current.ui||ample.getElementById('menulist-designer-members-type').getAttribute('Value')==='Object')){this.state.clipboard.undo.where.push(new JUL.Ref({ref:oConfig,key:oWhere.showWhat}));oConfig[oWhere.showWhat]=oNew.ui}else{if(!oConfig[oWhere.showWhat]){oConfig[oWhere.showWhat]=[]}if(JUL.typeOf(oConfig[oWhere.showWhat])!=='Array'){oConfig[oWhere.showWhat]=[oConfig[oWhere.showWhat]];this.state.clipboard.undo.toArray=true;if(this.currentNode){ample.getElementById('menulist-designer-members-type').setAttribute('value','Array')}}this.state.clipboard.undo.where.push(new JUL.Ref({ref:oConfig[oWhere.showWhat],key:oConfig[oWhere.showWhat].length,parent:new JUL.Ref({ref:oConfig,key:oWhere.showWhat})}));oConfig[oWhere.showWhat].push(oNew.ui)}for(sItem in oNew.logic){if(oNew.logic.hasOwnProperty(sItem)){this.state.clipboard.undo.logic.push(sItem);this.current.logic[sItem]=oNew.logic[sItem]}}}delete this.state.clipboard.pasteStart;delete this.state.clipboard.pasteEnd;delete this.state.clipboard.mapClass;if(this.currentNode){this.removeTree(this.currentNode,false,true);this.buildTree(this.currentNode,oWhere,true)}else{this.removeTree();this.buildTree()}this.save(true,true);ample.getElementById('tree-interface').reflow()},onSelectNode:function(oNode){if(this.currentNode){var oOldWhere=JUL.Designer.getWhere(this.currentNode);var oOldConfig=oOldWhere.val();if(oOldConfig){this.removeConfigListeners(oOldConfig);this.cleanConfig(oOldConfig)}}ample.getElementById('menulist-designer-members').setAttribute('value','');ample.getElementById('menulist-designer-members-type').setAttribute('value','');ample.getElementById('menulist-designer-members-where').setAttribute('value','');JUL.Designer.empty(ample.getElementById('listbox-designer-ui').body);JUL.Designer.empty(ample.getElementById('listbox-designer-logic').body);JUL.Designer.empty(ample.getElementById('listbox-designer-listeners').body);ample.query(ample.getElementById('tabbox-designer-members').querySelector('xul|tabs').childNodes[1]).show();ample.getElementById('tabbox-designer-members').querySelector('xul|tabs').childNodes[oNode&&this.state.showTab?this.state.showTab:0].$activate();if(oNode){delete this.state.showTab}this.currentNode=oNode;if(oNode){var oWhere=JUL.Designer.getWhere(oNode);var oConfig=oWhere.val();this.setMembersMenu(oConfig);JUL.Designer.framework.fillScrollbox(oConfig);var sId=this.getId(oConfig);var oChildren=oConfig[oWhere.showWhat];if(sId&&this.current.logic[sId]&&this.current.logic[sId][oWhere.showWhat]&&typeof this.current.logic[sId][oWhere.showWhat]==='object'){oChildren=this.current.logic[sId][oWhere.showWhat]}ample.getElementById('menulist-designer-members').setAttribute('value',oWhere.showWhat);ample.getElementById('menulist-designer-members-type').setAttribute('value',oChildren?JUL.typeOf(oChildren):'Array');ample.getElementById('menulist-designer-members-where').setAttribute('value',sId&&this.current.logic[sId]&&this.current.logic[sId][oWhere.showWhat]&&typeof this.current.logic[sId][oWhere.showWhat]==='object'?'logic':'ui');JUL.Designer.state.lastDialog=null;this.fillComponentLists(oConfig,true);this.addConfigListeners(oConfig);this.filterMembers(oWhere)}else{this.currentConfig=null;this.setMembersMenu();JUL.Designer.framework.fillScrollbox();this.filterMembers()}ample.query(ample.getElementById('tabbox-designer-members').querySelector('xul|tabs').childNodes[1])[sId&&this.current.logic[sId]?'show':'hide']()},onSwitchCurrent:function(bClose){delete this.state._xmlOptions;delete this.state.clipboard.undo;this.state.notSaved=false;this.currentParser=this.current.ns?new JUL.UI.Parser(JUL.apply(JUL.apply({},this.current.parserConfig),this.current.parserConfig._otherProperties||{},true)):null;ample.getElementById('deck-test').setAttribute('selectedIndex',bClose?1:0);this.setTitle();ample.getElementById('anchor-test').setAttribute('href',this.current.ns?this.testUrl():'#');ample.getElementById('anchor-download').setAttribute('href',this.current.ns?this.downloadUrl():'#');ample.getElementById('command-no-logic').setAttribute('checked',this.current.noLogic||false);this.test();this.fillInterface();if(JUL.Designer.state.oTestWnd&&!JUL.Designer.state.oTestWnd.closed){JUL.Designer.state.oTestWnd.close()}if(JUL.Designer.app.current.ns){ample.getElementById('anchor-test-app').setAttribute('href',JUL.Designer.app.testUrl());if(JUL.Designer.state.oTestAppWnd&&!JUL.Designer.state.oTestAppWnd.closed){JUL.Designer.state.oTestAppWnd.close();
}JUL.Designer.app.fillMenupopup(true)}if(bClose){return}if(this.current.suggestedFramework&&this.current.suggestedFramework!==JUL.Designer.framework.current.ns){JUL.Designer.framework.open(this.current.suggestedFramework)}},onTestClick:function(oPoint){var fGetRect=JUL.get(JUL.Designer.framework.current.getBoundingRect);var oFound={};var aLabels=[];var fPoint=function(oConfig,aPath){var oComponent=JUL.Designer.designer.findComponent(oConfig);if(!oComponent){return false}var oRect=null;var fRect=JUL.Designer.framework.getInheritedProperty(oComponent,'getBoundingRect');try{if(typeof fRect==='string'&&typeof oConfig._instance[fRect]==='function'){oRect=oConfig._instance[fRect]()}else if(typeof(fRect=JUL.get(fRect))==='function'){oRect=fRect.call(oConfig._instance)}else if(typeof fGetRect==='function'){oRect=fGetRect.call(oConfig._instance)}}catch(e){}if(oRect&&oPoint.x>=oRect.left&&oPoint.x<=oRect.left+oRect.width&&oPoint.y>=oRect.top&&oPoint.y<=oRect.top+oRect.height){var sLabel=(1e10-1-(oRect.zIndex||0)).toFixed(0)+':'+(1e8+oRect.width*oRect.height).toFixed(0)+':'+(1e6-1-aLabels.length).toFixed(0);oFound[sLabel]={rect:oRect,path:aPath.join('.')};aLabels.push(sLabel)}return false};var oRoot=this.getFrom(this.current.ns,document.getElementById('iframe-test').contentWindow);this.findPath(fPoint,null,oRoot.ui,oRoot.logic);if(!aLabels.length){return}aLabels.sort();this.showSelect(oFound[aLabels[0]].rect);this.showPath(oFound[aLabels[0]].path)},onTestLoad:function(){if(!JUL.Designer.designer.current.ns){return}var oTest=document.getElementById('iframe-test');JUL.Designer.addListener(oTest.contentDocument||oTest.contentWindow.document,'click',function(oEvent){var sFocus=JUL.Designer.state._lastFocus;if(sFocus){var oEl=ample.getElementById(sFocus);if(oEl){oEl.blur()}}if(!JUL.Designer.framework.current.components){return}oEvent=oEvent||event;var oPoint={x:oEvent.clientX,y:oEvent.clientY};setTimeout(function(){JUL.Designer.designer.onTestClick(oPoint)},100)},true)},open:function(sItem,bNew){delete this.state.clipboard.undo;ample.get('assets/projects/'+sItem.split('.').join('/')+'.txt',{ts:(new Date).getTime()},function(sResponse){var oProject=JUL.Designer.designer;var oResult=JSON.parse(sResponse,JUL.makeCaller(JUL.Designer.parser,JUL.Designer.jsonReviver));if(oResult.error){if(oResult.error.indexOf('not found')>-1&&bNew){oProject.show('new',oProject.state.initProject);delete oProject.state.initProject}else{window.alert(oResult.error)}return}JUL.Designer.makeCompat(oResult,sResponse);JUL.Designer.panels.browse.hide();oProject.onSelectNode();oProject.removeTree();oProject.current=oResult.result;oProject.state.currentOperation='getJS';oProject.save(true);oProject.onSwitchCurrent()})},refreshXml:function(){JUL.apply(this.state._xmlOptions,{cssProperty:JUL.trim(ample.getElementById('textbox-xml-css').getAttribute('value'))||JUL.UI.cssProperty,htmlProperty:JUL.trim(ample.getElementById('textbox-xml-html').getAttribute('value'))||JUL.UI.htmlProperty,rootWrapper:JUL.trim(ample.getElementById('textbox-xml-wrapper').getAttribute('value'))||'content',listenerPrefix:JUL.trim(ample.getElementById('textbox-xml-listener-prefix').getAttribute('value')),exportListeners:ample.getElementById('checkbox-xml-export-listeners').getAttribute('checked')==='true',stripFunction:ample.getElementById('checkbox-xml-strip-function').getAttribute('checked')==='true',mergeLogic:ample.getElementById('checkbox-xml-merge-logic').getAttribute('checked')==='true',expandMembers:ample.getElementById('checkbox-xml-expand-members').getAttribute('checked')==='true'});ample.getElementById('textbox-xml-css').setAttribute('value',this.state._xmlOptions.cssProperty);ample.getElementById('textbox-xml-html').setAttribute('value',this.state._xmlOptions.htmlProperty);ample.getElementById('textbox-xml-wrapper').setAttribute('value',this.state._xmlOptions.rootWrapper);ample.getElementById('textbox-xml').setAttribute('value',this.toXml(this.state._xmlOptions))},removeConfigListeners:function(oConfig){var oTarget=this.getTarget(oConfig);JUL.Designer.removeValueListener(oTarget[this.current.listenersProperty]);if(oTarget!==oConfig){JUL.Designer.removeValueListener(oTarget)}JUL.Designer.removeValueListener(oConfig)},removeMembers:function(aNames,sType,aNodes){var sName;var bSave=false;var aExclude=this.getExclude();for(var i=0;i<aNames.length;i++){sName=aNames[i];if(aExclude.indexOf(sName)<0){if(typeof this.currentConfig[sName]!=='undefined'){var oWhere=JUL.Designer.getWhere(aNodes.get(i).childNodes[1].firstChild);if(oWhere.field.required){this.currentConfig[sName]=oWhere.field.defaultValue}else{delete this.currentConfig[sName]}bSave=true}JUL.Designer.empty(aNodes.get(i),true)}}if(bSave){this.save(true)}},removeTree:function(oNode,bDeleteConfig,bOnlyChildren,bSelf){if(!oNode){oNode=ample.getElementById('tree-interface').querySelector('xul|treechildren');if(oNode){while(oNode.lastChild){this.removeTree(oNode.lastChild,bDeleteConfig,bOnlyChildren)}}return}var sId=oNode.getAttribute('id');if((!bOnlyChildren||bSelf)&&oNode===this.currentNode){var oClearConfig=JUL.Designer.getWhere(sId).val();if(oClearConfig){this.removeConfigListeners(oClearConfig);this.cleanConfig(oClearConfig)}this.currentNode=null;this.currentConfig=null}var oChildren=oNode.querySelector('xul|treechildren');if(oChildren){while(oChildren.lastChild){this.removeTree(oChildren.lastChild,bDeleteConfig,false,true)}}if(bDeleteConfig){var oWhere=JUL.Designer.getWhere(sId);var oConfig=oWhere.val();if(oConfig){if(bOnlyChildren){if(!bSelf){delete oConfig[oWhere.showWhat];this.setCellLabel(oNode,'members',oConfig)}}else{var sBindingId=this.getId(oConfig);if(!bSelf){if(JUL.typeOf(oWhere.ref())==='Array'){oWhere.ref().splice(oWhere.key(),1);var oNextNode=oNode.nextSibling;while(oNextNode){JUL.Designer.getWhere(oNextNode).key(JUL.Designer.getWhere(oNextNode).key()-1);oNextNode=oNextNode.nextSibling}if(oWhere.parent&&!oWhere.ref().length){oWhere.parent.del()}}else{oWhere.del()}if(oNode.parentNode.parentNode.nodeName==='xul:treeitem'){this.setCellLabel(oNode.parentNode.parentNode,'members')}if(!this.current.ui){this.current.lastComponentId=1}}delete this.current.logic[sBindingId]}}}var oParent=oNode.parentNode;if(!bOnlyChildren){JUL.Designer.empty(oNode,true);delete JUL.Designer.state.map[sId]}if(!bSelf){if(bOnlyChildren&&oChildren&&oNode.nodeName==='xul:treeitem'){JUL.Designer.empty(oChildren,true);oNode.setAttribute('container',false);oNode.parentNode.reflow()}if(!bOnlyChildren&&oParent.nodeName==='xul:treechildren'&&!oParent.items.length){oParent=oParent.parentNode;JUL.Designer.empty(oParent.children,true);if(oParent.nodeName==='xul:treeitem'){oParent.setAttribute('container',false);oParent.parentNode.reflow()}}}},save:function(bJsOnly,bUndo){var oCurrent=!bJsOnly&&this.state.currentOperation!=='save'?this.state.newProject:this.current;if(!bJsOnly&&!JUL.Designer.validNS(oCurrent.ns)){window.alert('Invalid namespace');return}if(!bJsOnly){oCurrent.version='1.'+(new Date).getTime();if(JUL.Designer.app.current.ns){var oModules=JUL.Designer.app.current.modules;for(var sModule in oModules){if(oModules.hasOwnProperty(sModule)){var sNS=oModules[sModule].ns;if(sNS.substr(0,1)==='.'){sNS=JUL.Designer.app.current.ns+sNS}if(sNS===oCurrent.ns){break}}}}}if(!oCurrent.ui){oCurrent.ui=null}var oScript=JUL.apply({},oCurrent);oScript.parserConfig=JUL.apply({_keepInstance:true},oScript.parserConfig);delete oScript.template;delete oScript.lastComponentId;if(!bJsOnly||this.state.currentOperation==='getJS'){JUL.Designer.state.code=this.testJs(oScript)}if(bJsOnly){if(!bUndo){delete this.state.clipboard.undo}if(this.state.currentOperation!=='getJS'){this.state.notSaved=true;if(this.state.timerShow){clearTimeout(this.state.timerShow)}this.state.timerShow=setTimeout(function(){var oProject=JUL.Designer.designer;delete oProject.state.timerShow;JUL.Designer.state.code=oProject.testJs(oScript);var oLocation=document.getElementById('iframe-test').contentWindow.location;oLocation.href=oProject.testUrl()},200)}this.state.currentOperation=''}else{var oWhere=null;if(this.currentNode){oWhere=JUL.Designer.getWhere(this.currentNode);this.removeConfigListeners(oWhere.val());this.cleanConfig(oWhere.val())}JUL.Designer.applyRequired(this.fields,oCurrent);JUL.Designer.applyRequired(this.parserFields,oCurrent.parserConfig);oCurrent=JUL.Designer.keySort(oCurrent,['template','parserConfig','ui','logic']);oCurrent.logic=JUL.Designer.keySort(oCurrent.logic);var oTemplate=JUL.apply({},oCurrent);delete oTemplate.ui;delete oTemplate.logic;delete oTemplate.parserConfig;delete oTemplate.init;delete oTemplate.noLogic;delete oTemplate.lastComponentId;var oData={ts:(new Date).getTime()};if(oWhere){this.fillComponentLists(oWhere.val());this.addConfigListeners(oWhere.val())}ample.ajax({url:'assets/alter.txt',type:'GET',async:this.state.currentOperation!=='save',dataType:'text',data:oData,success:function(sResponse){sResponse=JSON.parse(sResponse);if(sResponse.error){window.alert(sResponse.error);return}var oProject=JUL.Designer.designer;if(oProject.state.currentOperation==='save'){oProject.state.notSaved=false;var sUrl=oProject.testUrl();ample.getElementById('anchor-test').setAttribute('href',sUrl);ample.getElementById('iframe-test').setAttribute('src',sUrl);ample.getElementById('anchor-download').setAttribute('href',oProject.downloadUrl());if(oProject.state.pending){switch(oProject.state.pending){case'new':oProject.show('new');break;case'open':oProject.showBrowse('project');break;case'close':oProject.close();break;case'open_new':oProject.open(oProject.state.pendingArg,true);break}delete oProject.state.pending;delete oProject.state.pendingArg}else{window.alert('Project saved')}}else{JUL.Designer.panels.project.hide();JUL.Designer.state.lastDialog=null;oProject.onSelectNode();oProject.removeTree();oProject.current=oProject.state.newProject;oProject.state.newProject=null;var sModule=JUL.trim(oProject.state.mapsToModule||'');if(sModule&&JUL.Designer.app.current.ns){var oModules=JUL.Designer.app.current.modules;var sNS=oProject.current.ns;var sNSApp=JUL.Designer.app.current.ns;if(sNS.substr(0,sNSApp.length+1)===sNSApp+'.'){sNS=sNS.substr(sNSApp.length)}oModules[sModule]=JUL.apply(oModules[sModule]||{},{ns:sNS});JUL.Designer.app.fillMenupopup();JUL.Designer.app.state.currentOperation='save';JUL.Designer.app.save()}oProject.onSwitchCurrent()}}})}},saveCurrent:function(){if(!this.current.ns){return}this.state.currentOperation='save';this.save()},searchId:function(sText){sText=JUL.trim(sText);if(!sText){return}var bCurrent=false;var aStart=[];var aEnd=[];var sCurrentPath=false;if(this.currentNode){var oWhere=JUL.Designer.getWhere(this.currentNode);sCurrentPath=this.findPath(oWhere.val())}var oCurrent=this.currentParser;var fSearch=function(oConfig,aPath){var sPath=aPath.join('.');if(sPath===sCurrentPath){bCurrent=true}else{if(oConfig[oCurrent.idProperty]===sText||oConfig[oCurrent.bindingProperty]===sText){if(bCurrent){aStart.push(sPath)}else{aEnd.push(sPath)}}}return false};this.findPath(fSearch);aStart=aStart.concat(aEnd);if(!aStart.length){return}this.showPath(aStart[0])},setCellLabel:function(oNode,aLabels,oConfig){var aItems=[].concat(aLabels);if(!oConfig){var oWhere=JUL.Designer.getWhere(oNode);oConfig=oWhere.val()}var oCurrent=this.currentParser;var sId=this.getId(oConfig);for(var i=0;i<aItems.length;i++){switch(aItems[i]){case'name':var sClass=oConfig[oCurrent.classProperty]||oCurrent.defaultClass;oNode.querySelector('xul|treerow').childNodes[0].setAttribute('label',oCurrent.useTags?(sClass===oCurrent.defaultClass?'':sClass+':')+oConfig[oCurrent.tagProperty]:sClass);break;case'id':oNode.querySelector('xul|treerow').childNodes[1].setAttribute('label',oConfig[oCurrent.idProperty]||'');break;case'members':var aMembers=[];var aSearch=oCurrent.getMembers(oConfig);for(var k=0;k<aSearch.length;k++){if(sId&&this.current.logic[sId]&&this.current.logic[sId][aSearch[k]]&&typeof this.current.logic[sId][aSearch[k]]==='object'){aMembers.push(aSearch[k])}else if(oConfig[aSearch[k]]&&typeof oConfig[aSearch[k]]==='object'){aMembers.push(aSearch[k])}}oNode.querySelector('xul|treerow').childNodes[2].setAttribute('label',aMembers.join(', '));break}}},setMembersMenu:function(oConfig,oCurrent){var oMenu=ample.getElementById('menulist-designer-members').querySelector('xul|menupopup');JUL.Designer.empty(oMenu);oCurrent=oCurrent||this.currentParser;if(oCurrent){var aItems=oCurrent.getMembers(oConfig);for(var i=0;i<aItems.length;i++){oMenu.appendChild(JUL.Designer.parser.createComponent({tag:'menuitem',label:aItems[i],value:aItems[i],style:'font-style:italic'}))}}},setTitle:function(){var sTitle;var sDesigner=JUL.Designer.app.current.title||JUL.Designer.title;ample.getElementById('statusbarpanel-app').setAttribute('label',JUL.Designer.app.current.title||'');ample.getElementById('statusbarpanel-project').setAttribute('label',this.current.title||'');ample.getElementById('statusbarpanel-framework').setAttribute('label',JUL.Designer.framework.current.title||'');if(this.current.ns){if(JUL.Designer.framework.current.ns){sTitle=this.current.title+' - '+JUL.Designer.framework.current.title}else{sTitle=this.current.title}window.document.title=this.current.title+' - '+sDesigner}else{if(JUL.Designer.framework.current.ns){sTitle=JUL.Designer.framework.current.title}else{sTitle='Project'}window.document.title=sDesigner}ample.getElementById('label-project').setAttribute('value',sTitle)},shiftNode:function(oNode,bUp){var oPreviousNode=bUp?oNode.previousSibling:oNode;var oNextNode=bUp?oNode:oNode.nextSibling;var oPreviousWhere=JUL.Designer.getWhere(oPreviousNode);var oNextWhere=JUL.Designer.getWhere(oNextNode);this.state.clipboard.undo={operation:'shiftNode',prev:oPreviousWhere,next:oNextWhere,show:this.findPath((bUp?oNextWhere:oPreviousWhere).val())};var oNext=oNextWhere.val();oNextWhere.ref().splice(oNextWhere.key(),1);oNextWhere.ref().splice(oPreviousWhere.key(),0,oNext);var n=oNextWhere.key();oNextWhere.key(oPreviousWhere.key());oPreviousWhere.key(n);this.save(true,true);var oParent=oNode.parentNode;this.removeTree(oNextNode,false,true);oParent.removeChild(oNextNode);oParent.insertBefore(oNextNode,oPreviousNode);this.buildTree(oNextNode,oNextWhere,true);ample.getElementById('tree-interface').reflow();if(bUp){ample.getElementById('tree-interface').selectItem(oNextNode)}},show:function(sOperation,oInit){if(sOperation==='edit'&&!this.current.ns){window.alert('There is no current project');return}if(sOperation==='new'&&!oInit&&!this.state.pending&&this.checkSave('new')){return}this.state.newProject={ui:null,logic:{},parserConfig:{},lastComponentId:1};var oAppendFields=null;delete this.state.mapsToModule;if(sOperation==='new'&&JUL.Designer.app.current.ns&&!oInit){var oApp=JUL.Designer.app.current;var sModule='module1';var n=2;while(oApp.modules[sModule]){sModule='module'+n++}oInit={ns:oApp.ns+'.'+sModule,title:oApp.title+' - '+sModule.substr(0,1).toUpperCase()+sModule.substr(1),parserConfig:this.copy(oApp.defaultParser)};if(oApp.preferredFramework){oInit.suggestedFramework=oApp.preferredFramework}oAppendFields={mapsToModule:{tooltip:'if non-empty, the module with this name will be added or updated to map to this project',template:'<string>'}};this.state.mapsToModule=sModule}var oCurrent=this.state.newProject;if(sOperation==='new'&&JUL.Designer.framework.current.ns){oCurrent.suggestedFramework=JUL.Designer.framework.current.ns}if(oInit){JUL.apply(oCurrent,oInit)}if(sOperation==='edit'){for(var sItem in this.current){if(this.current.hasOwnProperty(sItem)){if(sItem==='ui'||sItem==='logic'){oCurrent[sItem]=this.current[sItem]}else{oCurrent[sItem]=this.copy(this.current[sItem])}}}}JUL.Designer.empty(ample.getElementById('listbox-project-settings').body);JUL.Designer.empty(ample.getElementById('listbox-project-parser').body);if(!oCurrent.template){oCurrent.template=JUL.Designer.config.defaultTemplate}ample.getElementById('textbox-project-template').setAttribute('value',oCurrent.template);JUL.Designer.fillListbox('listbox-project-settings',this.fields,oCurrent);if(oAppendFields){JUL.Designer.fillListbox('listbox-project-settings',oAppendFields,this.state)}JUL.Designer.fillListbox('listbox-project-parser',this.parserFields,oCurrent.parserConfig);this.state.currentOperation=sOperation;JUL.Designer.panels.project.setAttribute('title',sOperation==='new'?'New project':'Edit project - '+oCurrent.title);JUL.Designer.state.lastDialog=JUL.Designer.panels.project;JUL.Designer.panels.project.showModal();var oTabs=JUL.Designer.panels.project.querySelector('xul|tabs');oTabs.firstChild.$activate()},showBrowse:function(sType){if(sType==='project'&&!this.state.pending&&this.checkSave('open')){return}JUL.Designer.state.browseType=sType;JUL.Designer.fillBrowseList();JUL.Designer.panels.browse.setAttribute('title','Open '+sType.replace('app','application'));JUL.Designer.panels.browse.showModal()},showClipboard:function(){var oClipboard=this.state.clipboard;var aNodes=oClipboard.contentNodes||[];var oMembers=oClipboard.contentMembers||{};var oScript={};var sText='/* Components\' UI */\n';for(var i=0;i<aNodes.length;i++){oScript[i]=aNodes[i].ui}sText=sText+'['+JUL.Designer.parser.obj2str(oScript).slice(1,-1)+']\n';sText=sText+'\n/* Components\' logic */\n';oScript={};for(i=0;i<aNodes.length;i++){JUL.apply(oScript,aNodes[i].logic)}sText=sText+JUL.Designer.parser.obj2str(oScript)+'\n';ample.getElementById('textbox-clipboard-components').setAttribute('value',sText);sText='/* Members */\n';sText=sText+JUL.Designer.parser.obj2str(oMembers)+'\n';ample.getElementById('textbox-clipboard-members').setAttribute('value',sText);sText='* special members ';if(this.current.ns){sText=sText+' like '+this.getExclude().map(function(s){return"'"+s+"'"}).join(', ')+' '}sText=sText+'won\'t be pasted over';ample.getElementById('description-exclude-paste').setAttribute('value',sText);if(typeof oClipboard.pasteStart==='undefined'){ample.getElementById('checkbox-paste-range').setAttribute('checked',false);ample.getElementById('textbox-range-start').setAttribute('value','');ample.getElementById('textbox-range-end').setAttribute('value','');ample.getElementById('textbox-range-start').setAttribute('disabled',true);ample.getElementById('textbox-range-end').setAttribute('disabled',true)}if(typeof oClipboard.pasteFilter==='undefined'){ample.getElementById('checkbox-paste-filter').setAttribute('checked',false);ample.getElementById('textbox-filter-members').setAttribute('value','');ample.getElementById('textbox-filter-members').setAttribute('disabled',true)}if(typeof oClipboard.mapClass==='undefined'){ample.getElementById('checkbox-map-class').setAttribute('checked',false);ample.getElementById('textbox-map-class-from').setAttribute('value','');ample.getElementById('textbox-map-class-to').setAttribute('value','');ample.getElementById('textbox-map-class-from').setAttribute('disabled',true);ample.getElementById('textbox-map-class-to').setAttribute('disabled',true)}JUL.Designer.panels.clipboard.showModal()},showJs:function(){if(!this.current.ns){return}var oCurrent=this.current;var oWhere=null;if(this.currentNode){oWhere=JUL.Designer.getWhere(this.currentNode);this.removeConfigListeners(oWhere.val());this.cleanConfig(oWhere.val())}JUL.Designer.applyRequired(this.fields,oCurrent);JUL.Designer.applyRequired(this.parserFields,oCurrent.parserConfig);var oJS=JUL.Designer.keySort(oCurrent,['template','parserConfig','ui','logic']);oJS.logic=JUL.Designer.keySort(oJS.logic);delete oJS.template;delete oJS.lastComponentId;ample.getElementById('textbox-js').setAttribute('value',this.testJs(oJS,true));if(oWhere){this.fillComponentLists(oWhere.val());this.addConfigListeners(oWhere.val())}var oDialog=JUL.Designer.panels.js;oDialog.setAttribute('title',this.current.title+' - JavaScript');oDialog.showModal();setTimeout(function(){ample.getElementById('textbox-js').focus()},500)},showMembers:function(sWhat,bForce){var oCurrent=this.currentParser;var oWhere=JUL.Designer.getWhere(this.currentNode);var oConfig=oWhere.val();var aItems=oCurrent.getMembers(oConfig);if(aItems.indexOf(sWhat)<0){return}var sId=this.getId(oConfig);if(!bForce&&sWhat===oWhere.showWhat){return}var sType=oConfig[sWhat]?JUL.typeOf(oConfig[sWhat]):'Array';if(sId&&this.current.logic[sId]&&this.current.logic[sId][sWhat]&&typeof this.current.logic[sId][sWhat]==='object'){sType=JUL.typeOf(this.current.logic[sId][sWhat])}ample.getElementById('menulist-designer-members-type').setAttribute('value',sType);ample.getElementById('menulist-designer-members-where').setAttribute('value',sId&&this.current.logic[sId]&&this.current.logic[sId][sWhat]&&typeof this.current.logic[sId][sWhat]==='object'?'logic':'ui');this.removeTree(this.currentNode,false,true);oWhere.showWhat=sWhat;this.buildTree(this.currentNode,oWhere,true);ample.getElementById('tree-interface').reflow()},showPath:function(sPath,sWhatChildren){var oFind=this.getFrom(sPath);if(!oFind){return}var oQuery=ample.query('#tree-interface>xul|treebody>xul|treechildren');if(!oQuery.length){return}var oRoot=oQuery.get(0);var oWhere=null;var aPath=sPath.length?sPath.split('.'):[];if(aPath.length&&JUL.UI._regExps.uint.test(aPath[0])){oRoot=oRoot.items.item(parseInt(aPath[0]));aPath.shift()}else{oRoot=oRoot.items.item(0)}var oNode=oRoot;oNode.setAttribute('open',true);var sItem='';while(aPath.length){sItem=aPath.shift();oWhere=JUL.Designer.getWhere(oNode);if(sItem!==oWhere.showWhat){this.removeTree(oNode,false,true);oWhere.showWhat=sItem;this.buildTree(oNode,oWhere,true)}if(!aPath.length){oNode=oNode.querySelector('xul|treechildren').items.item(0);oNode.setAttribute('open',true);break}sItem=parseInt(aPath[0]);if(isNaN(sItem)){sItem=0}else{aPath.shift()}oNode=oNode.querySelector('xul|treechildren').items.item(sItem);oNode.setAttribute('open',true)}if(sWhatChildren){oWhere=JUL.Designer.getWhere(oNode)}if(sWhatChildren&&oWhere.showWhat!==sWhatChildren){this.removeTree(oNode,false,true);oWhere.showWhat=sWhatChildren;this.buildTree(oNode,oWhere,true)}ample.getElementById('tree-interface').reflow();oNode.scrollIntoView();ample.getElementById('tree-interface').selectItem(oNode)},showSelect:function(oRect){ample.getElementById('statusbarpanel-selection').setAttribute('label',oRect?(typeof oRect.zIndex==='undefined'?'':oRect.zIndex.toFixed(0)+': ')+'['+oRect.left.toFixed(0)+', '+oRect.top.toFixed(0)+'] -> ['+(oRect.left+oRect.width).toFixed(0)+', '+(oRect.top+oRect.height).toFixed(0)+']':'');var oTest=document.getElementById('iframe-test');var oDocument=oTest.contentDocument||oTest.contentWindow.document;var oLines={top:'line-select-top',left:'line-select-left',bottom:'line-select-bottom',right:'line-select-right'};if(this.state.hintTimer){clearTimeout(this.state.hintTimer);delete this.state.hintTimer}var oSelect;for(var sItem in oLines){if(oLines.hasOwnProperty(sItem)&&(oSelect=oDocument.getElementById(oLines[sItem]))){JUL.Designer.empty(oSelect,true)}}if(!oRect){return}for(sItem in oLines){if(oLines.hasOwnProperty(sItem)){oSelect=oDocument.createElement('div');oSelect.setAttribute('id',oLines[sItem]);oSelect.style.cssText=oSelect.style.cssText+'position:absolute;z-index:16777271;border:1px solid red;'+(sItem==='left'||sItem==='right'?'width:0.1px;':'height:0.1px;')+(sItem==='left'||sItem==='right'?'height:'+oRect.height+'px;':'width:'+oRect.width+'px;')+(sItem==='right'?'left:'+(oRect.left+oRect.width)+'px;':'left:'+oRect.left+'px;')+(sItem==='bottom'?'top:'+(oRect.top+oRect.height)+'px;':'top:'+oRect.top+'px;');oDocument.body.appendChild(oSelect)}}this.state.hintTimer=setTimeout(function(){delete JUL.Designer.designer.state.hintTimer;ample.getElementById('statusbarpanel-selection').setAttribute('label','');var oSelect;for(var sItem in oLines){if(oLines.hasOwnProperty(sItem)&&(oSelect=oDocument.getElementById(oLines[sItem]))){JUL.Designer.empty(oSelect,true)}}},3e3)},showXml:function(){if(!this.current.ns){return}this.state._xmlOptions=this.state._xmlOptions||{cssProperty:JUL.UI.cssProperty,htmlProperty:JUL.UI.htmlProperty,rootWrapper:'content',exportListeners:false,stripFunction:false,listenerPrefix:'',mergeLogic:false,expandMembers:false};ample.getElementById('textbox-xml-css').setAttribute('value',this.state._xmlOptions.cssProperty);ample.getElementById('textbox-xml-html').setAttribute('value',this.state._xmlOptions.htmlProperty);ample.getElementById('textbox-xml-wrapper').setAttribute('value',this.state._xmlOptions.rootWrapper);ample.getElementById('checkbox-xml-export-listeners').setAttribute('checked',this.state._xmlOptions.exportListeners);ample.getElementById('checkbox-xml-strip-function').setAttribute('checked',this.state._xmlOptions.stripFunction);ample.getElementById('textbox-xml-listener-prefix').setAttribute('value',this.state._xmlOptions.listenerPrefix);ample.getElementById('checkbox-xml-merge-logic').setAttribute('checked',this.state._xmlOptions.mergeLogic);ample.getElementById('checkbox-xml-expand-members').setAttribute('checked',this.state._xmlOptions.expandMembers);ample.getElementById('textbox-xml').setAttribute('value',this.toXml(this.state._xmlOptions));var oDialog=JUL.Designer.panels.xml;oDialog.setAttribute('title',this.current.title+' - XML layout');oDialog.showModal();setTimeout(function(){ample.getElementById('textbox-xml').focus()},500)},swapLogic:function(oWhere,sNewId,sOldId,bUndo){if(sNewId===sOldId){return}if(!bUndo&&this.current.noLogic&&(!sOldId||!this.current.logic[sOldId])){return}oWhere=oWhere||JUL.Designer.getWhere(this.currentNode);var oConfig=oWhere.val();if(sNewId){if(sOldId&&this.current.logic[sOldId]){this.current.logic[sNewId]=this.current.logic[sOldId];delete this.current.logic[sOldId]}else{this.current.logic[sNewId]={};var oComponent=this.findComponent(oConfig);if(oComponent){var oMembers=JUL.Designer.framework.getInherited(oComponent,'members')||{};for(var sItem in JUL.Designer.keySort(oMembers)){if(oMembers.hasOwnProperty(sItem)&&oMembers[sItem].logic&&typeof oConfig[sItem]!=='undefined'){this.current.logic[sNewId][sItem]=oConfig[sItem];delete oConfig[sItem]}}}if(oConfig[this.current.listenersProperty]){this.current.logic[sNewId][this.current.listenersProperty]=oConfig[this.current.listenersProperty];delete oConfig[this.current.listenersProperty]}}}else{if(sOldId&&this.current.logic[sOldId]){JUL.apply(oConfig,this.current.logic[sOldId]);delete this.current.logic[sOldId]}else{return}}if(bUndo){return}if(this.state.selectTimer){clearTimeout(this.state.selectTimer)}this.state.selectTimer=setTimeout(function(){var oDesigner=JUL.Designer.designer;delete oDesigner.state.selectTimer;oDesigner.onSelectNode(JUL.Designer.designer.currentNode)},100)},test:function(){if(this.current.ns){var sUrl=this.testUrl();var sOld=ample.getElementById('iframe-test').getAttribute('src');if(sOld===sUrl){var oLocation=document.getElementById('iframe-test').contentWindow.location;oLocation.href=sUrl}else{ample.getElementById('iframe-test').setAttribute('src',sUrl)}}else{ample.getElementById('iframe-test').setAttribute('src','about:blank')}},testJs:function(oJs,bComment){var sJs='/* generated by '+JUL.Designer.title+' version '+JUL.Designer.version+' */\n';oJs.parserConfig=JUL.apply(JUL.apply({},oJs.parserConfig),oJs.parserConfig._otherProperties||{},true);if(bComment){var oProject=JUL.Designer.keySort(oJs);delete oProject.parserConfig;delete oProject.ui;delete oProject.logic;var oParser=JUL.Designer.keySort(oJs.parserConfig);delete oParser._keepInstance;delete oParser._otherProperties;for(var sItem in oParser){if(oParser.hasOwnProperty(sItem)&&typeof JUL.UI[sItem]!=='undefined'&&JSON.stringify(oParser[sItem])===JSON.stringify(JUL.UI[sItem])){delete oParser[sItem]}}oJs=this.cleanTree(oJs.ui,oJs.logic);var aItems=[{suf:'',ref:oProject,desc:''},{suf:'.parserConfig',ref:oParser,desc:' parser config'},{suf:'.ui',ref:oJs.ui,desc:' UI'},{suf:'.logic',ref:oJs.logic,desc:' logic'}];sJs=sJs+'/* \''+oProject.title+'\' namespace */\n';sJs=sJs+"JUL.ns('"+oProject.ns+"');\n\n";for(var i=0;i<aItems.length;i++){var oItem=aItems[i];sJs=sJs+(oItem.suf?oProject.ns+oItem.suf+' =\n':'JUL.apply('+oProject.ns+',\n');sJs=sJs+'/* begin \''+oProject.title+"'"+oItem.desc+' */\n';sJs=sJs+JUL.Designer.parser.obj2str(oItem.ref)+'\n';sJs=sJs+'/* end \''+oProject.title+"'"+oItem.desc+' */\n';sJs=sJs+(oItem.suf?'':')')+';\n\n'}}else{sJs=sJs+"JUL.ns('"+oJs.ns+"');\n";sJs=sJs+'JUL.apply('+oJs.ns+', '+JUL.Designer.parser.obj2str(oJs)+');\n'}return sJs},testUrl:function(){return'assets/projects/'+encodeURIComponent(this.current.ns)+'.html?'+'version='+encodeURIComponent(this.current.version)},toXml:function(oOptions){var sHeader='<'+'?xml version="1.0"?'+'>';if(!this.current.ui){return sHeader}oOptions=oOptions||{};oOptions=JUL.apply({exportListeners:true,stripFunction:true,listenerPrefix:'',listenersProperty:this.current.listenersProperty,mergeLogic:true,expandMembers:!this.currentParser.useTags,rootWrapper:'root'},[this.current.parserConfig,oOptions]);oOptions.topDown=true;if(oOptions.expandMembers){oOptions.membersProperties=[].concat(oOptions.childrenProperty,oOptions.membersProperties||[]);oOptions.childrenProperty='_children_'}oOptions.xmlDoc=JUL.UI._createXml(sHeader.replace('"1.0"','"1.0" encoding="UTF-8"')+'<root xmlns="#customXMLns:" />');oOptions.xmlDoc.removeChild(oOptions.xmlDoc.lastChild);var bArray=JUL.typeOf(this.current.ui)==='Array';oOptions.xmlNS=JUL.apply({},JUL.UI.xmlNS);for(var sPos in oOptions.xmlNS){if(oOptions.xmlNS.hasOwnProperty(sPos)){oOptions.xmlNS[sPos]='#customXMLns:'+oOptions.xmlNS[sPos]}}oOptions.customFactory=this.createXml;var oParser=new JUL.UI.Parser(oOptions);var oUi=oOptions.expandMembers?bArray?this.current.ui.map(oParser.expand,oParser):oParser.expand(this.current.ui):this.current.ui;var oLogic=null;if(oOptions.mergeLogic){oLogic=oOptions.expandMembers?JUL.apply({},this.current.logic):this.current.logic;if(oOptions.expandMembers){for(var sItem in oLogic){if(oLogic.hasOwnProperty(sItem)){oLogic[sItem]=oParser.expand(oLogic[sItem])}}}}if(bArray){var oRootConfig={};oRootConfig[oParser.classProperty]=oParser.useTags?oParser.defaultClass:oOptions.rootWrapper;if(oParser.useTags){oRootConfig[oParser.tagProperty]=oOptions.rootWrapper}oRootConfig[oParser.parentProperty]=oOptions.xmlDoc;oParser.createComponent(oRootConfig)}oParser.create(oUi,oLogic,bArray?oOptions.xmlDoc.lastChild:oOptions.xmlDoc);try{JUL.Designer.state._serializer=JUL.Designer.state._serializer||new XMLSerializer}catch(e){}var oSerializer=JUL.Designer.state._serializer;var sEncoding=oOptions.xmlDoc.xmlEncoding||oOptions.xmlDoc.characterSet||oOptions.xmlDoc.charset;var sXml=oSerializer?oSerializer.serializeToString(oOptions.xmlDoc):oOptions.xmlDoc.xml||'';sXml=sXml.replace(/#customXMLns:/g,'');var n=0;if(sXml.substr(0,5)==='<'+'?xml'){n=sXml.indexOf('?'+'>')+2;sHeader=sXml.substr(0,n);sXml=sXml.substr(sXml.indexOf('<',n))}else if(sEncoding){sHeader=sHeader.replace('"1.0"','"1.0" encoding="'+sEncoding.toUpperCase()+'"')}var aXml=this.formatXml(sXml.replace(/\t/g,'&#9;').replace(/\n/g,'&#10;')).split('\n');for(var i=0;i<aXml.length;i++){n=aXml[i].indexOf('<');aXml[i]=aXml[i].replace(/&#10;/g,'\n'+(n>0?aXml[i].substr(0,n):'')).replace(/&#9;/g,'\t')}return(sHeader+'\n'+aXml.join('\n')).replace(/\t/g,JUL.Designer.parser._tabString)},undo:function(){var oUndo=this.state.clipboard.undo;var i=0;if(!oUndo){window.alert('Nothing to undo');return}this.removeTree();switch(oUndo.operation){case'removeNodes':for(i=0;i<oUndo.ui.length;i++){if(oUndo.wasArray[i]){var oParentWhere=oUndo.where[i].parent;oParentWhere.val(oParentWhere.val()||[]);if(JUL.typeOf(oParentWhere.val())!=='Array'){oParentWhere.val([oParentWhere.val()])}oUndo.where[i].ref(oParentWhere.val());oUndo.where[i].ref().splice(oUndo.where[i].key(),0,oUndo.ui[i])}else{oUndo.where[i].val(oUndo.ui[i])}if(oUndo.logic[i]){JUL.apply(this.current.logic,oUndo.logic[i])}}break;case'addNodes':for(i=oUndo.where.length-1;i>=0;i--){if(oUndo.where[i].parent){oUndo.where[i].ref().splice(oUndo.where[i].key(),1);if(!i){if(oUndo.toArray){oUndo.where[i].parent.val(oUndo.where[i].ref()[0]);
}else if(!oUndo.where[i].ref().length){oUndo.where[i].parent.del()}}}else{oUndo.where[i].del()}}for(i=oUndo.logic.length-1;i>=0;i--){delete this.current.logic[oUndo.logic[i]]}break;case'changeMembers':var oParser=this.currentParser;this.initConfig(oUndo.show.val());if(oUndo.tabIndex===1){oUndo.owner=this.getTarget(oUndo.show.val())}if(oUndo.tabIndex===2){oUndo.owner=this.getTarget(oUndo.show.val())[this.current.listenersProperty]}if(oParser.idProperty in oUndo.items||oUndo.del.indexOf(oParser.idProperty)>-1){var sBid=oUndo.owner[oParser.bindingProperty];this.swapLogic(oUndo.show,oUndo.items[oParser.idProperty]||sBid,oUndo.owner[oParser.idProperty]||sBid,true)}if(oParser.bindingProperty in oUndo.items||oUndo.del.indexOf(oParser.bindingProperty)>-1){var sId=oUndo.owner[oParser.idProperty];this.swapLogic(oUndo.show,sId||oUndo.items[oParser.bindingProperty],sId||oUndo.owner[oParser.bindingProperty],true)}for(var sItem in oUndo.items){if(oUndo.items.hasOwnProperty(sItem)){oUndo.owner[sItem]=oUndo.items[sItem]}}for(i=0;i<oUndo.del.length;i++){delete oUndo.owner[oUndo.del[i]]}break;case'shiftNode':var oNext=oUndo.next.val();oUndo.next.ref().splice(oUndo.next.key(),1);oUndo.next.ref().splice(oUndo.prev.key(),0,oNext);var n=oUndo.next.key();oUndo.next.key(oUndo.prev.key());oUndo.prev.key(n);break;case'changeWhere':var oNodeConfig=oUndo.where.val();var sNodeId=this.getId(oNodeConfig);if(oUndo.toLogic){oNodeConfig[oUndo.what]=this.current.logic[sNodeId][oUndo.what];delete this.current.logic[sNodeId][oUndo.what]}else{if(!this.current.logic[sNodeId]){this.current.logic[sNodeId]={}}this.current.logic[sNodeId][oUndo.what]=oNodeConfig[oUndo.what];delete oNodeConfig[oUndo.what]}break;case'changeType':if(oUndo.toArray){oUndo.target[oUndo.what]=oUndo.target[oUndo.what][0]}else{oUndo.target[oUndo.what]=[oUndo.target[oUndo.what]]}break;default:delete this.state.clipboard.undo;return}this.save(true);this.buildTree();if(oUndo.show&&typeof oUndo.show==='object'){oUndo.show=this.findPath(oUndo.show.val())}if(oUndo.show!==false){this.state.showTab=oUndo.tabIndex;this.showPath(oUndo.show,oUndo.show?oUndo.show.showWhat:false)}delete this.state.clipboard.undo}})})();(function(){'use strict';JUL.ns('JUL.Designer.framework');JUL.Designer.framework.ui={tag:'dialog',id:'dialog-framework',title:'Framework',width:980,height:470,hidden:true,children:[{tag:'tabbox',children:[{tag:'tabs',id:'tabs-framework',children:[{tag:'tab',label:'Settings',width:80,pack:'center'},{tag:'tab',label:'Components',width:80,pack:'center'}]}]},{tag:'deck',id:'deck-framework',flex:1,children:[{tag:'vbox',flex:1,children:[{tag:'listbox',flex:1,id:'listbox-framework-settings',children:[{tag:'listhead',children:[{tag:'listheader',label:'Setting',width:250},{tag:'listheader',label:'Value',width:380},{tag:'listheader',label:'Code',width:40}]},{tag:'listbody'}]}]},{tag:'vbox',flex:1,children:[{tag:'hbox',flex:1,children:[{tag:'vbox',id:'vbox-framework-components',width:220,minwidth:120,children:[{tag:'description',css:'caption',value:'Component'},{tag:'toolbar',children:[{tag:'toolbargrippy'},{tag:'toolbarbutton',label:'Add',id:'button-add-component'},{tag:'toolbarseparator'},{tag:'toolbarbutton',label:'Remove',id:'button-remove-component'},{tag:'toolbarseparator'},{tag:'toolbarbutton',label:'Change',id:'button-change-component'}]},{tag:'toolbar',children:[{tag:'toolbargrippy'},{tag:'hbox',width:'95%',children:[{tag:'textbox',id:'textbox-component-name',style:'margin-top:6px',tooltiptext:'Component name',width:200}]}]},{tag:'listbox',flex:1,id:'listbox-framework-components',children:[{tag:'listhead',children:[{tag:'listheader',label:'Name',width:200}]},{tag:'listbody'}]}]},{tag:'splitter'},{tag:'vbox',flex:1,children:[{tag:'description',css:'caption',value:'Component settings'},{tag:'listbox',height:150,minheight:70,id:'listbox-framework-component-settings',children:[{tag:'listhead',children:[{tag:'listheader',label:'Setting',width:240},{tag:'listheader',label:'Value',width:320},{tag:'listheader',label:'Code',width:40}]},{tag:'listbody'}]},{tag:'splitter'},{tag:'description',css:'caption',value:'Members & events'},{tag:'tabbox',id:'tabbox-current-component',children:[{tag:'tabs',id:'tabs-framework-component-members',children:[{tag:'tab',label:'Members',width:60,pack:'center'},{tag:'tab',label:'Events',width:60,pack:'center'}]}]},{tag:'toolbar',children:[{tag:'toolbargrippy'},{tag:'toolbarbutton',label:'Add',id:'button-add-member'},{tag:'toolbarseparator'},{tag:'toolbarbutton',label:'Remove',id:'button-remove-member'},{tag:'toolbarseparator'},{tag:'toolbarbutton',label:'Change',id:'button-change-member'},{tag:'toolbarseparator'},{tag:'hbox',width:'95%',children:[{tag:'textbox',id:'textbox-member-name',style:'margin-top:6px',tooltiptext:'Member or event name',width:200}]}]},{tag:'deck',id:'deck-framework-component-members',flex:1,children:[{tag:'vbox',flex:1,children:[{tag:'listbox',flex:1,id:'listbox-framework-component-members',children:[{tag:'listhead',children:[{tag:'listheader',label:'Name',width:150},{tag:'listheader',label:'Description',width:80},{tag:'listheader',label:'Logic',width:60},{tag:'listheader',label:'Required',width:60},{tag:'listheader',label:'Default value',width:150},{tag:'listheader',label:'Code',width:40},{tag:'listheader',label:'Template',width:80},{tag:'listheader',label:'Hidden',width:60}]},{tag:'listbody'}]}]},{tag:'vbox',flex:1,children:[{tag:'listbox',flex:1,id:'listbox-framework-component-events',children:[{tag:'listhead',children:[{tag:'listheader',label:'Name',width:150},{tag:'listheader',label:'Description',width:90},{tag:'listheader',label:'Template',width:90},{tag:'listheader',label:'Hidden',width:60}]},{tag:'listbody'}]}]}]}]}]}]}]}]};JUL.Designer.framework.logic={'button-add-component':{listeners:{command:function(){JUL.Designer.framework.addComponent()}}},'button-add-member':{listeners:{command:function(){var nIndex=ample.getElementById('tabbox-current-component').selectedIndex;JUL.Designer.framework.addMember(nIndex?'events':'members')}}},'button-change-component':{listeners:{command:function(){var oItems=ample.getElementById('listbox-framework-components').selectedItems;if(!oItems.length){window.alert('Please select an item');return}var oItem=oItems.item(oItems.length-1);JUL.Designer.framework.changeComponent(JUL.Designer.getWhere(oItem),oItem)}}},'button-change-member':{listeners:{command:function(){var nIndex=ample.getElementById('tabbox-current-component').selectedIndex;var sType=nIndex?'events':'members';var oItems=ample.getElementById('listbox-framework-component-'+sType).selectedItems;if(!oItems.length){window.alert('Please select an item');return}var oItem=oItems.item(oItems.length-1);JUL.Designer.framework.changeMember(JUL.Designer.getWhere(oItem),sType,oItem)}}},'button-remove-component':{listeners:{command:function(){var oItems=ample.getElementById('listbox-framework-components').selectedItems;if(!oItems.length){window.alert('Please select some items');return}var aLabels=[];for(var i=0;i<oItems.length;i++){aLabels[i]=JUL.Designer.getWhere(oItems.item(i))}JUL.Designer.framework.removeComponents(aLabels);JUL.Designer.empty(oItems,true)}}},'button-remove-member':{listeners:{command:function(){var nIndex=ample.getElementById('tabbox-current-component').selectedIndex;var sType=nIndex?'events':'members';var oItems=ample.getElementById('listbox-framework-component-'+sType).selectedItems;if(!oItems.length){window.alert('Please select some items');return}var aLabels=[];for(var i=0;i<oItems.length;i++){aLabels[i]=JUL.Designer.getWhere(oItems.item(i))}JUL.Designer.empty(oItems,true);JUL.Designer.framework.removeMembers(aLabels)}}},'dialog-framework':{listeners:{dialogaccept:function(){JUL.Designer.framework.save();JUL.Designer.cleanMap();return false},dialogcancel:function(){JUL.Designer.framework.cancel();JUL.Designer.cleanMap();return false}}},'listbox-framework-component-events':{listeners:{select:function(oEvent){var oNodeList=this.selectedItems;ample.getElementById('textbox-member-name').setAttribute('value',oNodeList.length?JUL.Designer.getWhere(oNodeList.item(oNodeList.length-1)):'')}}},'listbox-framework-component-members':{listeners:{select:function(oEvent){var oNodeList=this.selectedItems;ample.getElementById('textbox-member-name').setAttribute('value',oNodeList.length?JUL.Designer.getWhere(oNodeList.item(oNodeList.length-1)):'')}}},'listbox-framework-components':{listeners:{select:function(oEvent){var oFramework=JUL.Designer.framework;if(oFramework.state.selectTimer){clearTimeout(oFramework.state.selectTimer)}oFramework.state.selectTimer=setTimeout(function(){delete oFramework.state.selectTimer;var oNodeList=ample.getElementById('listbox-framework-components').selectedItems;oFramework.onSelectComponent(oNodeList.length?JUL.Designer.getWhere(oNodeList.item(oNodeList.length-1)):null)},100)}}},'tabs-framework':{listeners:{select:function(){ample.getElementById('deck-framework').setAttribute('selectedIndex',this.parentNode.selectedIndex)}}},'tabs-framework-component-members':{listeners:{select:function(){var nIndex=ample.getElementById('tabbox-current-component').selectedIndex;ample.getElementById('deck-framework-component-members').setAttribute('selectedIndex',nIndex);var sType=nIndex?'events':'members';JUL.Designer.framework.currentConfig=JUL.Designer.framework.currentComponent?JUL.Designer.framework.currentComponent[sType]:null;var oNodeList=ample.getElementById('listbox-framework-component-'+sType).selectedItems;ample.getElementById('textbox-member-name').setAttribute('value',oNodeList.length?JUL.Designer.getWhere(oNodeList.item(oNodeList.length-1)):'')}}},'textbox-component-name':{listeners:{keypress:function(oEvent){if(oEvent.keyIdentifier==='Enter'){var oItems=ample.getElementById('listbox-framework-components').selectedItems;if(oItems.length&&!oEvent.shiftKey){var oItem=oItems.item(oItems.length-1);JUL.Designer.framework.changeComponent(JUL.Designer.getWhere(oItem),oItem)}else{JUL.Designer.framework.addComponent()}}}}},'textbox-member-name':{listeners:{keypress:function(oEvent){if(oEvent.keyIdentifier==='Enter'){var nIndex=ample.getElementById('tabbox-current-component').selectedIndex;var sType=nIndex?'events':'members';var oItems=ample.getElementById('listbox-framework-component-'+sType).selectedItems;if(oItems.length&&!oEvent.shiftKey){var oItem=oItems.item(oItems.length-1);JUL.Designer.framework.changeMember(JUL.Designer.getWhere(oItem),sType,oItem)}else{JUL.Designer.framework.addMember(sType)}}}}}};JUL.apply(JUL.Designer.framework,{augmentLevel:10,componentFields:{description:{tooltip:'Component description',id:'setting-component-description',template:'<string>'},restrictParent:{tooltip:'Array of component class names this can be child of (special value \'document\')',id:'setting-component-restrict-parent',template:'Class1", "Class2" ... ]'},inherits:{tooltip:'Name or array of names of inherited component classes',id:'setting-component-inherits',template:'<string>'},getBoundingRect:{tooltip:'Component (inherited) method that gets the visible bounding rectangle',id:'setting-component-bouding-rect',template:' function(/*this*/) { ... return {left: <>, top: <>, width: <>, height: <>[, zIndex: <>]}; }'}},current:{},currentComponent:null,currentConfig:null,fields:{title:{tooltip:'Framework\'s title',id:'setting-framework-title',defaultValue:'Framework 1',required:true,template:'<string>'},ns:{tooltip:'Namespace path',id:'setting-framework-ns',defaultValue:'framework1',required:true,template:'<string>'},nsAlias:{tooltip:'Use this namespace instead, when adding or finding the components',id:'setting-framework-ns-alias',template:'<string>'},prependNS:{tooltip:'If checked, framework\'s namespace will be prepended to each component name',id:'setting-framework-prepend-ns',required:true,defaultValue:false,template:'<boolean>'},getBoundingRect:{tooltip:'Framework method that gets the visible bounding rectangle',id:'setting-framework-bouding-rect',template:' function(/*this*/) { ... return {left: <>, top: <>, width: <>, height: <>[, zIndex: <>]}; }'},augments:{tooltip:'Framework namespace to build this upon (inherit all components and their configs)',id:'setting-framework-augments',template:'<string>'},groupByLevel:{tooltip:'Groups components by the framework inheritance level',id:'setting-framework-group-by',required:true,defaultValue:false,template:'<boolean>'}},state:{newFramework:null,currentOperation:''},addComponent:function(){var oCurrent=this.state.newFramework;if(!oCurrent.components){oCurrent.components={}}var nLast=1;var sName=JUL.trim(ample.getElementById('textbox-component-name').getAttribute('value'));if(!sName||oCurrent.components[sName]){while((sName='component'+nLast++)&&oCurrent.components[sName]){}}ample.getElementById('textbox-component-name').setAttribute('value','');oCurrent.components[sName]={};var oFields={};oFields[sName]=oCurrent.components[sName];JUL.Designer.fillListbox('listbox-framework-components',oFields,oCurrent.components,['label']);ample.getElementById('listbox-framework-components').querySelector('xul|listbody').lastChild.scrollIntoView();ample.getElementById('listbox-framework-components').clearSelection()},addLevelMap:function(oItems,nLevel){if(!oItems){return}if(!nLevel){nLevel=0;this.state.levelMap={}}nLevel='l'+(1e3+nLevel).toString().substr(1);if(typeof oItems!=='object'){this.state.levelMap[oItems]=nLevel;return}for(var sItem in oItems){if(oItems.hasOwnProperty(sItem)){this.state.levelMap[sItem]=nLevel}}},addMember:function(sType){if(!this.currentComponent){window.alert('Please select a component from the left');return}var nLast=1;var sName=JUL.trim(ample.getElementById('textbox-member-name').getAttribute('value'));if(!sName||this.currentConfig[sName]){while((sName=sType.slice(0,-1)+nLast++)&&this.currentConfig[sName]){}}ample.getElementById('textbox-member-name').setAttribute('value','');this.currentConfig[sName]={};var oFields={};if(sType==='events'){this.currentConfig[sName]={hidden:false};oFields[sName]={};JUL.Designer.fillListbox('listbox-framework-component-events',oFields,this.currentConfig,['label','description-description','description-template','value-hidden'],true)}else{this.currentConfig[sName]={logic:false,required:false,hidden:false};oFields[sName]={};JUL.Designer.fillListbox('listbox-framework-component-members',oFields,this.currentConfig,['label','description-description','value-logic','value-required','value-defaultValue','code-defaultValue','description-template','value-hidden'],true)}ample.getElementById('listbox-framework-component-'+sType).querySelector('xul|listbody').lastChild.scrollIntoView();ample.getElementById('listbox-framework-component-'+sType).clearSelection()},augment:function(sResponse){var oFramework=JUL.Designer.framework;var oResult=sResponse?JSON.parse(sResponse,JUL.makeCaller(JUL.Designer.parser,JUL.Designer.jsonReviver)):null;if(oResult&&!oResult.error){JUL.Designer.makeCompat(oResult,sResponse);oResult=oResult.result}else{oResult=null}if(oResult){oFramework.current.getetBoundingRect=oFramework.current.getetBoundingRect||oResult.getBoundingRect;oFramework.current.augments=oResult.augments;oResult.components=oResult.components||{};for(var sItem in oResult.components){if(oResult.components.hasOwnProperty(sItem)){oFramework.current.components=oFramework.current.components||{};oFramework.addLevelMap(sItem,oFramework.state.parents.length);if(oFramework.current.components[sItem]){var oTarget=oFramework.current.components[sItem];oTarget.restrictParent=oTarget.restrictParent||oResult.components[sItem].restrictParent;oTarget.inherits=oTarget.inherits||oResult.components[sItem].inherits;oTarget.getBoundingRect=oTarget.getBoundingRect||oResult.components[sItem].getBoundingRect;var oMembers=oResult.components[sItem].members||{};for(var sVal in oMembers){if(oMembers.hasOwnProperty(sVal)){oTarget.members=oTarget.members||{};if(!oTarget.members[sVal]){oTarget.members[sVal]=oMembers[sVal]}}}var oEvents=oResult.components[sItem].events||{};for(sVal in oEvents){if(oEvents.hasOwnProperty(sVal)){oTarget.events=oTarget.events||{};if(!oTarget.events[sVal]){oTarget.events[sVal]=oEvents[sVal]}}}}else{oFramework.current.components[sItem]=oResult.components[sItem]}}}}if(!oFramework.current.augments||oFramework.state.parents.length>oFramework.augmentLevel||oFramework.state.parents.indexOf(oFramework.current.augmetns)>-1||sResponse&&!oResult){delete oFramework.current.augments;JUL.Designer.panels.browse.hide();JUL.Designer.panels.framework.hide();JUL.Designer.state.lastDialog=null;oFramework.onSelectComponent();JUL.Designer.empty(ample.getElementById('listbox-framework-components').body);oFramework.onSwitchCurrent();return}if(oResult){oFramework.state.parents.push(oFramework.current.ns)}ample.getElementById('statusbarpanel-framework').setAttribute('label','+ '+oFramework.current.augments+' ...');ample.get('assets/frameworks/'+oFramework.current.augments.split('.').join('/')+'.txt',{ts:(new Date).getTime()},oFramework.augment)},cancel:function(){this.state.newFramework=null;JUL.Designer.panels.framework.hide();JUL.Designer.state.lastDialog=null},changeComponent:function(sItem,oItem){var sName=JUL.trim(ample.getElementById('textbox-component-name').getAttribute('value'));var oCurrent=this.state.newFramework;if(!sName||sName===sItem||oCurrent.components[sName]){ample.getElementById('textbox-component-name').setAttribute('value',sItem);return}oCurrent.components[sName]=oCurrent.components[sItem];delete oCurrent.components[sItem];JUL.Designer.state.map[oItem.getAttribute('id')]=sName;oItem.firstChild.setAttribute('label',sName);ample.getElementById('listbox-framework-components').clearSelection()},changeMember:function(sItem,sType,oItem){var sName=JUL.trim(ample.getElementById('textbox-member-name').getAttribute('value'));if(!sName||sName===sItem||this.currentConfig[sName]){ample.getElementById('textbox-member-name').setAttribute('value',sItem);return false}this.currentConfig[sName]=this.currentConfig[sItem];delete this.currentConfig[sItem];JUL.Designer.state.map[oItem.getAttribute('id')]=sName;oItem.firstChild.setAttribute('label',sName);var oNode=oItem.childNodes[1];while(oNode){var oWhere=JUL.Designer.getWhere(oNode.firstChild);oWhere.field.label=sName+' - '+oWhere.key();if(oWhere.key()==='defaultValue'&&oNode.firstChild.nodeName==='xul:button'){oNode.firstChild.setAttribute('tooltiptext',oWhere.field.label)}oNode=oNode.nextSibling}ample.getElementById('listbox-framework-component-'+sType).clearSelection();return sName},close:function(){this.onSelectComponent();JUL.Designer.empty(ample.getElementById('listbox-framework-components').body);this.current={};this.state.origFramework=null;this.onSwitchCurrent()},del:function(){if(!this.current.ns){window.alert('There is no current framework');return}if(!window.confirm('Are you sure to permanently delete \''+this.current.title+'\' framework?')){return}ample.get('assets/alter.txt',{ts:(new Date).getTime()},function(sResponse){sResponse=JSON.parse(sResponse);if(sResponse.error){window.alert(sResponse.error)}else{JUL.Designer.framework.close()}})},fillScrollbox:function(oContext){JUL.Designer.empty(ample.getElementById('scrollbox-components'));JUL.Designer.empty(ample.getElementById('table-add-component').lastChild);var oCurrent=this.current;if(!oCurrent.components){return}var sFrameworkNS=oCurrent.nsAlias||oCurrent.ns;var sClass=false;if(oContext){var oParser=JUL.Designer.designer.currentParser;sClass=oContext[oParser.classProperty]||oParser.defaultClass;if(oParser.useTags){sClass=sClass===sFrameworkNS?oContext[oParser.tagProperty]:''}else if(oCurrent.prependNS&&sClass.indexOf(sFrameworkNS+'.')===0){sClass=sClass.substr(sFrameworkNS.length+1)}}var oScrollbox=ample.getElementById('scrollbox-components');var oMenupopup=ample.getElementById('table-add-component').lastChild;var aSort=[];for(var sItem in oCurrent.components){if(oCurrent.components.hasOwnProperty(sItem)){aSort.push(sItem)}}var oRe=/_/g;var oMap=this.state.levelMap;var fSort=function(a,b){if(oCurrent.groupByLevel&&oMap[a]!==oMap[b]){return oMap[a]>oMap[b]?1:-1}a=a.replace(oRe,'~');b=b.replace(oRe,'~');if(a.toUpperCase()===b.toUpperCase()){return a>b?1:-1}return a.toUpperCase()>b.toUpperCase()?1:-1};aSort.sort(fSort);var n=1;for(var u=0;u<aSort.length;u++){sItem=aSort[u];var oComponent=oCurrent.components[sItem];var aRestrict=[];if(oComponent.restrictParent){aRestrict=aRestrict.concat(oComponent.restrictParent)}if(oCurrent.components.hasOwnProperty(sItem)&&(!oComponent.restrictParent||sClass===false&&aRestrict.indexOf('document')>-1||aRestrict.indexOf(sClass||'')>-1)){var oItemConfig={tag:'button',id:'button-add-comp-'+n,label:sItem,width:'99%',css:'cbutton',parent:oScrollbox,listeners:{command:function(){JUL.Designer.designer.addComponent(JUL.Designer.getWhere(this))}}};JUL.Designer.state.map[oItemConfig.id]=sItem;if(oComponent.description){oItemConfig.tooltiptext=oComponent.description}JUL.Designer.parser.createComponent(oItemConfig);delete oItemConfig.width;delete oItemConfig.css;oItemConfig.tag='menuitem';oItemConfig.id='menubutton-add-comp-'+n;oItemConfig.parent=oMenupopup;JUL.Designer.state.map[oItemConfig.id]=sItem;JUL.Designer.parser.createComponent(oItemConfig);n++}}},getInherited:function(oComponent,sChildren){if(!oComponent.inherits){return oComponent[sChildren]}var oChildren={};var aInherits=[].concat(oComponent.inherits);var oComponents=this.current.components;for(var i=0;i<aInherits.length;i++){var sName=aInherits[i];if(oComponents[sName]&&oComponents[sName]!==oComponent){JUL.apply(oChildren,this.getInherited(oComponents[sName],sChildren))}}if(oComponent[sChildren]){JUL.apply(oChildren,oComponent[sChildren])}return oChildren},getInheritedProperty:function(oComponent,sProperty){if(!oComponent.inherits||typeof oComponent[sProperty]!=='undefined'){return oComponent[sProperty]}var sValue=this._undef;var aInherits=[].concat(oComponent.inherits);var oComponents=this.current.components;for(var i=aInherits.length-1;i>-1;i--){var sName=aInherits[i];if(oComponents[sName]&&oComponents[sName]!==oComponent){sValue=this.getInheritedProperty(oComponents[sName],sProperty);if(typeof sValue!=='undefined'){return sValue}}}return sValue},onSelectComponent:function(sItem){JUL.Designer.empty(ample.getElementById('listbox-framework-component-settings').body);ample.getElementById('textbox-member-name').setAttribute('value','');JUL.Designer.empty(ample.getElementById('listbox-framework-component-members').body);JUL.Designer.empty(ample.getElementById('listbox-framework-component-events').body);ample.getElementById('tabbox-current-component').querySelector('xul|tabs').firstChild.$activate();if(!sItem){ample.getElementById('textbox-component-name').setAttribute('value','');this.currentComponent=null;this.currentConfig=null;return}var oCurrent=this.state.newFramework;this.currentComponent=oCurrent.components[sItem];if(!this.currentComponent){return}if(!this.currentComponent.members){this.currentComponent.members={}}if(!this.currentComponent.events){this.currentComponent.events={}}for(var sPos in this.currentComponent.members){if(this.currentComponent.members.hasOwnProperty(sPos)){JUL.apply(this.currentComponent.members[sPos],{logic:false,required:false,hidden:false},true)}}for(sPos in this.currentComponent.events){if(this.currentComponent.events.hasOwnProperty(sPos)){JUL.apply(this.currentComponent.events[sPos],{hidden:false},true)}}this.currentConfig=this.currentComponent.members;ample.getElementById('textbox-component-name').setAttribute('value',sItem);JUL.Designer.fillListbox('listbox-framework-component-settings',this.componentFields,this.currentComponent);JUL.Designer.fillListbox('listbox-framework-component-members',JUL.Designer.keySort(this.currentComponent.members),this.currentComponent.members,['label','description-description','value-logic','value-required','value-defaultValue','code-defaultValue','description-template','value-hidden'],true);JUL.Designer.fillListbox('listbox-framework-component-events',JUL.Designer.keySort(this.currentComponent.events),this.currentComponent.events,['label','description-description','description-template','value-hidden'],true)},onSwitchCurrent:function(){JUL.Designer.designer.setTitle();ample.getElementById('command-prepend-namespace').setAttribute('checked',this.current.prependNS||false);var oProject=JUL.Designer.designer;if(oProject.currentNode){var oWhere=JUL.Designer.getWhere(oProject.currentNode);this.fillScrollbox(oWhere.val());oProject.removeConfigListeners(oWhere.val());oProject.fillComponentLists(oWhere.val());oProject.addConfigListeners(oWhere.val());oProject.filterMembers(oWhere)}else{this.fillScrollbox();oProject.filterMembers()}},open:function(sItem){ample.get('assets/frameworks/'+sItem.split('.').join('/')+'.txt',{ts:(new Date).getTime()},function(sResponse){var oResult=JSON.parse(sResponse,JUL.makeCaller(JUL.Designer.parser,JUL.Designer.jsonReviver));if(oResult.error){window.alert(oResult.error);return}JUL.Designer.makeCompat(oResult,sResponse);var oFramework=JUL.Designer.framework;oFramework.state.origFramework=oResult.result;oFramework.current=JUL.Designer.designer.copy(oFramework.state.origFramework);oFramework.addLevelMap(oFramework.current.components||{});oFramework.state.parents=[oFramework.current.ns];oFramework.augment()})},removeComponents:function(aNames){var oCurrent=this.state.newFramework;var sName;if(!oCurrent.components){return}for(var i=0;i<aNames.length;i++){sName=aNames[i];if(oCurrent.components[sName]){if(this.currentComponent===oCurrent.components[sName]){this.currentComponent=null;this.currentConfig=null}delete oCurrent.components[sName]}}},removeMembers:function(aNames){var sName;if(!this.currentConfig){return}for(var i=0;i<aNames.length;i++){sName=aNames[i];delete this.currentConfig[sName]}},save:function(){var oCurrent=this.state.newFramework;if(!JUL.Designer.validNS(oCurrent.ns)){window.alert('Invalid namespace');return}if(oCurrent.nsAlias&&!JUL.Designer.validNS(oCurrent.nsAlias)){window.alert('Invalid namespace alias');return}if(oCurrent.augments&&!JUL.Designer.validNS(oCurrent.augments)){window.alert('Invalid augments namespace');return}oCurrent.version='1.'+(new Date).getTime();JUL.Designer.applyRequired(this.fields,oCurrent);oCurrent=JUL.Designer.keySort(oCurrent,'components');if(oCurrent.components){if(JUL.Designer.isEmpty(oCurrent.components)){delete oCurrent.components}else{oCurrent.components=JUL.Designer.keySort(oCurrent.components)}for(var sItem in oCurrent.components){if(oCurrent.components.hasOwnProperty(sItem)){var oComponent=oCurrent.components[sItem];JUL.Designer.applyRequired(this.componentFields,oComponent);oComponent=JUL.Designer.keySort(oComponent,['members','events']);oCurrent.components[sItem]=oComponent;if(oComponent.members){if(JUL.Designer.isEmpty(oComponent.members)){delete oComponent.members}else{oComponent.members=JUL.Designer.keySort(oComponent.members)}}if(oComponent.events){if(JUL.Designer.isEmpty(oComponent.events)){delete oComponent.events}else{oComponent.events=JUL.Designer.keySort(oComponent.events)}}}}}ample.get('assets/alter.txt',{ts:(new Date).getTime()},function(sResponse){sResponse=JSON.parse(sResponse);if(sResponse.error){window.alert(sResponse.error)}else{var oFramework=JUL.Designer.framework;oFramework.state.origFramework=oFramework.state.newFramework;oFramework.state.newFramework=null;oFramework.current=JUL.Designer.designer.copy(oFramework.state.origFramework);oFramework.addLevelMap(oFramework.current.components||{});oFramework.state.parents=[oFramework.current.ns];oFramework.augment()}})},scrollLists:function(){var oItems=ample.getElementById('listbox-framework-components').selectedItems;if(oItems.length){oItems.item(oItems.length-1).scrollIntoView()}oItems=ample.getElementById('listbox-framework-component-members').selectedItems;if(oItems.length){oItems.item(oItems.length-1).scrollIntoView()}oItems=ample.getElementById('listbox-framework-component-events').selectedItems;if(oItems.length){oItems.item(oItems.length-1).scrollIntoView()}},show:function(sOperation){if(sOperation==='edit'&&!this.current.ns){window.alert('There is no current framework');return}if(sOperation==='new'){this.state.newFramework={}}else{this.state.newFramework=JUL.Designer.designer.copy(this.state.origFramework)}var oCurrent=this.state.newFramework;JUL.Designer.empty(ample.getElementById('listbox-framework-settings').body);ample.getElementById('textbox-component-name').setAttribute('value','');JUL.Designer.empty(ample.getElementById('listbox-framework-component-settings').body);ample.getElementById('textbox-member-name').setAttribute('value','');JUL.Designer.empty(ample.getElementById('listbox-framework-component-members').body);JUL.Designer.empty(ample.getElementById('listbox-framework-component-events').body);JUL.Designer.empty(ample.getElementById('listbox-framework-components').body);JUL.Designer.fillListbox('listbox-framework-settings',this.fields,oCurrent);if(oCurrent.components){JUL.Designer.fillListbox('listbox-framework-components',JUL.Designer.keySort(oCurrent.components),oCurrent.components,['label'])}this.state.currentOperation=sOperation;JUL.Designer.panels.framework.setAttribute('title',sOperation==='new'?'New framework':'Edit framework - '+oCurrent.title);JUL.Designer.state.lastDialog=JUL.Designer.panels.framework;JUL.Designer.panels.framework.showModal();JUL.Designer.panels.framework.querySelector('xul|tabs').firstChild.$activate()}})})();(function(){'use strict';JUL.ns('JUL.Designer.help');JUL.Designer.help.ui={tag:'window',hidden:true,title:JUL.Designer.title+' Help',width:980,height:480,children:[{tag:'toolbox',children:[{tag:'toolbar',children:[{tag:'toolbargrippy'},{tag:'toolbarbutton',type:'checkbox',checked:true,label:'Show contents',listeners:{command:function(){ample.getElementById('tree-help').setAttribute('hidden',this.getAttribute('checked')!=='true')}}},{tag:'toolbarseparator'},{tag:'vbox',flex:1},{xclass:'html',tag:'div',width:220,style:'padding:5px 18px 0 0;text-align:right',children:[{xclass:'html',tag:'a',target:'_blank',href:'docs/index.html?1489485881291',html:'Open in a new window'}]}]}]},{tag:'hbox',flex:1,children:[{tag:'tree',id:'tree-help',seltype:'single',width:280,height:'100%',children:[{tag:'treecols',children:[{tag:'treecol',primary:true,width:310,label:'Contents'}]},{tag:'treebody'}],listeners:{select:function(oEvent){var oNodeList=this.selectedItems;if(!oNodeList.length){return}var oHelp=ample.getElementById('iframe-help');oHelp.setAttribute('src',JUL.Designer.help.src+'#'+oNodeList.item(oNodeList.length-1).getAttribute('id').substr(10))}}},{tag:'vbox',flex:1,children:[{xclass:'html',tag:'div',flex:1,children:[{xclass:'html',tag:'iframe',id:'iframe-help',name:'iframe-help',width:'100%',height:'100%',seamless:'yes',style:'border:0',src:'docs/index.html?1489485881291'}]}]}]}]};JUL.apply(JUL.Designer.help,{src:'docs/index.html?'+(new Date).getTime(),onLoad:function(){var oHelp=document.getElementById('iframe-help');oHelp=oHelp.contentDocument||oHelp.contentWindow.document;var oToc=oHelp.getElementById('toc');if(!oToc||!oToc.firstChild){return}var oStyle=oHelp.styleSheets[oHelp.styleSheets.length-1];if(oStyle.insertRule){oStyle.insertRule('.to-top{display:none;}',0)}else if(oStyle.addRule){oStyle.addRule('.to-top','display:none',0)}oToc.style.cssText=oToc.style.cssText+';display:none';var fParse=function(oNode,oTree){if(!oNode.firstChild){return}var oItem,i,oChild;if(oNode.nodeType===1&&oNode.nodeName.toLowerCase()==='li'){oItem=JUL.Designer.parser.create({tag:'treeitem',id:'node-help-'+oNode.firstChild.hash.substr(1),container:true,open:true,children:[{tag:'treerow',children:[{tag:'treecell',label:oNode.firstChild.text||oNode.firstChild.innerText}]}]},null,oTree);for(i=1;i<oNode.childNodes.length;i++){oChild=oNode.childNodes[i];if(oChild.nodeType===1&&oChild.nodeName.toLowerCase()==='ul'){fParse(oChild,oItem);break}}}if(oNode.nodeType===1&&oNode.nodeName.toLowerCase()==='ul'){oItem=JUL.Designer.parser.create({tag:'treechildren'
},null,oTree);for(i=0;i<oNode.childNodes.length;i++){oChild=oNode.childNodes[i];if(oChild.nodeType===1&&oChild.nodeName.toLowerCase()==='li'){fParse(oChild,oItem)}}}};var oBody=ample.getElementById('tree-help').querySelector('xul|treebody');for(var j=0;j<oToc.childNodes.length;j++){if(oToc.childNodes[j].nodeType===1&&oToc.childNodes[j].nodeName.toLowerCase()==='ul'){fParse(oToc.childNodes[j],oBody);break}ample.getElementById('tree-help').reflow()}}})})();(function(){'use strict';JUL.ns('JUL.Designer.about');JUL.Designer.about.ui={tag:'window',css:'logo-bg',hidden:true,title:'About',width:617,height:251,'aml:resizable':false,orient:'horizontal',children:[{tag:'vbox',width:262,children:[{xclass:'html',tag:'div',style:'padding: 8px',flex:1,children:[{xclass:'html',tag:'img',width:240,height:224,alt:JUL.Designer.title,src:'media/jul224.png'}]}]},{tag:'vbox',flex:1,children:[{tag:'spacer',height:60},{tag:'description',css:'logo-title',value:JUL.Designer.title},{tag:'description',value:'Version '+JUL.Designer.version},{tag:'description',html:'Copyright &copy; 2014 - 2017 <a target="_blank" href="'+ample.$encodeXMLCharacters(JUL.Designer.config.zb_link)+'">The Zonebuilder</a>'},{tag:'description',html:'Powered by <a target="_blank" href="http://www.amplesdk.com/">Ample SDK</a>, <a target="_blank" href="http://nodejs.org/">Node.js</a> &amp; <a target="_blank" href="http://kohanaframework.org/">Kohana PHP</a>'}]}],listeners:{click:function(oEvent){if(oEvent.target.nodeName!=='a'){this.hide(oEvent)}}}};JUL.apply(JUL.Designer.about,{})})();